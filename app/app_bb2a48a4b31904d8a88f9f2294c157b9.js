!function(){"use strict";function e(e,n,a,o,r,i,s,l,c){function u(e){var t=e[0],n=t.compile;return angular.extend(t.scope,{menuContainerClass:"@?mdMenuContainerClass"}),t.compile=function(e,t){var a=n.apply(this,arguments),o=t.mdMenuContainerClass?t.mdMenuContainerClass:"",r=e.find("md-virtual-repeat-container");return r.addClass(o),function(e,t){a.apply(this,arguments)}},e}c.decorator("mdAutocompleteDirective",u),u.$inject=["$delegate"],e.html5Mode({enabled:!0,requireBase:!0}),e.hashPrefix(""),l.preAssignBindingsEnabled(!0),s.errorOnUnhandledRejections(!1),i.classNameFilter(/^(?:(?!ng-animate-disabled).)*$/),n.definePalette("brokerPalette",{50:"00a657",100:"dcdcdc",200:"00a657",300:"00a657",400:"00a657",500:"00a657",600:"00a657",700:"00a657",800:"00a657",900:"00a657",A100:"00a657",A200:"00a657",A400:"00a657",A700:"00a657",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),n.theme("mbBroker").primaryPalette("brokerPalette").accentPalette("brokerPalette"),n.theme("mbBroker-dark").primaryPalette("brokerPalette").accentPalette("brokerPalette").dark().foregroundPalette[3]="rgba(198,198,198,0.9)",n.setDefaultTheme("mbBroker"),a.interceptors.push("HttpInterceptFactory"),a.useApplyAsync(!0),a.defaults.cache=!1,r.otherwise("/notfound"),r.when("/","/dashboard"),r.when("/deals","/deals/executing"),r.when("/deals/detail/:id","/deals/detail/:id/overview"),r.when("/commissions/overview","/commissions/overview/paid"),r.when("/voucher/:id","/voucher/:id/1_getting_started"),r.when("/voucher/:id/2_lease_detail","/voucher/:id/2_lease_detail/overview"),o.state("notFound",{url:"/notfound",component:"notFound"}).state("unauthorized",{url:"/unauthorized",component:"unauthorized"}).state("rootCallback",{url:"/callback",component:"callback"}).state("rootAgreement",{url:"/agreement",component:"agreement"}).state("ssoCallback",{url:"/sso-callback",component:"ssoCallback"}).state("app",{url:"",component:"app",abstract:!0}).state("app.dashboard",{url:"/dashboard",component:"dashboard"}).state("app.deals",{url:"/deals",component:"deals"}).state("app.deals.prospects",{url:"/prospects",component:"dealsListProspects"}).state("app.deals.executing",{url:"/executing",component:"dealsListExecuting"}).state("app.deals.closed",{url:"/closed",component:"dealsListClosed"}).state("app.dealsDetail",{url:"/deals/detail/:id",component:"dealsDetail",resolve:{dealResolve:t}}).state("app.dealsDetail.overview",{url:"/overview",component:"dealsDetailOverview"}).state("app.dealsDetail.notes",{url:"/notes",component:"dealsDetailNotes"}).state("app.dealsDetail.tasks",{url:"/tasks",component:"dealsDetailTasks"}).state("app.dealsDetail.attachments",{url:"/files",component:"dealsDetailAttachments"}).state("app.dealsDetail.properties",{url:"/properties",component:"dealsDetailProperties"}).state("app.dealsDetail.contacts",{url:"/contacts",component:"dealsDetailContacts"}).state("app.dealsDetail.financials",{url:"/financials",component:"dealsDetailFinancials"}).state("app.voucher",{url:"/voucher/:id",component:"voucherCtrl",resolve:{dealResolve:t}}).state("app.voucher.1_getting_started",{url:"/1_getting_started",component:"gettingStartedCtrl"}).state("app.voucher.2_leaseDetails",{url:"/2_lease_details",component:"leaseDetailsCtrl"}).state("app.voucher.2_leaseDetails.2_1_overview",{url:"/overview",component:"leaseDetailOverviewCtrl"}).state("app.voucher.2_leaseDetails.2_2_properties",{url:"/properties",component:"leaseDetailPropertiesCtrl"}).state("app.voucher.2_leaseDetails.2_3_landlord",{url:"/landlord",component:"leaseDetailLandlordCtrl"}).state("app.voucher.2_leaseDetails.2_4_tenant",{url:"/tenant",component:"leaseDetailTenantCtrl"}).state("app.voucher.3_financials",{url:"/3_financials",component:"financialDetailCtrl"}).state("app.voucher.3_financials.3_1_consideration",{url:"/consideration",component:"financialDetailConsiderationCtrl"}).state("app.voucher.3_financials.3_2_installments",{url:"/installments",component:"financialDetailInstallmentsCtrl"}).state("app.commissions",{url:"/commissions",abstract:!0}).state("app.commissionsOverview",{url:"/commissions/overview",component:"commissionsOverview"}).state("app.commissionsOverview.table",{url:"/:type",component:"commissionsTable"}).state("app.commissionsBreakdown",{url:"/commissions/breakdown",component:"commissionsBreakdown"}).state("app.tasks",{url:"/tasks",component:"tasks"}).state("app.profile",{url:"/profile",component:"profile"}).state("app.support",{url:"/support",component:"support"}).state("app.support.overview",{url:"/overview",component:"supportOverview"}).state("app.support.whatsNew",{url:"/whats-new",component:"supportWhatsNew"}).state("app.contacts",{url:"/contacts",component:"personalContacts"})}function t(e,t){var n=t.getDeal(e.id);return n.then(function(e){t.setCurrentDeal(e)}),n}function n(e,t,n,a,o){function r(e){s=e}function i(){return s?s+" | "+l:l}var s,l="CBRE Deal IQ";n.connect(),e.$on("updatePageTitle",function(t,n){r(n),e.fullPageTitle=i()})}e.$inject=["$locationProvider","$mdThemingProvider","$httpProvider","$stateProvider","$urlRouterProvider","$animateProvider","$qProvider","$compileProvider","$provide"],n.$inject=["$scope","$rootScope","websocketFactory","$stateParams","dealsFactory"],t.$inject=["$stateParams","dealsFactory"],angular.module("app",["ngAnimate","ngMessages","ngSanitize","templates","ngFileUpload","ngTagsInput","rzModule","ui.router","ngMaterial","ngAria","focus-if","bw.paging","ngImgCrop","ngTouch","angulartics","angulartics.piwik","puElasticInput"]).config(e).controller("MainCtrl",n)}(),function(){"use strict";angular.module("app").constant("_",_).constant("moment",moment).constant("env",env)}(),function(){"use strict";angular.module("app").directive("commaNumber",["$filter",function(e){return{require:"?ngModel",link:function(t,n,a,o){o&&(o.$formatters.unshift(function(){return e("number")(o.$modelValue)}),o.$parsers.unshift(function(t){var a=t.replace(/[\,\.]/g,"");if(""===a)return"";var o=e("number")(a);return n.val(o),a}))}}}])}(),function(){"use strict";angular.module("app").service("formatNumberPlacesUtilities",function(){this.occurrences=function(e,t){if(!angular.isString(e))throw new TypeError("formatNumberPlacesUtilities#occurrences expects its 1st argument to be a String, but was given "+e);if(!angular.isArray(t))throw new TypeError("formatNumberPlacesUtilities#occurrences expects its 2nd argument to be an Array, but was given "+t);return t.forEach(function(e,t){if(!angular.isString(e))throw new TypeError("formatNumberPlacesUtilities#occurrences expects needles to be Strings, but needle #"+t+" is "+e)}),t.map(function(t){var n=t.replace(/\[/g,"\\[").replace(/\]/g,"\\]");return(e.match(new RegExp("["+n+"]","g"))||[]).length}).reduce(function(e,t){return e+t},0)},this.toFloat=function(e){if(!angular.isString(e))throw new TypeError("formatNumberPlacesUtilities#toFloat expects its 1st argument to be a String, but was given "+e);return parseFloat(e.replace(/(\$|\,)+/g,""),10)},this.uniq=function(e){return e.reduce(function(e,t){return e.indexOf(t)>-1?e:e.concat(t)},[])},this.uniqueChars=function(e,t){if(!angular.isString(e))throw new TypeError("formatNumberPlacesUtilities#uniqueChars expects its 1st argument to be a String, but was given "+e);if(!angular.isString(t))throw new TypeError("formatNumberPlacesUtilities#uniqueChars expects its 2nd argument to be a String, but was given "+t);var n=e.split("");return this.uniq(t.split("").sort().reduce(function(e,t){return n.indexOf(t)<0?e.concat(t):e},[]))}}).directive("formatNumberPlaces",["$filter","$locale","formatNumberPlacesUtilities",function(e,t,n){var a=n;return{require:"ngModel",restrict:"A",link:function(t,n,o,r){function i(){r.$setViewValue(r.$formatters.reduce(function(e,t){return t(e)},r.$modelValue))}function s(){n.on("focus",function(e){var t=[0,0],a=e.currentTarget.value||"";a.indexOf(".")!==-1&&(t=[0,a.indexOf(".")]),n[0].setSelectionRange(t[0],t[1])})}var l=e("number"),c=2;t.$watchGroup([o.numberFilter,o.numberPlaces],function(t,n,a){var o=t[0];l=o?e(o):l,c=angular.isUndefined(t[1])?c:t[1],i()}),s(),t.$on("$destroy",function(){n.off("focus")}),r.$formatters.push(function(e){return l(e,c)}),r.$parsers.push(function(e){e=e.replace(/[a-zA-Z!\?>:;\|<@#%\^&\*\)\(\+\/\\={}\[\]_]/g,"");var t=(Math.floor(a.toFloat(e)*Math.pow(10,c))/Math.pow(10,c)).toFixed(c);if(r.$validators.isNumber(t)){var o=l(t,c),i=a.uniqueChars(t,o),s=[e,o].map(function(e){return a.occurrences(e,i)}).reduce(function(e,t){return t-e}),u=[n[0].selectionStart,n[0].selectionEnd].map(function(e){return e+s});r.$setViewValue(o),r.$render(),n[0].setSelectionRange(u[0],u[1])}return Number(t)}),r.$validators.isNumber=function(e){return!isNaN(e)}}}}])}(),function(){"use strict";function e(e,t,n,a,o){function r(e,r,i){function s(){var t=o.$on("taskSelected",c),n=o.$on("onorientationchange",l),a=o.$on("onresize",l);e.$on("$destroy",function(){t(),n(),a()})}function l(){x()}function c(){t(function(){p()})}function u(){M.addEventListener("scroll",d)}function d(){q()}function p(){if(!_()){if(y())return void(O.style.top="0px");if(b()&&T())return void(O.style.top=I.clientHeight-O.clientHeight+"px");if(!b()||!h())return b()&&f()?void(O.style.top=M.scrollTop-L+"px"):b()&&g()?void(O.style.top=I.clientHeight-O.clientHeight+"px"):b()&&m()?void(O.style.top=M.scrollTop+M.clientHeight-L-O.clientHeight+"px"):C()&&v()?void(O.style.top=M.scrollTop-L+"px"):void 0}}function m(){return M.scrollTop+M.clientHeight>L+parseInt(O.style.top)+O.clientHeight}function f(){return M.scrollTop<L+parseInt(O.style.top)}function g(){return L+I.clientHeight<M.scrollTop+M.clientHeight}function h(){var e=M.scrollTop>L+parseInt(O.style.top),t=M.scrollTop+M.clientHeight<L+parseInt(O.style.top)+O.clientHeight;return e&&t}function v(){return M.scrollTop>L}function _(){return I.clientHeight<O.clientHeight}function y(){return M.scrollTop<L}function b(){return M.clientHeight<O.clientHeight}function C(){return O.clientHeight<M.clientHeight}function T(){return M.scrollTop+M.clientHeight>j+L+I.clientHeight}function D(){P=document.createElement("div"),P.className="scroll-along-arrow pointer-arrow pointer-arrow--left",O.parentNode.insertBefore(P,O.nextSibling),e.$watch(N,function(e,t){Y="object"==typeof e&&e&&!e.id,F=n(function(){var e=$();e&&n.cancel(F)},20,10)})}function $(){return U||(U=n($,250)),K=Y?document.querySelector(i.arrowTargetTop):document.querySelector(i.arrowTarget),null===K&&null!==z?(z=null,w(),!0):K!==z&&(z=K,k(K),!0)}function k(e){if(e){var t=e.getBoundingClientRect().top+document.body.scrollTop,n=I.getBoundingClientRect().top,a=t-n,o=e.clientHeight,r=parseInt(i.arrowTopFudge)||5;P.style.top=a+o/2+r+"px",x()}}function w(){R||(P.style.opacity=0,P.style.borderColor="transparent transparent transparent transparent",R=!0)}function S(){R&&(P.style.borderColor="transparent transparent white white",P.style.opacity=1,R=!1)}function x(){function e(){if(null!==K){var t=P.getBoundingClientRect(),a=O.getBoundingClientRect();t.top<a.top||a.bottom<t.top?w():S(),A&&1===A.$$state.status&&(A=n(e,250))}}A&&n.cancel(A),e(),A=n(e,20,10)}var P,A,F,U,O=r[0],M=document.querySelector("#main-content"),E=document.querySelector("main-header"),I=document.querySelector(i.listElementSelector),j=angular.element(E).prop("offsetHeight"),L=parseInt(i.headerToListDistance)||0,N=i.arrowData,q=a.debounce(p,100);u(),D(),t(function(){d()}),s();var K,z,R=!1,Y=!1;e.$on("$destroy",function(){A&&n.cancel(A),F&&n.cancel(F)})}return{link:r}}e.$inject=["$window","$timeout","$interval","_","$rootScope"],angular.module("app").directive("scrollAlong",e)}(),function(){"use strict";angular.module("app").directive("tel",["$timeout",function(e){function t(t,n,a){function o(){var t=C.intlTelInput("isValidNumber"),a=""!==C.val(),o=n.attr("required"),r=_.attr("id");a||m(),t||!a&&!o?y[r].$setValidity("",!0):y[r].$setValidity("",!1);var i=C.intlTelInput("getExtension");_.val(C.intlTelInput("getNumber")),y[r].$setViewValue(C.intlTelInput("getNumber")+(i?";ext="+i:"")),l(),g=!0,_.focus(),C.focus(),g=!1,e(function(){C.is(":focus")&&_.parent().addClass("md-input-focused")},100)}function r(){e(function(){_.parent().addClass("md-input-focused"),_.parent().children(".intl-tel-input").removeClass("hide-flag")})}function i(){e(function(){document.activeElement===f[0]||C.is(":focus")||(_.parent().removeClass("md-input-focused"),""===C.val()&&_.parent().children(".intl-tel-input").addClass("hide-flag"))},100)}function s(e,t){t.addClass(e.attr("class"))}function l(){var e=C.intlTelInput("getSelectedCountryData").name;if("United States"===e||"Canada"===e){var t=C.val();3===t.length&&v.isNumeric(t[0])&&v.isNumeric(t[1])&&v.isNumeric(t[2])&&C.val("("+t+") "),10===t.length&&v.isNumeric(t[9])&&"("===t[0]&&")"===t[4]&&" "===t[5]&&C.val(t.substring(0,9)+"-"+t.substring(9)),t.length>14&&v.isNumeric(t[14])&&"("===t[0]&&")"===t[4]&&" "===t[5]&&"-"===t[9]&&C.val(t.substring(0,14)+"  Ext. "+t.substring(14))}}function c(e){if(!g)if(v(e.relatedTarget).is(C)){var t=_.parent().next();t.find("input").length>0?t.find("input")[0].focus():t.next().find("input")[0].focus()}else C.focus()}function u(e){"mousedown"===e.type?h=!0:h?h=!1:v(e.relatedTarget).is(C)?_.parent().prev().find("input")[0].focus():C.focus()}function d(e){e.relatedTarget!==C[0]&&i()}function p(e,t){return e.replace(/[0-9]/g,"#")+" x###"}function m(){var e=window.navigator.userAgent,t=e.indexOf("Trident")!==-1;t&&(_.removeAttr("placeholder"),C.removeAttr("placeholder"))}var f,g,h,v=window.jQuery,_=window.jQuery(n),y=n.inheritedData("$formController"),b=document.createElement("input"),C=v(b);t.$watch("ngModel",function(e,t){e&&!t&&(C.intlTelInput("setNumber",e),_.parent().children(".intl-tel-input").removeClass("hide-flag"))}),e(function(){_.before(b),C.intlTelInput({dropdownContainer:"body",customPlaceholder:p}),s(_,C),_.addClass("intl-tel-hidden"),""!==_.val()?C.intlTelInput("setNumber",_.val()):_.parent().children(".intl-tel-input").addClass("hide-flag"),C.val(C.val().replace("ext. ","x")),C[0].dataset.e2e=a.id+"-input",m(),C.on("focus",r),C.on("blur",i),C.on("input",o),C.on("countrychange",o),_.on("focus",c),f=_.parent().find(".selected-flag"),f.on("focus mousedown",u),f.on("blur",d)})}return{link:t,scope:{tel:"=",ngModel:"="}}}])}(),function(){"use strict";function e(){return function(e){return"Fresh "+e}}angular.module("app").filter("exampleFilter",e)}(),function(){"use strict";function e(moment){return function(e,t){if(!e||""===e)return e;var n="MMM Do, YYYY",a="overdue-date-text",o="upcoming-date-text",r=moment(e).startOf("day"),i=moment(e).format("h:mm a"),s=moment().startOf("day"),l=r.diff(s,"days"),c={0:{output:"Today",dateStyle:o},1:{output:"Tomorrow",dateStyle:o},2:{output:r.format("dddd"),dateStyle:o},3:{output:"Yesterday",dateStyle:a},4:{output:r.format(n),dateStyle:a},7:{output:r.format(n),dateStyle:""}};if(l<-1?l=4:l===-1?l=3:l>1&&l<7?l=2:l>=7&&(l=7),t&&"colorStatus"===t){var u=c[l].dateStyle;return u}if(!t||t&&"dateTime"===t){var d=null;return d=t?c[l].output+" at "+i:c[l].output}return e}}e.$inject=["moment"],angular.module("app").filter("humanDate",e)}(),function(){"use strict";function e(e){return function(t){if(angular.isNumber(t)){var n=e("number")(t,2);return n+"%"}return""}}e.$inject=["$filter"],angular.module("app").filter("humanPercent",e)}(),function(){"use strict";angular.module("app").filter("tel",function(){return function(e){if(!e)return"";var t,n,a,o=e.split(";ext="),r=o[0].replace(/[^\d]/g,"");switch(r.length){case 10:t="",n=r.slice(0,3),a=r.slice(3);break;case 11:t="",n=r.slice(1,4),a=r.slice(4);break;case 13:t=r.slice(0,3),n=r.slice(3,6),a=r.slice(6);break;default:return r}1===t&&(t=""),a=a.slice(0,3)+"-"+a.slice(3);var i="";return o[1]&&(i=" x"+o[1]),(t+" ("+n+") "+a).trim()+i}})}(),function(){"use strict";function e(){return function(e){return e.replace("+1","").replace("ext. ","x")}}angular.module("app").filter("phoneInternational",e)}(),function(){"use strict";function e(e){return function(e){return"Paid"===e.payment_status?e.paid_amount:e.receivable_amount}}e.$inject=["$filter"],angular.module("app").filter("showPaidAmountOrReceivableAmount",e)}(),function(){"use strict";function e(e){return function(t){return t.paid_date?e("date")(t.paid_date,"MM/dd/yyyy"):"Receivable"===t.payment_status?t.numberDaysPastDue+" Days Past Due":""}}e.$inject=["$filter"],angular.module("app").filter("showPaidDateOrDaysPastDue",e)}(),function(){"use strict";function e(){return function(e){return e.replace("_"," ")}}angular.module("app").filter("underscoreToSpaces",e)}(),function(){"use strict";function e(){return function(e){return t(e)}}function t(e){var t=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_+.~#?&\/\/=]*)/gi;return e.replace(t,'<a href="$&" target="_blank">$&</a>')}angular.module("app").filter("userOutput",e)}(),function(){"use strict";function e(){return function(e){return"$0.00"===e?"—":"0.00%"===e?"—":e}}angular.module("app").filter("zeroToMdash",e)}(),function(){"use strict";function e(e,t,n){function a(){return window.localStorage.getItem("JWT")}function o(e){window.localStorage.setItem("JWT",e)}function r(){o(!1)}function i(e){window.localStorage.setItem("lastUrl",e)}function s(){return window.localStorage.getItem("lastUrl")}function l(){return e.initiateLoginUrl+"?next="+encodeURIComponent(e.ssoCallbackUrl)}function c(){var e=n.url();"/unauthorized"===e&&(e="/dashboard"),u.setLastUrl(e),t.location.href=u.getInitiateLoginUrl()}var u={getToken:a,setToken:o,deleteToken:r,setLastUrl:i,getLastUrl:s,getInitiateLoginUrl:l,initiateLogin:c};return u}e.$inject=["env","$window","$location"],angular.module("app").factory("authFactory",e)}(),function(){"use strict";function e(e){function t(n,a){a=a||"";var o=[];return e.each(n,function(n,r){if(e.isArray(n)){var i={key:a+" "+r,value:n};o.push(i)}else e.isObject(n)&&o.push(t(n,r))}),o}function n(n){var a=t(n);return e.flattenDeep(a)}var a={collectErrors:n};return a}e.$inject=["_"],angular.module("app").factory("errorMessageFactory",e)}(),function(){"use strict";function e(e,t,n){function a(t){function a(e){return e.data}function o(e){return n.reject(e)}var r={method:"GET",url:i+"/findAddressCandidates",params:t};return e(r).then(a,o)}function o(t){function a(e){return e.data}function o(e){return n.reject(e)}var r={method:"GET",url:i+"/suggest",params:t};return e(r).then(a,o)}function r(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"GET",url:t.apiUrl+"buildinglookup",params:a};return e(i).then(o,r)}var i="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",s={search:o,buildingLookup:r,findAddress:a};return s}e.$inject=["$http","env","$q"],angular.module("app").factory("esriFactory",e)}(),function(){"use strict";function e(e){function t(){return n()}function n(){return e(function(e,t){setTimeout(function(){e({data:a})},1e3)})}var a=["components","are","fresh"],o={getData:t};return o}e.$inject=["$q"],angular.module("app").factory("exampleFactory",e)}(),function(){"use strict";function e(){function e(){return[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}]}function t(){return"(\\d{5}-\\d{4}|\\d{5})"}var n={getStates:e,getZipCodePattern:t};return n}angular.module("app").factory("formFactory",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s){function l(e){if(e&&e.url&&e.url.indexOf(i.apiUrl)!==-1){var n=t.getToken();n&&(e.headers.Authorization="JWT "+n),e.headers.Platform=s.getMobileOperatingSystem()}return e}function c(a){var s=o.get("$mdDialog");return"5"===a.status.toString()[0]&&n.debug("There was a server error."),400===a.status&&n.debug("Bad Request"),401===a.status&&(n.debug(a),t.initiateLogin()),403===a.status&&a.config.url!==i.apiUrl+"mbb/attachments"&&(n.debug(a),a.config.url===i.apiUrl+"user"?r.go("unauthorized"):s.show({controller:"ErrorModal",controllerAs:"vm",templateUrl:"shared/error-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{message:"Unauthorized",status:"403"}})),404===a.status&&(n.debug(a),a.config.url.indexOf("api/mbb/deals/")>-1?r.go("app.dashboard"):s.show({controller:"ErrorModal",controllerAs:"vm",templateUrl:"shared/error-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{message:"This item no longer exists, please reload the page.",status:"404"}})),e.reject(a)}var u={request:l,responseError:c};return u}e.$inject=["$q","authFactory","$log","$window","$injector","$state","env","platformFactory"],angular.module("app").factory("HttpInterceptFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(e){p||(t.log("Starting infinite scroll listener."),d=a[0].querySelector(e),d.addEventListener("scroll",s),n.addEventListener("resize",s),p=!0)}function r(){p&&(t.log("Ending infinite scroll listener."),d.removeEventListener("scroll",s),n.removeEventListener("resize",s),p=!1)}function i(){l=d.scrollTop,u=d.clientHeight,c=d.scrollHeight;var e=l+u,t=e/c;return t>m}function s(n){var a=i();a&&(t.log("Near bottom of page."),e.$emit("loadMoreContent"))}var l,c,u,d,p=!1,m=.965,f={startScrollListener:o,destroyScrollListener:r};return f}e.$inject=["$rootScope","$log","$window","$document"],angular.module("app").factory("infiniteScrollFactory",e)}(),function(){"use strict";function e(e,t){function n(n){var a={app_id:e.intercomAppID,name:n.first_name+" "+n.last_name,user_id:n.employee_id,widget:{activator:"#IntercomSupport"},hide_default_launcher:!0};n.avatar&&(a.avatar={type:"avatar",image_url:n.avatar}),n.work_email&&(a.email=n.work_email),n.title&&(n.job_title=n.title),t.Intercom("boot",a)}var a={init:n};return a}e.$inject=["env","$window"],angular.module("app").factory("intercomFactory",e)}(),function(){"use strict";function e(e){function t(t,n){e.localStorage.setItem(t,JSON.stringify(n))}function n(t){var n=e.localStorage.getItem(t);if("undefined"!==n)return JSON.parse(n)}var a={save:t,get:n};return a}e.$inject=["$window"],angular.module("app").factory("localStorageFactory",e)}(),function(){"use strict";function e(e){function t(){return!!a&&a.join(",")}function n(){function n(e){if(e&&e.coords){var n=e.coords.longitude,o=e.coords.latitude;a=[n,o],r.resolve(t())}}function o(e){r.reject(e)}var r=e.defer();if(a)r.resolve(t());else{var i=window.navigator;i.geolocation?i.geolocation.getCurrentPosition(n,o):r.reject("Geolocation not supported.")}return r.promise}var a,o={locate:n,getCoordinatesString:t};return o}e.$inject=["$q"],angular.module("app").factory("locationFactory",e)}(),function(){"use strict";function e(e){function t(n,a){var o=[],r=e.keys(n);return e.each(r,function(e){var r=n[e],i=a?a+"."+e:e;o.push(i),"object"==typeof r&&o.push(t(r,i))}),o=e.flattenDeep(o)}function n(t,n){var a={};return e.each(t,function(t){var o=e.get(n,t);void 0!==o&&e.set(a,t,o)}),a}function a(t,n){var a=e.reduce(n,function(n,a,o){var r=e.isEqual(a,t[o]);return r?n:n.concat(o)},[]);return a=e.reduce(t,function(t,a,o){var r=e.isEqual(a,n[o]);return r||t.indexOf(o)!==-1?t:t.concat(o)},a)}function o(e,t){var n=a(e,t),o={};if(n.length>0)for(var r in n){var i=n[r],s=t[i];void 0===s||null===s||"number"==typeof s&&isNaN(s)?o[i]=null:o[i]=s}return o}var r={getKeysDeep:t,pickDeep:n,getChangedProps:a,diffObject:o};return r}e.$inject=["_"],angular.module("app").factory("loscoreFactory",e)}(),function(){"use strict";function e(){function e(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"windows":/android/i.test(e)?"android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"web"}var t={getMobileOperatingSystem:e};return t}angular.module("app").factory("platformFactory",e)}(),function(){"use strict";function e(e){function t(){var t=null,n=window.innerWidth;window.onresize=function(){e.$emit("onresize"),null!==t&&clearTimeout(t),t=setTimeout(function(){var e=window.innerWidth;e!==n&&(n=e)},400)},window.onorientationchange=function(){e.$emit("onorientationchange")}}var n={init:t};return n}e.$inject=["$rootScope"],angular.module("app").factory("resizeFactory",e)}(),function(){"use strict";function e(e,t){function n(n,a){var o=t.pickDeep(a,n),r=t.getKeysDeep(n),i=t.getKeysDeep(o),s=e.difference(r,i);return s.length>0,o}function a(t,n){var a=e.pick(t,n),o=e.difference(e.keys(t),e.keys(a));return o.length>0,a}var o={deepSanitize:n,sanitize:a};return o}e.$inject=["_","loscoreFactory"],angular.module("app").factory("sanitizeFactory",e)}(),function(){"use strict";function e(){function e(e){return t[e]?t[e]:e}var t={Alabama:"AL",Alaska:"AK",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE",Florida:"FL",Georgia:"GA",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Pennsylvania:"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT",Virginia:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY","District of Columbia":"DC",Guam:"GU","Marshall Islands":"MH","Northern Mariana Islands":"MP",Palau:"PW","Puerto Rico":"PR","Virgin Islands":"VI"},n={abbreviate:e};return n}angular.module("app").factory("stateAbbreviatorFactory",e)}(),function(){"use strict";function e(e,t){function n(){var n=window.localStorage.getItem("JWT");if(null!==n)return s=new window.WebSocket(e.websocketUrl+"user?token=JWT "+n),s.onmessage=function(e,n){var a=JSON.parse(e.data),o=a.variety,r=a.object,i=l[o];i&&i.length>0?i.forEach(function(e){e(r)}):t.warn("Websocket received for '"+o+"' but no listeners are registered.")},s}function a(e,t){void 0===l[e]?l[e]=[t]:l[e].push(t)}function o(e,t){for(var n in l[e])t&&l[e][n]===t&&delete l[e][n];t&&0!==l[e].length||delete l[e]}function r(e){return e?l[e]?l[e]:[]:l}function i(){return s}var s,l={},c={connect:n,getWebsocket:i,onmessage:a,getListeners:r,removeListener:o};return c}e.$inject=["env","$log"],angular.module("app").factory("websocketFactory",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,moment,l,c,u,d,p,m){function f(){if($.isGlobal){var e={page_size:k};g(e),0===d.getListeners("alert").length&&d.onmessage("alert",function(e){C(String(e.id)),$.alerts.push(e),o.$emit("alertsReceived",{results:[e],count:$.alerts.length})}),1!==d.getWebsocket().readyState&&void 0===D&&(D=r(function(){f()},6e4,60)),1===d.getWebsocket().readyState&&D&&r.cancel(D)}}function g(t){e.getAlerts(t).then(function(e){$.alerts=e.results,o.$emit("alertsReceived",e)})}function h(e,t){var n;n=t?y(e):e,(n.length>0||t===!1)&&(w=!0,l.show({controller:"AlertsPopupCtrl",templateUrl:"alerts/alerts-popup.tpl.html",controllerAs:"vm",hasBackdrop:!1,disableParentScroll:!1,skipHide:!0,openFrom:"#alert-icon",closeTo:"#alert-icon",parent:angular.element(document.body),locals:{alerts:n,filterSeen:t}}).then(function(){w=!1},function(){w=!1}),u(function(){T()}),m.addEventListener("resize",s.debounce(T,10)))}function v(e){return e.filter(function(e){return 0===$.alerts.filter(function(t){return e.id===t.id}).length})}function _(){var e=window.localStorage.getItem("seenAlerts");return null===e?[]:e.split(",")}function y(e){var t=_(),n=angular.copy(t),a=e.filter(function(e){return t.indexOf(String(e.id))===-1&&(n.push(String(e.id)),!0)});return b(n),a}function b(e){window.localStorage.setItem("seenAlerts",e.join(","))}function C(e){var t=_(),n=t.indexOf(e);n!==-1&&(t.splice(n,1),b(t))}function T(){if(document.getElementById("alerts-popup")){var e=document.getElementById("alerts-popup").parentElement;e.style.alignItems="flex-start",c("xs")?(e.style.paddingTop="4rem",e.style.width="100%",e.style.left="0"):(e.style.paddingTop="2rem",e.style.right="1rem",e.style.left="auto",e.style.width="26rem")}}var D,$=this,k=25,w=!1;$.userOptions=t.getUserOptions();var S=null;n.fetchUser().then(function(e){S=e}),$.$onChanges=function(){f()},i.$on("$destroy",function(){r.cancel(D)}),$.snooze=function(t,n){var r=t.id,i=moment();"hour"===n?i.add(1,"hour"):"day"===n?i.add(1,"day"):"week"===n&&i.add(1,"week");var s={alert_datetime:i.toISOString(),seen:!1};e.updateAlert(r,s).then(function(e){o.$emit("alertDismissed",e),a.show(a.simple().textContent("Snoozed for 1 "+n).position("bottom center").hideDelay(3e3))})},$.dismiss=function(t){var n=t.id,r={dismissed:!0};e.updateAlert(n,r).then(function(e){o.$emit("alertDismissed",e),a.show(a.simple().textContent("Alert dismissed").position("bottom center").hideDelay(3e3))})},$.openTask=function(e,t){e.openingTask=!0;var n=e.object_id;p.getTask(n).then(function(n){delete e.openingTask,l.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,skipHide:!0,locals:{task:angular.copy(n),edit:!0,hideDeal:!1,userData:S}}).then(function(e){p.updateTask(n.id,n,e)})})},o.$on("alertDismissed",function(e,t){var n=s.findIndex($.alerts,function(e){return e.id===t.id});n>-1&&$.alerts.splice(n,1),C(String(t.id))}),o.$on("alertDismissedAll",function(e,t){$.alerts=[],C(String(t.id))}),o.$on("alertsReceived",function(e,t){if($.isGlobal)w||h(t.results,!0);else{var n;n=$.filterSeen?y(t.results):t.results,n=v(n),$.alerts=$.alerts.concat(n)}}),o.$on("alertsOpenPopup",function(e){$.isGlobal&&(w?l.hide():h($.alerts,!1))})}e.$inject=["alertsFactory","userOptionsFactory","userFactory","$mdToast","$rootScope","$interval","$scope","_","moment","$mdDialog","$mdMedia","$timeout","websocketFactory","tasksFactory","$window"],angular.module("app").component("alertsPanel",{templateUrl:"alerts/alerts-panel.tpl.html",
controller:e,bindings:{isGlobal:"<",alerts:"<",filterSeen:"<"}})}(),function(){"use strict";function e(e,t,n,a,o){var r=this;r.alerts=n,r.dismissAll=function(){a.dismissAlerts().then(function(e){o.$emit("alertDismissedAll",e),t.show(t.simple().textContent("Alert dismissed").position("bottom center").hideDelay(3e3))})},r.cancel=function(){e.cancel()}}e.$inject=["$mdDialog","$mdToast","alerts","alertsFactory","$rootScope"],angular.module("app").controller("AlertsPopupCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o){var r=this;r.files=e,r.privacy=e[0].privacy?e[0].privacy:"team",r.max=100,r.progress=40,r.uploading=!1,r.humanFileName=e[0].title?e[0].title:"";var i={hidePermissionOptions:!1};r.options=o.merge({},i,a),r.cancel=function(){t.cancel()},r.upload=function(){var e={};r.files[0].deal?(e={title:r.humanFileName,privacy:r.privacy,updateFiles:r.updateFiles},t.hide(e)):(r.uploading=!0,e={deal:n.id,document_name:r.files[0].name,privacy:r.privacy},r.humanFileName.length>0&&(e.title=r.humanFileName),t.hide(e))}}e.$inject=["files","$mdDialog","deal","options","_"],angular.module("app").controller("DealPanelAttachmentsModal",e)}(),function(){"use strict";function e(e){}e.$inject=["$scope"],angular.module("app").component("dealPanelAttachmentsUploadToast",{controller:e,templateUrl:"attachments/deal-panel-attachments-upload-toast.tpl.html"})}(),function(){"use strict";function e(e,t,n,a,o,r){function i(){var e={deal:c.deal.id,page_size:999,page:1,ordering:"-modified",is_lease_document:!1};t.getAttachments(e).then(function(e){c.attachments=e})}function s(){u=e.$watch("$ctrl.files",function(){if(c.files&&c.files.length>0){var e={};n.show({controller:"DealPanelAttachmentsModal",templateUrl:"attachments/deal-panel-attachments-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{files:c.files,deal:c.deal,getAttachments:i,options:e}}).then(function(e){o.$emit("uploadAttachment",{fileData:e,files:c.files,callback:i})})}})}function l(){u()}var c=this;e.progress=null;var u;c.attachments=[],c.$onInit=function(){s()},c.$onDestroy=function(){l()},c.$onChanges=function(e){e.deal.currentValue&&i()},c.download=function(e,n){t.getAttachmentFile(e,n)},c.delete=function(e){var o=n.confirm({title:"Are you sure?",textContent:"This attachment will be deleted permanently",ok:"Delete",cancel:"Cancel"});n.show(o).then(function(){t.deleteAttachment(e).then(function(){i(),a.show(a.simple().textContent("Attachment deleted").position("bottom center").hideDelay(3e3))})})},c.edit=function(e){var t=angular.copy(e),a={};n.show({controller:"DealPanelAttachmentsModal",templateUrl:"attachments/deal-panel-attachments-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{files:[e],deal:c.deal,getAttachments:i,options:a}}).then(function(e){var n={};r.isEqual(t.privacy,e.privacy)||(n.privacy=e.privacy),r.isEqual(t.title,e.title)||(n.title=e.title),e.updateFiles&&(n.document_name=e.updateFiles[0].name),n.id=t.id,o.$emit("uploadAttachment",{fileData:n,files:e.updateFiles,edit:!0,callback:i})})}}e.$inject=["$scope","attachmentsFactory","$mdDialog","$mdToast","$rootScope","_"],angular.module("app").component("dealPanelAttachments",{templateUrl:"attachments/deal-panel-attachments.tpl.html",controller:e,bindings:{deal:"<",collapsed:"<",onClose:"&",closable:"<"}})}(),function(){"use strict";function e(e,t,n){function a(e){var a=t.simple().textContent("Unfavorited Deal").position("bottom center").action("UNDO").hideDelay(8e3).highlightAction(!0).highlightClass("md-primary"),r=n.findIndex(i.deals,function(t){return t.id===e.id});i.deals.splice(r,1),o(),t.show(a).then(function(t){"ok"===t&&i.favoriteDeal(e,r)})}function o(){var t={favorited:!0,is_archived:!1,page_size:1e3,ordering:"name"};e.getDeals(t).then(r)}function r(e){i.deals=e.results,i.isLoading=!1}var i=this;i.isLoading=!0,i.$onInit=function(){o()},i.unFavoriteDeal=function(t){e.unFavoriteDeal(t.id).then(function(){a(t)})},i.favoriteDeal=function(t,n){e.favoriteDeal(t.id).then(function(){i.deals.splice(n,0,t),o()})}}e.$inject=["dealsFactory","$mdToast","_"],angular.module("app").component("dealListDashboard",{templateUrl:"deals/deal-list-dashboard.tpl.html",controller:e})}(),function(){"use strict";function e(){var e=this;e.activeDialogChange=function(){var t={active_dialog:e.deal.active_dialog};e.onUpdate({data:t})}}angular.module("app").component("dealPanelActiveDialog",{templateUrl:"deals/deal-panel-active-dialog.tpl.html",controller:e,bindings:{deal:"<",onUpdate:"&"}})}(),function(){"use strict";function e(e){function t(){var e={conversion_potential:n.deal.conversion_potential};n.onUpdate({data:e})}var n=this,a=e.debounce(t,250);n.updatePercentage=function(e){a()}}e.$inject=["_"],angular.module("app").component("dealPanelConversionPotential",{templateUrl:"deals/deal-panel-conversion-potential.tpl.html",controller:e,bindings:{deal:"<",onUpdate:"&"}})}(),function(){"use strict";function e(moment,e,t){var n,a=this;a.openEstCloseDateDialog=!1,e.$on("restoreDateEstClose",function(){a.showErrorMessage=!0,a.deal.date_est_close=n}),a.deal.date_est_close&&(a.deal.date_est_close=moment(a.deal.date_est_close).toDate(),n=t.clone(a.deal.date_est_close))}e.$inject=["moment","$scope","_"],angular.module("app").component("dealPanelDateClose",{templateUrl:"deals/deal-panel-date-close.tpl.html",controller:e,bindings:{deal:"<"}})}(),function(){"use strict";function e(){var e=this;e.leaseType="renewal"}angular.module("app").component("dealPanelDealTypeRepRole",{templateUrl:"deals/deal-panel-deal-type-rep-role.tpl.html",controller:e,bindings:{deal:"<"}})}(),function(){"use strict";function e(){var e=this;e.leaseType="renewal"}angular.module("app").component("dealPanelLeaseType",{templateUrl:"deals/deal-panel-lease-type.tpl.html",controller:e,bindings:{deal:"<"}})}(),function(){"use strict";function e(){var e=this;e.update=function(t){var n={};n[t]=!e.deal[t],e.onUpdate({data:n})}}angular.module("app").component("dealPanelProgress",{templateUrl:"deals/deal-panel-progress.tpl.html",controller:e,bindings:{deal:"<",onUpdate:"&"}})}(),function(){"use strict";function e(){var e=this;e.change=function(){var t={deal_life_cycle_stage:e.deal.deal_life_cycle_stage};e.onUpdate({data:t})}}angular.module("app").component("dealPanelStatus",{templateUrl:"deals/deal-panel-status.tpl.html",controller:e,bindings:{deal:"<",onUpdate:"&"}})}(),function(){"use strict";function e(e,t,n,a,o){var r=this;r.selectedTag=null,r.keys=[o.KEY_CODE.COMMA,o.KEY_CODE.SPACE,o.KEY_CODE.TAB,o.KEY_CODE.ENTER],r.save=function(){var t;r.deal.tags&&(t={deal:r.deal.id,tags:r.deal.tags},e.updateTags(t))},r.search=function(n){var o=t.defer();return e.getTags().then(function(e){var t=a.difference(e.tags_on_all_deals,r.deal.tags);t=a.filter(t,function(e){return e.indexOf(n.toLowerCase())>-1}),o.resolve(t)}),o.promise},r.updateTags=function(){e.updateTags(r.deal.id,r.deal.tags)}}e.$inject=["tagsFactory","$q","dealsFactory","_","$mdConstant"],angular.module("app").component("dealPanelTags",{templateUrl:"deals/deal-panel-tags.tpl.html",controller:e,bindings:{deal:"<"}})}(),function(){"use strict";function e(e,t,n){var a=this;a.deal=t,a.cancel=function(){e.cancel()},a.ok=function(){return a.deal.user_wants_salesforce_export&&!a.deal.date_est_close?void n.$broadcast("restoreDateEstClose"):void e.hide(a.deal)}}e.$inject=["$mdDialog","deal","$scope"],angular.module("app").controller("DealStatusModal",e)}(),function(){"use strict";function e(e,t){var n=this;n.cancel=function(){e.cancel()},n.archiveDeal=function(){n.deal.is_archived=!0,n.deal.is_archived===!0&&t(function(){e.hide("archive-deal")},1e3)},n.deleteDeal=function(){e.hide("delete-deal")}}e.$inject=["$mdDialog","$timeout"],angular.module("app").controller("DeleteDealModal",e)}(),function(){"use strict";angular.module("app").component("maskerDeal",{templateUrl:"deals/masker-deal.tpl.html"})}(),function(){"use strict";function e(e,t,moment){var n=this,a=angular.copy(t);if(a.date_est_close){var o=moment(a.date_est_close);a.date_est_close=o.toDate()}n.deal=a,n.error={},n.isCalendarOpen=!1,n.cancel=function(){e.cancel()},n.ok=function(){var t={user_wants_salesforce_export:!0};"prospect"!==n.deal.deal_life_cycle_stage&&"executing"!==n.deal.deal_life_cycle_stage||(n.deal.date_est_close?(t.date_est_close=n.deal.date_est_close,e.hide(t)):n.error.dateEstClose=!0),"closed"===n.deal.deal_life_cycle_stage&&e.hide(t)}}e.$inject=["$mdDialog","deal","moment"],angular.module("app").controller("SalesforceModal",e)}(),function(){"use strict";function e(e,t,n,a){function o(){i()}function r(){var e=[];for(var t in s.selectedColumnKeys)null!==s.selectedColumnKeys[t]&&e.push(s.selectedColumnKeys[t]);return e}function i(){a.forEach(n,function(e,t){s.selectedColumnKeys[t]=e})}var s=this;s.possibleColumnKeys=t,s.selectedColumnKeys={},s.ok=function(){var t=r();e.hide(t)},s.cancel=function(){e.cancel()},s.selectChanged=function(e){var t,n,a,o=s.selectedColumnKeys[e];for(t in s.selectedColumnKeys)a=o===s.selectedColumnKeys[t],n=parseInt(e)!==parseInt(t),a&&n&&(s.selectedColumnKeys[t]=null)},o()}e.$inject=["$mdDialog","possibleColumnKeys","savedColumnKeys","_"],angular.module("app").controller("DealsListCustomizeModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a){var o=this;o.$onInit=function(){function e(){o.panelChange=[]}a.$watch("$ctrl.selectedAction",e),a.$watch("$ctrl.data",e)}}e.$inject=["notesFactory","$element","$timeout","$scope"],angular.module("app").component("flexTablePanel",{templateUrl:"flex-table/flex-table-panel.tpl.html",controller:e,bindings:{selectedAction:"<",data:"<",onClose:"&"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i,moment,s,l,c,u){function d(e){var t=[];return s.forEach(m.columnDefs,function(n,a){s.indexOf(n.stages,e)!==-1&&n.selectable&&t.push({key:a,label:n.displayName})}),t}function p(t){e.show(e.simple().textContent(t).position("bottom center").hideDelay(3e3))}var m=this;m.userOptions=o.getUserOptions(),m.$onInit=function(){m.savedColumnKeys=o.getTableKeys(m.options.columnKey);var e=m.userOptions.feature_flags.tags_feature_flag;m.sortingKeys={default:{sortingKey:m.params.ordering,displayName:"Recent"},prospect:{deals_asc:{sortingKey:"name",displayName:"Deals (A - Z)"},deals_desc:{sortingKey:"-name",displayName:"Deals (Z - A)"},recent:{sortingKey:"-modified",displayName:"Recent"},oldest:{sortingKey:"modified",displayName:"Oldest"},high:{sortingKey:"-conversion_potential",displayName:"Conv. Potential (High - Low)"},low:{sortingKey:"conversion_potential",displayName:"Conv. Potential (Low - High)"}},executing:{deals_asc:{sortingKey:"name",displayName:"Deals (A - Z)"},deals_desc:{sortingKey:"-name",displayName:"Deals (Z - A)"},recent:{sortingKey:"-modified",displayName:"Recent"},oldest:{sortingKey:"modified",displayName:"Oldest"}},closed:{deals_asc:{sortingKey:"name",displayName:"Deals (A - Z)"},deals_desc:{sortingKey:"-name",displayName:"Deals (Z - A)"},recent:{sortingKey:"-modified",displayName:"Recent"},oldest:{sortingKey:"modified",displayName:"Oldest"},recent_close_date:{sortingKey:"-date_approved",displayName:"Close Date (Recent)"},oldest_close_date:{sortingKey:"date_approved",displayName:"Close Date (Oldest)"}}},m.columnDefs={deals:{paramKey:null,sortPredicate:"deals",displayName:"Deals",componentType:null,selectable:!1,stages:["prospect","executing","closed"]},date_close:{paramKey:"date_approved",sortPredicate:"date_approved",displayName:"Close Date",componentType:"date_read_only",selectable:!0,defaultSortOrder:"desc",stages:["closed"]},conversion_potential:{paramKey:"conversion_potential",sortPredicate:"conversion_potential",displayName:"Conv. Potential",componentType:"percentage",selectable:!0,defaultSortOrder:"desc",stages:["prospect"]},current_properties:{paramKey:"current_properties",displayName:"Current Address",sortPredicate:null,componentType:"address",selectable:!0,defaultSortOrder:"desc",stages:["prospect","executing"]},final_properties:{paramKey:"final_properties",displayName:"Final Address",sortPredicate:"final_space_address",componentType:"address",selectable:!0,defaultSortOrder:"desc",stages:["closed"]},tags:{paramKey:"tags",displayName:"Tags",sortPredicate:null,componentType:"tags",selectable:!0,defaultSortOrder:"asc",stages:["prospect","closed","executing"]},occupancy_date:{paramKey:"occupancy_date",displayName:"Occupancy Date",sortPredicate:null,componentType:"occupancy_date",selectable:!0,defaultSortOrder:"asc",stages:["prospect","executing"]},rep_role:{paramKey:"rep_role",displayName:"Rep. Role",sortPredicate:"rep_role",componentType:"text",selectable:!0,defaultSortOrder:"asc",stages:["closed"]},deal_progress:{paramKey:"deal_progress",displayName:"Progress",sortPredicate:null,componentType:"text",selectable:!0,defaultSortOrder:"asc",stages:["executing"]},date_est_close:{paramKey:"date_est_close",displayName:"Est. Close Date",sortPredicate:"date_est_close",componentType:"date",selectable:!0,defaultSortOrder:"asc",stages:["prospect","executing"]},sqft_range:{sortPredicate:null,displayName:"SQFT Range",selectable:!0,defaultSortOrder:"desc",stages:["prospect","executing"]},total_current_sqft:{paramKey:"total_current_sqft",sortPredicate:"total_current_sqft",componentType:"number",displayName:"Total Current SQFT",selectable:!0,defaultSortOrder:"asc",stages:["prospect","executing"]},total_final_sqft:{paramKey:"total_final_sqft",sortPredicate:"total_final_sqft",componentType:"number",displayName:"Total Final SQFT",selectable:!0,defaultSortOrder:"asc",stages:["closed"]},lease_expiration_date:{paramKey:"leaseExpirationDate",sortPredicate:null,componentType:"date_read_only",displayName:"Lease Expiration Date",selectable:!0,stages:["prospect","executing"]},date_lease_from:{paramKey:"date_lease_from",sortPredicate:null,componentType:"date_read_only",displayName:"Lease From",selectable:!0,stages:["closed"]},date_lease_to:{paramKey:"date_lease_to",sortPredicate:null,componentType:"date_read_only",displayName:"Lease To",selectable:!0,stages:["closed"]}},e===!1&&s.unset(m.columnDefs,"tags")},m.switchPage=function(e){var t={};t.page=e,m.onGetDeals({params:t})},m.sortDeals=function(e){var t={};t.ordering=e,t.page=1,m.onGetDeals({params:t})},m.updateDeal=function(e,t){n.updateDeal(e,t).then(function(){m.showConfirmation()})},m.showArchivedChange=function(e){e?m.params.is_archived=!0:m.params.is_archived=!1,m.onGetDeals()},m.showSyncedSalesforceChange=function(e){e?m.params.user_wants_salesforce_export=!0:m.params.user_wants_salesforce_export=null,m.onGetDeals()},m.filterByConversionPotential=function(e){var t={};t.page=1,t.conversion_potential_min=e.conversion_potential_min,t.conversion_potential_max=e.conversion_potential_max,m.onGetDeals({params:t})},m.updateDateCloseMin=function(e){e?m.params.date_approved_min=moment(e).format("YYYY-MM-DD"):m.params.date_approved_min=null,m.onGetDeals()},m.updateDateCloseMax=function(e){e?m.params.date_approved_max=moment(e).format("YYYY-MM-DD"):m.params.date_approved_max=null,m.onGetDeals()},m.updateRequirements=function(e,t){a.updateRequirements(e,t).then(function(){m.showConfirmation()})},m.addRequirements=function(e){a.addRequirements(e).then(function(e){var t=s.findIndex(m.deals.results,{id:e.deal}),n=m.deals.results[t];n.requirements=e,m.showConfirmation()})},m.showConfirmation=function(){e.show(e.simple().textContent("Updated deal").position("bottom center").hideDelay(3e3))},m.openContactModal=function(e,n,a){function o(e){function t(e){p("Contact updated"),r(e)}function n(){p("Contact update failed")}function a(e){p("Contact added"),r(e)}function o(){p("Contact add failed")}function r(e){m.onGetDeals()}e.id?l.updateContact(e.id,e).then(t,n):l.addContact(e).then(a,o)}var r,i={};r=n?l.transformContactAddresses(n):l.createEmptyContact(e.id,{is_primary:!0}),t.show({controller:"ContactModalInstanceCtrl",templateUrl:"contacts/contact-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{contact:r,initAction:a,contactFormOptions:i}}).then(o)},m.openDialog=function(e){t.show({controller:"DealsListCustomizeModalInstanceCtrl",templateUrl:"flex-table/deals-list-customize-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{possibleColumnKeys:d(m.options.dealStage),savedColumnKeys:m.savedColumnKeys}}).then(function(e){o.update(m.options.columnKey,e),m.savedColumnKeys=e},function(){})},m.openPanel=function(e,t){var n=u.getUser(),a={button:t};c.addUserEvent(n.id,"quick_access_button_clicked",a),m.selectedAction=t,m.selectedDeal=e},m.closePanel=function(){m.selectedAction=null,m.selectedDeal=null},r.$on("contacts",function(e,t){if("flexTable"!==t.component){var n=t.contact,a=t.deal,o=t.action,r=s.find(m.deals.results,function(e){return e.id===a});r.primary_deal_contact&&r.primary_deal_contact.id===n.id&&(n.is_primary||(r.primary_deal_contact=null)),"edit"===o||"create"===o?n.is_primary&&(r.primary_deal_contact=n):"delete"===o&&n.is_primary&&(r.primary_deal_contact=null)}})}e.$inject=["$mdToast","$mdDialog","dealsFactory","requirementsFactory","userOptionsFactory","$rootScope","$window","moment","_","contactsFactory","userEventsFactory","userFactory"],angular.module("app").component("flexTable",{templateUrl:"flex-table/flex-table.tpl.html",controller:e,bindings:{options:"<",params:"<",deals:"<",emptyState:"<",loading:"<",onGetDeals:"&",onManageExecuting:"&"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i){function s(){_.givenNameSearchText=null,_.givenNameSelectedItem=null,_.surnameSelectedItem=null,_.surnameSearchText=null,_.disableGivenNameAutocomplete=!0,_.disableSurnameAutocomplete=!0}function l(){var t={work:2,home:2,mobile:1},n={work:0,home:0,mobile:0};e.each(_.contact.phone_numbers,function(e){n[e.type]++});for(var a in _.isPhoneListFull)n[a]>=t[a]?_.isPhoneListFull[a]=!0:_.isPhoneListFull[a]=!1}function c(){var t={business_address:0,home_address:0,other_address:0};e.each(_.contact.addresses,function(e){t[e.type]++});for(var n in _.isAddressListFull)t[n]>0?_.isAddressListFull[n]=!0:_.isAddressListFull[n]=!1}function u(e,t){if(0!==e.length)if(1===e.length)e[0].default=!0;else for(var n=0;n<e.length;n++)if(e[n][t]&&e[n][t].length>0){e[n].default=!0;break}}function d(){return e.findIndex(_.contact.phone_numbers,function(e){return e.default===!0})}function p(){e.each(_.contact.phone_numbers,function(e,t){t===_.defaultPhone?e.default=!0:e.default=!1})}function m(){return e.findIndex(_.contact.email_addresses,function(e){return e.default===!0})}function f(){e.each(_.contact.email_addresses,function(e,t){t===_.defaultEmail?e.default=!0:e.default=!1})}function g(t){return e.each(t.addresses,function(n){var a=angular.copy(n),o=a.type,r=!0;e.unset(a,"type"),e.forIn(a,function(t,n){e.isEmpty(t)||(r=!1)}),r||(t[o]=a)}),t}function h(){var e=r.$on("onContactSelected",function(){_.autofocusPhone={},_.autofocusEmail={},v()});r.$on("$destroy",e)}function v(){_.initAction&&_.initAction.action&&_.initAction.type&&("phone"===_.initAction.action?_.addPhone(_.initAction.type):"email"===_.initAction.action?_.addEmail(_.initAction.type):"address"===_.initAction.action?_.addAddress(_.initAction.type):"none"===_.initAction.action,_.initAction=null)}var _=this,y=null,b={showPrimaryDealCheckbox:!0,enableAddToPersonalCheckbox:!0,hideAddToPersonalCheckbox:!1};_.userOptions=i.getUserOptions(),_.popoverMsg={title:"Contacts",text:"Manage contacts independent of your deals by adding them to your Deal IQ Contacts list accessible from the main navigation."},_.opts={},_.searchText="",_.isPhoneSelectOpen={},_.isPhoneListFull={work:!1,home:!1,mobile:!1},_.isAddressSelectOpen={},_.isAddressListFull={business_address:!1,home_address:!1,other_address:!1},_.defaultPhone=null,_.defaultEmail=null,_.autofocusPhone={},_.autofocusEmail={},_.autofocusAddress={},_.focusTimeout=parseInt(_.focusTimeout)||0,_.cache=!0,_.givenNameSelectedItem=null,_.givenNameSearchText="",_.surnameSelectedItem=null,_.surnameSearchText="",_.disableGivenNameAutocomplete=!1,_.disableSurnameAutocomplete=!1,_.disableEmailAutocomplete=!1,_.$onInit=function(){v(),h()},_.$onChanges=function(t){_.opts=e.merge({},b,_.options),t.contact&&t.contact.currentValue&&(_.contact=e.cloneDeep(t.contact.currentValue),t.contact.currentValue.id?(_.disableGivenNameAutocomplete=!0,_.disableSurnameAutocomplete=!0):(_.disableGivenNameAutocomplete=!1,_.disableSurnameAutocomplete=!1,_.selectedClient=null),_.contact.company&&(_.selectedClient=_.contact.company),_.defaultPhone=d(),_.defaultEmail=m(),l(),c()),t.initAction&&t.initAction.currentValue&&_.$onInit()},_.querySearch=function(e){y?(y.resolve(),y=o.defer()):y=o.defer();var t={search:e,page_size:10},n={timeout:y.promise},r=o.defer();return a.getClients(t,n).then(function(e){_.clients=e,r.resolve(e),y=null}),r.promise},_.submitContactForm=function(){_.selectedClient&&_.selectedClient.id?_.contact.company=_.selectedClient.id:_.searchText.length>0?_.contact.company={name:_.searchText}:_.contact.company=null,f(),p();var t=e.cloneDeep(_.contact);t=g(t),_.onSave({contact:t})},_.addPhone=function(e){_.contact.phone_numbers.unshift({number:null,type:e,default:!!(_.contact.phone_numbers.length<1)}),_.defaultPhone=d(),n(function(){_.autofocusPhone[0]=!0},_.focusTimeout),l()},_.addEmail=function(e){_.contact.email_addresses.unshift({address:null,type:e,default:!!(_.contact.email_addresses.length<1),name:""}),_.defaultEmail=m(),n(function(){_.autofocusEmail[0]=!0},_.focusTimeout)},_.addAddress=function(e){_.contact.addresses.unshift({type:e,street:"",city:"",state:"",countryOrRegion:"",postalCode:""}),n(function(){_.autofocusAddress[0]=!0},_.focusTimeout),c()},_.removeAddress=function(t){e.remove(_.contact.addresses,function(e){return t===e}),c()},_.removePhone=function(t){var n=t.default;e.remove(_.contact.phone_numbers,function(e){return t===e}),n&&u(_.contact.phone_numbers,"number"),_.defaultPhone=d(),l()},_.removeEmail=function(t){var n=t.default;e.remove(_.contact.email_addresses,function(e){return t===e}),n&&u(_.contact.email_addresses,"address"),_.defaultEmail=m()},_.onPhoneTypeSelectClose=function(e){_.isPhoneSelectOpen[e]=!1,l()},_.onAddressTypeSelectClose=function(e){_.isAddressSelectOpen[e]=!1,c()},_.contactQuerySearch=function(e){var n={search:e};return t.getContacts(n).then(function(e){return e.results})},_.itemChanged=function(n){if(n){t.hasPersonalContact(n.id).then(function(t){var n=0===t.data.has_personal_contact;_.opts=e.merge(_.opts,{enableAddToPersonalCheckbox:n}),n||(_.contact.create_personal_contact=!1)});var a=_.contact.deal,o=_.contact.is_primary;_.contact=e.cloneDeep(n),_.contact.company&&(_.selectedClient=_.contact.company),_.contact.deal=a,_.contact.is_primary=o,_.contact.id=null,_.defaultEmail=m(),_.defaultPhone=d(),l(),s()}},_.firstBlur=function(e){"given_name"===e?(_.contact.given_name=_.givenNameSearchText,_.givenNameSearchText=null):"surname"===e&&(_.contact.surname=_.surnameSearchText,_.surnameSearchText=null),_.disableGivenNameAutocomplete=!0,_.disableSurnameAutocomplete=!0},_.keyPress=function(t){return"given_name"!==t||e.isEmpty(_.givenNameSearchText)?"surname"!==t||e.isEmpty(_.surnameSearchText)?void(e.isEmpty(_.contact.given_name)&&e.isEmpty(_.contact.surname)&&(_.disableGivenNameAutocomplete=!1,_.disableSurnameAutocomplete=!1)):void(_.disableGivenNameAutocomplete=!0):void(_.disableSurnameAutocomplete=!0)},_.addressTypeSelected=function(e){_.addressTypes[e]=!0,_.autofocusAddress=e}}e.$inject=["_","contactsFactory","$timeout","clientsFactory","$q","$scope","userOptionsFactory"],angular.module("app").component("contactForm",{templateUrl:"contacts/contact-form.tpl.html",controller:e,bindings:{contact:"<",onCancel:"&",onSave:"&",initAction:"<",focusTimeout:"<",options:"<"}})}(),function(){"use strict";function e(e,t){var n=this,a={showOther:!0,showSortDropdown:!1,showFilters:!1};n.opts={},n.selectedContact=null,n.sortBy="person-a-z",n.sortByDisplay={"person-a-z":"Person A-Z","person-z-a":"Person Z-A","company-a-z":"Company A-Z","company-z-a":"Company Z-A"},n.synced="all",n.$onChanges=function(e){n.opts=t.merge({},a,n.options),t.each(n.contacts,function(e){t.each(e.phone_numbers,function(n){n.default&&(e.defaultPhone=t.clone(n.number))}),t.each(e.email_addresses,function(n){n.default&&(e.defaultEmail=t.clone(n.address))})}),n.primaryContact=t.find(n.contacts,function(e){return e.is_primary}),n.nonPrimaryContacts=t.filter(n.contacts,function(e){return!e.is_primary})},n.mailContact=function(t){e.location="mailto:"+t},n.openContactDetails=function(e,t){n.selectedContact=e,n.onContactSelected({contact:e,initAction:t})},n.sortChange=function(e){n.sortBy=e,n.onSortChange({sortBy:e})},n.syncedChanged=function(){},n.hiddenFilterChange=function(e){n.onHiddenFilterChange({isHidden:e})}}e.$inject=["$window","_"],angular.module("app").component("contactList",{templateUrl:"contacts/contact-list.tpl.html",controller:e,bindings:{contacts:"<",onContactSelected:"&",options:"<",onSortChange:"&",onHiddenFilterChange:"&",selectedContact:"<"}})}(),function(){"use strict";function e(e,t,n,a){var o=this;o.title=a.title||"Deal Contact",o.contact=e,o.initAction=n,o.contactFormOptions=a,o.saveContact=function(e){t.hide(e)},o.cancel=function(){t.cancel()}}e.$inject=["contact","$mdDialog","initAction","contactFormOptions"],angular.module("app").controller("ContactModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a){var o=this;o.user=t.getUser(),o.ok=function(){e.hide()},o.cancel=function(){e.cancel()}}e.$inject=["$mdDialog","userFactory","env","$window"],angular.module("app").controller("ContactOutlookSyncErrorModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a){var o=this,r=a(function(){e.hide()},5e3);o.ok=function(){a.cancel(r),e.hide()},o.cancel=function(){a.cancel(r),e.cancel()}}e.$inject=["$mdDialog","env","$window","$timeout"],angular.module("app").controller("ContactOutlookSyncLoadingModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a){var o=this;o.user=t.getUser(),o.ok=function(){a.location.href=n.msGraphLoginUrl,e.hide()},o.cancel=function(){e.cancel()}}e.$inject=["$mdDialog","userFactory","env","$window"],angular.module("app").controller("ContactOutlookSyncModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a){var o=this;o.user=t.getUser(),o.ok=function(){a.location.href=n.msGraphLoginUrl,e.hide()},o.cancel=function(){e.cancel()}}e.$inject=["$mdDialog","userFactory","env","$window"],angular.module("app").controller("ContactOutlookUnsyncModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a){function o(){var e={work:2,home:2,mobile:1},t={work:0,home:0,mobile:0};a.each(i.contact.phone_numbers,function(e){t[e.type]++});for(var n in i.isPhoneListFull)t[n]>=e[n]?i.isPhoneListFull[n]=!0:i.isPhoneListFull[n]=!1}function r(){var e={business_address:0,home_address:0,other_address:0};a.each(i.contact.addresses,function(t){e[t.type]++});for(var t in i.isAddressListFull)e[t]>0?i.isAddressListFull[t]=!0:i.isAddressListFull[t]=!1}var i=this;i.isPhoneListFull={work:!1,home:!1,mobile:!1},i.isAddressListFull={business_address:!1,home_address:!1,other_address:!1},i.deleteContact=function(){i.onDelete({contactId:i.contact.id})},i.updateNotes=function(){var e=a.cloneDeep(i.contact);i.contact.company&&(e.company=i.contact.company.id),i.onUpdate({contactId:i.contact.id,data:e})},i.$onChanges=function(e){e.contact.currentValue&&(o(),r())},i.getAddressTypeDisplayValue=function(e){var t={business_address:"Work",home_address:"Home",other_address:"Other"};return t[e]},i.updateHidden=function(){var e=a.cloneDeep(i.contact);i.onUpdate({contactId:i.contact.id,data:e})}}e.$inject=["contactsFactory","$mdDialog","$mdToast","_"],angular.module("app").component("contactView",{templateUrl:"contacts/contact-view.tpl.html",controller:e,bindings:{contact:"<",toggleMode:"&",triggerEdit:"&",onDelete:"&",onUpdate:"&",isShowHiddenSwitch:"<"}})}(),function(){"use strict";function e(e,t,n,a,o){function r(e){t.show({controller:"ContactModalInstanceCtrl",templateUrl:"contacts/contact-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:e}).then(i)}function i(t){function n(e){return s("Contact updated"),d(e),e}function r(){s("Contact update failed")}function i(e){return s("Contact added"),d(e),e}function l(){s("Contact add failed")}function d(e){u.mode="read",c().then(function(){o.each(u.contacts,function(t){t.id===e.id&&(u.selectedContact=t)})})}t.id?e.updateContact(t.id,t).then(n).then(function(n){return t.create_personal_contact?e.addPersonalContact(n):a.resolve(null)}).catch(r):e.addContact(t).then(i).then(function(n){return t.create_personal_contact?e.addPersonalContact(n):a.resolve(null)}).catch(l)}function s(e){n.show(n.simple().textContent(e).position("bottom center").hideDelay(3e3))}function l(){c()}function c(){var t={deal:u.deal.id,page_size:100};return e.getContacts(t).then(function(e){u.contacts=e.results},function(e){})}var u=this;u.contacts=[],u.$onChanges=function(e){e.deal.currentValue&&l()},u.onContactSelected=function(t){t=t||e.createEmptyContact(u.deal.id);var n={};t.id?e.hasPersonalContact(t.id).then(function(e){n=o.merge(n,{enableAddToPersonalCheckbox:!e.data.has_personal_contact}),r({contact:t,initAction:null,contactFormOptions:n})}):(0===u.contacts.length&&(t.is_primary=!0),r({contact:t,initAction:null,contactFormOptions:n}))}}e.$inject=["contactsFactory","$mdDialog","$mdToast","$q","_"],angular.module("app").component("dealPanelContacts",{templateUrl:"contacts/deal-panel-contacts.tpl.html",controller:e,bindings:{deal:"<",onClose:"&",closable:"<"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u){function d(){y.given_name=null,y.surname=null,y.email=null,y.selectedGivenName=null,y.selectedSurname=null,y.selectedEmail=null,y.disableGivenNameAutocomplete=!0,y.disableSurnameAutocomplete=!0,y.disableEmailAutocomplete=!0}function p(e){if(e.length>0){var t=r.findIndex(e,function(e){return e.default});if(t!==-1){var n=e.splice(t,1)[0];e.unshift(n)}}}function m(e){if(e.length>0){var t=r.findIndex(e,function(e){return"mobile"===e.type});if(t!==-1){var n=e.splice(t,1)[0];e.unshift(n)}else{var a={type:"mobile",number:"",default:!1};e.unshift(a)}var o=r.findIndex(e,function(e){return!!e&&"work"===e.type});if(o!==-1){var i=e.splice(o,1)[0];e.splice(1,0,i)}}}function f(){y.disableGivenNameAutocomplete===!1&&y.given_name&&(y.primaryContact.given_name=y.given_name),y.disableSurnameAutocomplete===!1&&y.surname&&(y.primaryContact.surname=y.surname),y.disableEmailAutocomplete===!1&&y.email&&(y.primaryContact.email_addresses=[{type:"work",address:y.email,default:!0}])}function g(){var e=!1;return y.primaryContact.given_name&&(e=!0),y.primaryContact.surname&&(e=!0),y.primaryContact.job_title&&(e=!0),r.get(y.primaryContact,"email_addresses[0].address")&&(e=!0),r.get(y.primaryContact,"phone_numbers[0].number")&&(e=!0),r.get(y.primaryContact,"phone_numbers[1].number")&&(e=!0),e}function h(){var e=_();y.selectedClient.id?e.client=y.selectedClient.id:e.client={name:y.selectedClient.name},b&&(e.primary_deal_contact=l.sanitizeContact(y.primaryContact),e.primary_deal_contact.contact_type="deal"),y.primaryContact.create_personal_contact===!0&&l.addPersonalContact(y.primaryContact),o.addDeal(e).then(function(e){y.deal=e,v()},function(e){y.formErrors=c.collectErrors(e.data)})}function v(){t.hide(),n.go("app.dealsDetail",{id:y.deal.id})}function _(){var e=r.clone(y.prospect);switch(r.unset(e,"deal_type_rep_role"),y.prospect.deal_life_cycle_stage){case"prospect":e.deal_life_cycle_stage=1;break;case"executing":e.deal_life_cycle_stage=3;break;default:e.deal_life_cycle_stage=1}switch(y.prospect.deal_type_rep_role){case"lease_tenant":e.deal_type=2,e.rep_role=1;break;case"lease_landlord":e.deal_type=2,e.rep_role=2;break;case"sale_buyer":e.deal_type=1,e.rep_role=3;break;case"sale_seller":e.deal_type=1,e.rep_role=4;break;case"consulting":e.deal_type=3,e.rep_role=5;break;
case"other":e.deal_type=4,e.rep_role=6}return e}var y=this,b=!1,C=null;y.isDisabled=!1,y.noCache=!0,y.searchText=null,y.errors={},y.warnings={},y.disableGivenNameAutocomplete=!1,y.disableSurnameAutocomplete=!1,y.disableEmailAutocomplete=!1,y.selectedClient=null,y.deal=null,y.primaryContact=l.createEmptyProspectContact(),y.prospect={deal_type_rep_role:"lease_tenant",deal_life_cycle_stage:s||"prospect"},y.popoverMsg={title:"Contacts",text:"Manage contacts independent of your deals by adding them to your Deal IQ Contacts list accessible from the main navigation."},y.userOptions=u.getUserOptions(),y.searchTextChange=function(e){},y.selectEnter=function(e,t){if(13===e.which){var n=document.getElementById("Auto").firstElementChild,a=angular.element(n);a.scope().$mdAutocompleteCtrl.hidden=!0,e.preventDefault()}},y.selectedClientChange=function(e){e?y.warnings.clientMissing=!1:y.warnings.clientMissing=!0},y.checkSelected=function(e){e||(y.warnings.clientMissing=!0)},y.querySearch=function(t){C?(C.resolve(),C=e.defer()):C=e.defer();var n={search:t,page_size:10},o={timeout:C.promise},r=e.defer();return a.getClients(n,o).then(function(e){y.clients=e,r.resolve(e),C=null}),r.promise},y.ok=function(){null===y.selectedClient&&y.createClient(y.searchText),f();var e=g();return e?(b=!0,void h()):void(e||(b=!1,h()))},y.cancel=function(){t.cancel()},y.createClient=function(e){y.selectedClient={name:e}},y.keyPress=function(e){return"given_name"!==e||r.isEmpty(y.given_name)?"surname"!==e||r.isEmpty(y.surname)?"email"!==e||r.isEmpty(y.email)?void(r.isEmpty(y.primaryContact.given_name)&&r.isEmpty(y.primaryContact.surname)&&r.isEmpty(y.primaryContact.email_addresses[0].address)&&(y.disableGivenNameAutocomplete=!1,y.disableSurnameAutocomplete=!1,y.disableEmailAutocomplete=!1)):(y.disableGivenNameAutocomplete=!0,void(y.disableSurnameAutocomplete=!0)):(y.disableGivenNameAutocomplete=!0,void(y.disableEmailAutocomplete=!0)):(y.disableSurnameAutocomplete=!0,void(y.disableEmailAutocomplete=!0))},y.firstBlur=function(e){y[e]&&y[e].length>0&&("email"===e?(y.primaryContact.email_addresses=[{type:"work",address:y.email,default:!0}],y.email=null):(y.primaryContact[e]=y[e],y[e]=null),y.disableGivenNameAutocomplete=!0,y.disableSurnameAutocomplete=!0,y.disableEmailAutocomplete=!0)},y.itemChanged=function(e){e&&(p(e.email_addresses),m(e.phone_numbers),y.primaryContact=e,0===y.primaryContact.phone_numbers.length&&(y.primaryContact.phone_numbers=[{type:"mobile",number:"",default:!1},{type:"work",number:"",default:!0}]),0===y.primaryContact.email_addresses.length&&(y.primaryContact.email_addresses=[{type:"work",address:"",default:!0}]),d())},y.contactQuerySearch=function(e){var t={search:e};return l.getContacts(t).then(function(e){return e.results})}}e.$inject=["$q","$mdDialog","$state","clientsFactory","dealsFactory","_","$scope","dealStage","contactsFactory","errorMessageFactory","userOptionsFactory"],angular.module("app").controller("HeaderProspectModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l){var c=this;c.userOptions=o.getUserOptions(),i.$on("alertsReceived",function(e,t){void 0!==t.count&&(c.alertsCount=t.count)}),i.$on("alertDismissed",function(e,t){c.alertsCount=c.alertsCount-1}),i.$on("alertDismissedAll",function(e,t){c.alertsCount=0}),i.$on("userAvatarUpdated",function(e,t){c.userData=t}),c.goTo=function(e){n.go(e)},c.setSearchBox=function(e){c.showSearch=e},c.logoutClick=function(){function o(){t.defer(),n.go("loggedOut")}function i(){n.go("loggedOut")}e.deleteToken(),a.get("$http").removeAll(),r.logout().then(o,i)},c.openProspectModal=function(e,t){c.onOpenProspectModal({ev:t,dealStage:e})},c.openMenu=function(){c.onOpenMenu()},c.openAlerts=function(){i.$emit("alertsOpenPopup")},c.feedbackClicked=function(){var e={platform:l.getMobileOperatingSystem()};s.addUserEvent(c.userData.id,"intercom_opened",e)}}e.$inject=["authFactory","$q","$state","$cacheFactory","userOptionsFactory","logoutFactory","$rootScope","userEventsFactory","platformFactory"],angular.module("app").component("mainHeader",{templateUrl:"header/header.tpl.html",controller:e,bindings:{userData:"<",onOpenMenu:"&",onOpenProspectModal:"&"}})}(),function(){"use strict";function e(e,t){var n=this,a=e.find("div")[0],o=t.L.map(a);t.L.esri.basemapLayer("Topographic").addTo(o),t.L.Icon.Default.imagePath="assets/leaflet/",n.$onChanges=function(e){e.mapLatLong&&(e.mapLatLong.currentValue?(o.setView(e.mapLatLong.currentValue,13),t.L.marker(e.mapLatLong.currentValue).addTo(o),setTimeout(function(){o.invalidateSize()},0)):(o.setView([39.5,-98.35],2),setTimeout(function(){o.invalidateSize()},0)))}}e.$inject=["$element","$window"],angular.module("app").component("leaflet",{templateUrl:"leaflet/leaflet.tpl.html",controller:e,bindings:{mapLatLong:"<"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c){function u(e){e.newlyCreated=!0,v.notes.results.unshift(e),l(function(){v.notes.results[0].newlyCreated=!1},100),v.note.body="",t.show(t.simple().textContent("Note saved").position("bottom center").hideDelay(3e3))}function d(){v.notes=null,y=10,v.note={body:"",privacy:"private"},p()}function p(){var t={deal:v.deal.id,ordering:"-created",page_size:v.count||y,page:1};e.getNotes(t).then(function(e){if(v.loadingMoreNotes=!1,v.notes&&v.notes.results){var t=a.differenceBy(e.results,v.notes.results,function(e){return e.id});v.notes.results=a.concat(v.notes.results,t)}else v.notes=e;m(v.notes.results.length,e.count)},function(e){v.loadingMoreNotes=!1,c.warn("Error refreshing note list.",e)})}function m(e,t){e<t?v.useInfiniteScroll?i.startScrollListener(b):v.seeAllLink||(v.showSeeAllNotesButton=!0):v.useInfiniteScroll?(c.log("All notes loaded."),i.destroyScrollListener()):v.seeAllLink||(v.showSeeAllNotesButton=!1)}function f(){v.loadingMoreNotes||(c.log("Getting more notes."),v.loadingMoreNotes=!0,y+=10,p())}function g(){s.$on("userPreferencesUpdated",function(e){v.userOptions=r.getUserOptions()}),s.$on("loadMoreContent",f)}var h,v=this,_=null,y=10,b="#main-content";v.userOptions=r.getUserOptions(),v.$onChanges=function(e){if(e.deal.currentValue){var t=a.clone(h);h=e.deal.currentValue.id,t!==h&&d()}},v.$onInit=function(){g()},v.$onDestroy=function(){i.destroyScrollListener()},v.save=function(){var t;v.note.body&&(t={deal:v.deal.id,body:v.note.body,privacy:v.note.privacy},e.addNote(t).then(u))},v.deleteNote=function(a){a.beingDeleted=!0;var o=n.confirm({title:"Are you sure?",textContent:"This note will be deleted permanently",ok:"Delete",cancel:"Cancel"});n.show(o).then(function(){e.deleteNote(a.id).then(function(){var e=v.notes.results.indexOf(a);v.notes.results.splice(e,1),p(),t.show(t.simple().textContent("Note deleted").position("bottom center").hideDelay(3e3))})},function(){a.beingDeleted=!1})},v.toggleEdit=function(e){for(var t=0;t<v.notes.results.length;t++)v.notes.results[t].editMode&&(v.notes.results[t].editMode=!1);e.editMode=!e.editMode,_={body:e.body,privacy:e.privacy},""===v.note.body&&(v.mainNoteFocused=!1)},v.updateNote=function(n){var o={};n.editMode=!n.editMode,a.isEqual(n.body,_.body)||(o.body=n.body),a.isEqual(n.privacy,_.privacy)||(o.privacy=n.privacy),a.isEmpty(o)||e.updateNote(n.id,o).then(function(e){t.show(t.simple().textContent("Note updated").position("bottom center").hideDelay(3e3))})},v.cancelNote=function(e){e.editMode=!e.editMode,e.body=_.body,e.privacy=_.privacy},v.cancelNewNote=function(){v.note.body="",v.note.privacy="private",v.mainNoteFocused=!1},v.getAllNotes=function(){y=999,p()}}e.$inject=["notesFactory","$mdToast","$mdDialog","_","websocketFactory","userOptionsFactory","infiniteScrollFactory","$rootScope","$timeout","$log"],angular.module("app").component("dealPanelNotes",{templateUrl:"notes/deal-panel-notes.tpl.html",controller:e,bindings:{deal:"<",userData:"<",useInfiniteScroll:"<",closable:"<",count:"<",seeAllLink:"<",onClose:"&"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s){function l(){e.cancel()}function c(){e.hide()}function u(){for(var t,n=0;n<h.length;n++)t={deal:h[n].deal,team:null,user_id:h[n].user_id,email:h[n].email.work},h[n].team&&(t.team=h[n].team),o.addMember(t);for(n=0;n<v.length;n++)o.removeMember(v[n].id);h=[],v=[],e.hide()}function d(e){function n(e){var t=[];s.each(g.members.teams,function(e){t.push(e)}),s.each(g.members.notInTeam,function(e){t.push(e)});var n=s.filter(e,function(e){var n=s.findIndex(t,function(t){return t.user_id===e.user_id});return n===-1});return n}var o={search:e,page_size:100},r=t.defer();return a.getBrokers(o).then(function(e){var t=n(e.results);r.resolve(t)}),r.promise}function p(){if(g.selectedItem){var e=!0,t={deal:i.id,user_id:g.selectedItem.user_id,user:g.selectedItem,email:g.selectedItem.email.work};g.members.notInTeam.push(t);for(var n=0;n<v.length;n++)v[n].user_id===g.selectedItem.user_id&&(e=!1,v.splice(n,1));e&&h.push(t),g.selectedItem=null,g.searchText=null}}function m(e){if(e){var t=!0,n={deal:e.deal,user_id:e.user_id,id:e.id,user:e.user,email:e.user.email},a=0,o=0;for(e.team&&(n.team=e.team),a=0;a<g.members.notInTeam.length;a++)g.members.notInTeam[a].user_id===e.user_id&&g.members.notInTeam.splice(a,1);for(a=0;a<g.members.teams.length;a++)for(o=0;o<g.members.teams[a].length;o++)g.members.teams[a][o].user_id===e.user_id&&g.members.teams[a].splice(o,1);for(a=0;a<h.length;a++)h[a].user_id===e.user_id&&(t=!1,h.splice(a,1));t&&v.push(n)}}function f(){for(var e=g.members.notInTeam.length,t=0;t<g.members.teams.length;t++)e+=g.members.teams[t].length;return 1===e}var g=this;g.isDisabled=!1,g.noCache=!0,g.members=r,g.newTeam={},g.selectedItem=null,g.searchText=null,g.userOptions=n.getUserOptions(),g.removeSingleUserX=!1,g.isDealLifeCycleVisible="closed"!==i.deal_life_cycle_stage,g.isClosed="closed"===i.deal_life_cycle_stage,g.isRemovable="closed"!==i.deal_life_cycle_stage;var h=[],v=[];g.querySearch=d,g.selectedItemChange=p,g.removeMember=m,g.save=u,g.cancel=l,g.ok=c,g.hasSingleTeamMember=f}e.$inject=["$mdDialog","$q","userOptionsFactory","brokersFactory","membersFactory","members","deal","_"],angular.module("app").controller("ManagePermissionsModal",e)}(),function(){"use strict";function e(e,t,n,a,o){function r(){var e={deal:i.deal.id,page_size:100};t.getMembers(e).then(function(e){var t={},n=[];i.combinedMembers=[],o.each(e.results,function(e){e.team?t[e.team]?t[e.team].push(e):t[e.team]=[e]:n.push(e),i.combinedMembers.push(e)}),i.members={teams:o.values(t),notInTeam:n}})}var i=this;i.combinedMembers=[],i.$onChanges=function(e){o.get(e,"deal.currentValue")&&r()},i.userOptions=a.getUserOptions(),i.manageTeams=function(){n.show({controller:"ManagePermissionsModal",templateUrl:"permissions/manage-permissions-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,controllerAs:"vm",locals:{members:angular.copy(i.members),deal:i.deal}}).then(function(){r()})}}e.$inject=["teamsFactory","membersFactory","$mdDialog","userOptionsFactory","_"],angular.module("app").component("permissions",{templateUrl:"permissions/permissions.tpl.html",controller:e,bindings:{deal:"<",members:"="}})}(),function(){"use strict";function e(e,t){var n=this;n.user=angular.copy(e),n.ok=function(){t.hide(n.user)},n.cancel=function(){t.cancel()},n.updateAvatar=function(e){t.show({controller:"UpdateAvatarModalInstanceCtrl",templateUrl:"profile/update-avatar-modal.tpl.html",parent:angular.element(document.body),targetEvent:e,controllerAs:"vm",clickOutsideToClose:!0}).then(function(e){},function(){})}}e.$inject=["user","$mdDialog"],angular.module("app").controller("EditProfileModalInstanceCtrl",e)}(),function(){"use strict";function e(e,t,n,a,moment,o){var r=this;t.image={},t.image.myImage="",t.image.myCroppedImage="";var i=function(e){var n=e.currentTarget.files[0],a=new FileReader;a.onload=function(e){t.$apply(function(t){t.image.myImage=e.target.result})},a.readAsDataURL(n)};n(function(){angular.element(document.querySelector("#update-avatar-img")).on("change",i)});var s=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],a=[],o=0;o<t.length;o++)a.push(t.charCodeAt(o));return new Blob([new Uint8Array(a)],{type:n})};r.ok=function(){e.hide()},r.cancel=function(){e.cancel()},r.saveAvatar=function(){var n=s(t.image.myCroppedImage),r=n.type.split("/")[1];n.name="pic"+moment().format("YYYYMMDDhhmmss")+"."+r,a.updateAvatar(n).then(function(t){o.$emit("userAvatarUpdated",t),e.hide()})}}e.$inject=["$mdDialog","$scope","$timeout","userFactory","moment","$rootScope"],angular.module("app").controller("UpdateAvatarModalInstanceCtrl",e)}(),function(){"use strict";function e(e){function t(){n.deal.final_properties&&(n.finalCommercialProperties=n.deal.final_properties,n.closedDeal=!0,n.showFinalProperty=!0,("lease"===n.deal.deal_type||"sales"===n.deal.deal_type)&&n.finalCommercialProperties.length>0?n.showFinalProperty=!0:n.showFinalProperty=!1)}var n=this;n.isLoading=!1,n.closedDeal=!1,n.showFinalProperty=!1,n.currentCommercialProperty=null,n.finalCommercialProperties=null,n.propertyTypes=[{key:"retail",display:"Retail"},{key:"industrial",display:"Industrial"},{key:"office",display:"Office"}],n.mode="view",n.searchNearbyPopover={title:"Search Nearby",text:"Allow browser to know your location for nearby search results.",showTitle:!1},n.$onInit=function(){n.commercialProperties=e.cloneDeep(n.deal.current_properties),t()},n.$onChanges=function(a){n.commercialProperties=e.cloneDeep(n.deal.current_properties),t()}}e.$inject=["_"],angular.module("app").component("dealPanelPropertiesOverview",{templateUrl:"properties/deal-panel-properties-overview.tpl.html",controller:e,bindings:{deal:"<",onRefresh:"&"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,moment,c,u,d,p){function m(e,t){U.currentCommercialProperty.spaces=[{whole_building:e,owned:t}]}function f(t){U.isWholeBuilding=!1,U.isOwned=!1,e.each(t.spaces,function(e){e.lease_expiration_date&&(e.lease_expiration_date=moment(e.lease_expiration_date).toDate()),e.whole_building&&(U.isWholeBuilding=!0),e.owned&&(U.isOwned=!0)})}function g(){U.errors={};var e=v(),t=h(),n=_();return e&&t&&n}function h(){if(!U.currentCommercialProperty.postal_code)return!0;var e=/^[0-9]{5}([-][0-9]{4})?$/,t=e.test(U.currentCommercialProperty.postal_code);return t||(U.errors.postalCode=!0),t}function v(){var e=!0;if(!U.currentCommercialProperty.name){var t=U.currentCommercialProperty.address&&U.currentCommercialProperty.city&&U.currentCommercialProperty.state_abbreviation&&U.currentCommercialProperty.postal_code;t||(U.errors.nameOrAddressRequired=!0,e=!1)}return e}function _(){var t=!0;return e.each(U.currentCommercialProperty.spaces,function(n){e.each(U.currentCommercialProperty.spaces,function(e){e!==n&&(""===n.address_line2&&""===e.address_line2||n.address_line2===e.address_line2&&(t=!1,e.errors=e.errors||{},e.errors.noDuplicateSpaces=!0,n.errors=n.errors||{},n.errors.noDuplicateSpaces=!0))})}),t}function y(t){T(),U.commercialProperties=e.cloneDeep(t.current_properties),U.mode="view",U.isLoading=!1,U.onRefresh()}function b(t,n){var a=l.collectErrors(t.data),o="";e.each(a,function(t){o+=t.key,e.each(t.value,function(e){o+=" "+e})}),i.show(i.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("There was an error saving spaces.").textContent(o).ariaLabel("Spaces error messages").ok("Got it!").targetEvent(n)),U.isLoading=!1}function C(){$(),s.show(s.simple().textContent("Building deleted").position("bottom center").hideDelay(3e3))}function T(){x=null,P=null,U.isWholeBuilding=null,U.currentCommercialProperty=null,U.esriSearchText=null,U.errors={}}function D(){"closed"===U.deal.deal_life_cycle_stage&&(U.finalCommercialProperties=U.deal.final_properties,U.closedDeal=!0,U.showFinalProperty=!0,("lease"===U.deal.deal_type||"sales"===U.deal.deal_type)&&U.finalCommercialProperties.length>0?U.showFinalProperty=!0:U.showFinalProperty=!1)}function $(){var e=function(){U.isLoading=!1,U.mode="view"};U.onRefresh({callback:e})}function k(t){var n=["id","address_line2","total_sqft","whole_building","lease_expiration_date","owned"],o=["id","name","address","city","postal_code","property_type","state_abbreviation","spaces"];return t.spaces=t.spaces.map(function(e){return e.lease_expiration_date?e.lease_expiration_date=moment(e.lease_expiration_date).format("YYYY-MM-DD"):e.lease_expiration_date=null,e=a.sanitize(e,n)}),t.property_type||e.unset(t.property_type),t=a.sanitize(t,o)}function w(){U.currentCommercialProperty.name&&(U.isBuildingNameAutocomplete=!1)}function S(){o.getPropertyOptions().then(function(t){var n=t.actions.POST.property_type.choices.filter(function(e){return!(e.value in{ind:!0,ofc:!0,rtl:!0})}),a="",o="",r="";e.forEach(n,function(e){"Office"===e.value?a=e:"Industrial"===e.value?o=e:"Retail"===e.value&&(r=e)});var i=[a,o,r];e.forEach(i,function(e){n.splice(n.indexOf(e),1)}),U.propertyTypes=i.concat(n)})}var x,P,A,F,U=this;U.isLoading=!1,U.closedDeal=!1,U.showFinalProperty=!1,U.currentCommercialProperty=null,U.finalCommercialProperties=null,U.errors={},U.openLeaseExpDialog={},U.selectedEsriBuilding=null,U.esriSearchText=null,U.isBuildingNameAutocomplete=!0,U.isEsriLoading=!1,U.isSearchNearby=!1,U.autofocus=[],U.propertyTypes=[],U.mode="view",U.searchNearbyPopover={title:"Search Nearby",text:"Allow browser to know your location for nearby search results.",showTitle:!1},U.searchNearbyBuildings=function(){F?F=null:(U.isEsriLoading=!0,u.locate().then(function(e){F=e,U.isEsriLoading=!1},function(e){p.debug(e),U.isEsriLoading=!1,U.isSearchNearby=!1,U.hideSearchNearby=!0}))},U.handleBuildingNameChange=function(e){e||(U.esriSearchText=null,U.selectedEsriBuilding=null,U.isBuildingNameAutocomplete=!0,n(function(){document.querySelector("#esriAutoComplete").focus()}))},U.searchEsriProperties=function(t){function n(e){i.resolve(e.suggestions),p.debug("res",e)}function a(e){p.debug("err",e)}var o=3;if(t&&!(t.length<o)){var i=r.defer(),s={text:t,countryCode:"USA",f:"json"};return F&&e.merge(s,{location:F}),c.search(s).then(n,a),i.promise}},U.selectedEsriChanged=function(t){function n(t){U.currentCommercialProperty.name=e.get(t,"candidates[0].address"),U.esriSearchText=e.get(t,"candidates[0].address"),U.currentCommercialProperty.address=e.get(t,"candidates[0].attributes.StAddr"),U.currentCommercialProperty.city=e.get(t,"candidates[0].attributes.City");var n=e.get(t,"candidates[0].attributes.Region");n&&(U.currentCommercialProperty.state_abbreviation=d.abbreviate(n)),U.currentCommercialProperty.postal_code=e.get(t,"candidates[0].attributes.Postal"),U.isBuildingNameAutocomplete=!1,U.isEsriLoading=!1}if(t){U.isEsriLoading=!0;var a={singleLine:U.selectedEsriBuilding.text,magicKey:U.selectedEsriBuilding.magicKey,f:"json"};F&&e.merge(a,{location:F}),c.buildingLookup(a).then(n)}},U.$onInit=function(){T(),U.commercialProperties=e.cloneDeep(U.deal.current_properties),S(),D()},U.$onChanges=function(t){U.commercialProperties=e.cloneDeep(U.deal.current_properties),D()},U.addSpace=function(){U.currentCommercialProperty.spaces.push({whole_building:!1})},U.cancel=function(){T(),U.mode="view"},U.removeSpace=function(t,n){e.remove(t.spaces,function(e){return n===e})},U.addProperty=function(){U.autofocus=[],A=e.cloneDeep(U.commercialProperties),U.isBuildingNameAutocomplete=!0,U.esriSearchText="",U.selectedEsriBuilding=null,U.currentCommercialProperty={spaces:[{owned:!1,whole_building:!1}]},U.isOwned=!1,U.isWholeBuilding=!1,U.mode="add"},U.editCommercialProperty=function(t,n,a){A=e.cloneDeep(U.commercialProperties);var o=e.findIndex(A,function(e){return e.id===t.id}),r=A.splice(o,1)[0];f(r),U.currentCommercialProperty=e.cloneDeep(r),U.mode="edit",w(),U.autofocus=[],U.autofocus[a]=n},U.deleteCommercialProperty=function(e){U.autofocus=[];var t=i.confirm({title:"Are you sure?",textContent:"This building will be permanently deleted from this deal.",ok:"Delete",cancel:"Cancel"});i.show(t).then(function(){U.isLoading=!0,o.deleteProperty(e.id).then(C)})},U.onOwnedChange=function(){U.isOwned===!0?(U.isWholeBuilding?x=e.cloneDeep(U.currentCommercialProperty.spaces):P=e.cloneDeep(U.currentCommercialProperty.spaces),x?(U.currentCommercialProperty.spaces=e.cloneDeep(x),U.currentCommercialProperty.spaces[0].owned=!0,U.currentCommercialProperty.spaces[0].lease_expiration_date=null):m(!0,!0),U.isWholeBuilding=!0):U.isOwned===!1&&(U.currentCommercialProperty.spaces[0].owned=!1)},U.onWholeBuildingChange=function(){U.isWholeBuilding===!0?(P=e.cloneDeep(U.currentCommercialProperty.spaces),x?U.currentCommercialProperty.spaces=e.cloneDeep(x):m(!0,!1)):U.isWholeBuilding===!1&&(x=e.cloneDeep(U.currentCommercialProperty.spaces),P?U.currentCommercialProperty.spaces=e.cloneDeep(P):m(!1,!1))},U.submit=function(){if(!U.currentCommercialProperty.name&&U.esriSearchText&&(U.currentCommercialProperty.name=U.esriSearchText),g()){U.isLoading=!0;var n=e.cloneDeep(U.currentCommercialProperty),a=e.cloneDeep(A);a.push(n),a=a.map(function(e){return k(e)});var o={current_properties:a};t.updateDeal(U.deal.id,o).then(y,b)}}}e.$inject=["_","dealsFactory","$timeout","sanitizeFactory","propertiesFactory","$q","$mdDialog","$mdToast","errorMessageFactory","moment","esriFactory","locationFactory","stateAbbreviatorFactory","$log"],angular.module("app").component("dealPanelProperties",{templateUrl:"properties/deal-panel-properties.tpl.html",controller:e,bindings:{deal:"<",onRefresh:"&"}})}(),function(){"use strict";function e(e,t,n){function a(){f.requirements={deal:null,product:null,lease_type:null,occupancy_date:null,sqft:{max:null,min:null},other:null}}function o(){if(c()){f.requirements.deal=f.deal.id,p("add");var t=l(f.requirements);e.addRequirements(t).then(r)}}function r(t){var n=e.transformRequirements(t);f.deal.requirements=n,f.requirements=n,f.errors={}}function i(){if(c()){var t=l(f.requirements);e.updateRequirements(f.requirements.id,t).then(s)}}function s(t){var n=e.transformRequirements(t);f.requirements=n,f.deal.requirements=n,f.mode="view",f.errors={}}function l(e){var a=["deal","sqft","occupancy_date","other","product","lease_type"];return""===e.sqft.min&&(e.sqft.min=null),""===e.sqft.max&&(e.sqft.max=null),null===e.other&&n.unset(e,"other"),null===e.occupancy_date&&n.unset(e,"occupancy_date"),t.deepSanitize(e,a)}function c(){var e=[u,d],t=!0;return n.each(e,function(e){var n=e.call();n||(t=!1)}),t}function u(){var e=!0;return f.requirements.sqft.max>9999999&&(f.errors.sqftRange=!0,e=!1),f.requirements.sqft.min>9999999&&(f.errors.sqftRange=!0,e=!1),e}function d(){var e=!0;return f.requirements.sqft.min&&f.requirements.sqft.max?(parseInt(f.requirements.sqft.min)>parseInt(f.requirements.sqft.max)&&(e=!1,f.errors.sqftMinLessThanMax=!0),e):e}function p(e){"update"===e?(""===f.deal.requirements.product&&(f.deal.requirements.product=null),""===f.deal.requirements.lease_type&&(f.deal.requirements.lease_type=null)):"add"===e&&(""===f.requirements.product&&(f.requirements.product=null),""===f.requirements.lease_type&&(f.requirements.lease_type=null))}function m(){return f.requirements.occupancy_date}var f=this;f.leaseTypes=e.getLeaseTypeKeyMap(),f.productTypes=e.getProductTypeKeyMap(),f.requirementsClone=null,f.errors={},f.updateRequirements=function(){f.deal.requirements?(p("update"),i()):o()},f.$onInit=function(){a(),m(),f.deal.requirements&&(f.requirements=e.transformRequirements(f.deal.requirements))}}e.$inject=["requirementsFactory","sanitizeFactory","_"],angular.module("app").component("requirements",{templateUrl:"requirements/requirements.tpl.html",controller:e,bindings:{deal:"<"}})}(),function(){"use strict";function e(){var e=this;e.searchChanged=function(t){e.onSearch({input:t})},e.resetInput=function(){e.onSearch({input:null}),e.searchInput=null}}angular.module("app").component("dealSearch",{templateUrl:"search/deal-search.tpl.html",controller:e,bindings:{onSearch:"&",placeholder:"@"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l){function c(){return{totalCount:0,deals:{objects:[]},tasks:{objects:[]}}}function u(e){if(e.deals){var t=e.deals.objects;o.each(t,function(e){o.get(e,"highlight.highlight.tags")&&o.each(e.highlight.highlight.tags,function(t){var n=t.slice(4,-5);e.tags.indexOf(n)!==-1&&(e.tags[e.tags.indexOf(n)]=t)})})}return e}function d(){function e(){m.showingResults=!1,t.$apply()}function n(){document.removeEventListener("click",e)}document.addEventListener("click",e),t.$on("$destroy",n)}var p,m=this,f=s.getUser();m.searchText="",m.searchResults=c(),m.showingResults=!1,m.currentTab="all",m.isGlobalSearchLoading=!1,m.isLimitingSearchResults=!0,m.searchResultLimit=6,m.stoppingPropagation=function(e){e.stopPropagation()},m.$onInit=function(){d()},m.checkShowResults=function(){if(m.searchText.length>0){var e=m.searchText;m.search(e),m.showingResults=!0}else m.showingResults=!1,m.searchResults=c()},m.postNavReset=function(e,t){var n={search_term:m.searchText,selected_result:e.id,selected_result_position:t,tab:m.currentTab,selected_result_type:e.highlight.doc_type};i.addUserEvent(f.id,"successful_search",n),m.showingResults=!1,m.searchText="",m.currentTab="all",m.searchResults=c()},m.search=function(t){function n(e){m.searchResults=u(e),m.isGlobalSearchLoading=!1}function a(){}if(m.isGlobalSearchLoading=!0,p&&(p.resolve(),p=null),p=r.defer(),!t)return void(m.searchResults=c());var o={search:t,limit:m.isLimitingSearchResults?m.searchResultLimit:999};e.search(o,p).then(n,a)},m.limitItems=function(e){return"all"===m.currentTab?e.slice(0,3):e},m.shouldShowLimitToggleAndGetButtonText=function(e){if("all"===m.currentTab)return!1;var t=m.searchResults[e];return m.isLimitingSearchResults&&t.objects.length<t.count?"Show "+(t.count-t.objects.length)+" More":t.objects.length>m.searchResultLimit&&"Show Less"},m.toggleSearchResultLimit=function(){m.isLimitingSearchResults=!m.isLimitingSearchResults,m.checkShowResults()},m.taskEdit=function(e,t){l.getTask(e.id).then(function(e){a.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,locals:{task:angular.copy(e),edit:!0,userData:f,hideDeal:!1}})})}}e.$inject=["searchFactory","$scope","$filter","$mdDialog","_","$q","userEventsFactory","userFactory","tasksFactory"],angular.module("app").component("globalSearch",{templateUrl:"search/global-search.tpl.html",controller:e})}(),function(){"use strict";function e(){var e=this;e.searchChanged=function(t){e.onSearch({input:t})},e.resetInput=function(){e.onSearch({input:null}),e.searchInput=null}}angular.module("app").component("search",{templateUrl:"search/search.tpl.html",controller:e,bindings:{onSearch:"&"}})}(),function(){"use strict";function e(){function e(e,t,n){var a={prospect:{icon:"binoculars.svg",heading:"Keep all your prospects in one place",messaging:"Start by adding a prospect and track them as they develop.",button:{text:"+ Deal"}},prospect_filtered:{icon:"binoculars.svg",heading:"No prospects found with current filter",messaging:"Adjust your filter to see results."},executing:{icon:"",heading:"Update your Prospect's Status to Executing",messaging:"Execute your active deals in one place.",button:{text:"Manage Prospects"}},executing_filtered:{icon:"rocket.svg",heading:"No executing deals found with current filter",messaging:"Adjust your filter to see results."},closed:{icon:"closed_white.png",heading:"Close your deals and keep track of what you've accomplished",messaging:"See history of your deals and where they've gone.",button:{text:"Manage Executing"}},closed_filtered:{icon:"briefcase.svg",heading:"No closed deals found with current filter",messaging:"Adjust your filter to see results."},attachment:{icon:"binder-clip.svg",heading:"Store deal associated files",messaging:"Keep your deal docs all here for quick, easy access."},task:{icon:"task-clipboard.svg",heading:"No tasks found",messaging:"Create private tasks or assign tasks to CBRE team members."},task_due:{icon:"task-clipboard.svg",heading:"No tasks due",messaging:"Create private tasks or assign tasks to CBRE team members."},commissions:{icon:"alarm.svg",heading:"No payments data found",messaging:"Please select a different year"},current_space:{icon:"building.svg",heading:"Make accurate comparisons by entering current space."},final_space:{icon:"alarm.svg",heading:"Speed up your voucher submission and get future alerts about your client."},alerts:{icon:"alarm.svg",heading:"Relax, there are no alerts",messaging:"Reminders and notifications about important deal activities or tasks will appear here until dismissed."},favorite:{icon:"favorite.svg",heading:"Add your most important deals here for quick access.",messaging:"Star the deals you want to appear here.",popover:{title:"Favorite",image:"",text:"To add a deal to your favorites list, click the STAR ICON next to the deal name on the deal page."}}};e.state=a[e.component]}var t={restrict:"E",scope:{component:"@",btnAction:"&"},templateUrl:"shared/empty-state.tpl.html",link:e};return t}angular.module("app").directive("emptyState",e)}(),function(){"use strict";function e(e,t,n){var a=this;a.cancel=function(){e.cancel()},a.message=t,a.status=n,a.status!==-1||a.message||(a.message="No internet connection.")}e.$inject=["$mdDialog","message","status"],angular.module("app").controller("ErrorModal",e)}(),function(){"use strict";function e(){var e=this;e.unFavorite=function(t){t.stopPropagation(),e.isFavorite=!1,e.onUnFavorite({object:e.object})},e.favorite=function(t){t.stopPropagation(),e.isFavorite=!0,e.onFavorite({object:e.object})}}angular.module("app").component("favoriteStar",{templateUrl:"shared/favorite-star.tpl.html",controller:e,bindings:{isFavorite:"<",onUnFavorite:"&",onFavorite:"&",object:"<"}})}(),function(){"use strict";angular.module("app").component("loading",{templateUrl:"shared/loading.tpl.html"})}(),function(){"use strict";function e(moment,e,t,n,a){function o(){l.isShowDropdown=!1,l.timeTextInput&&l.ngModel&&i(l.timeTextInput),t.$apply()}function r(e){l.ngModel=e;var t=moment(e).format("h:mmA");l.timeTextInput=t}function i(e){if(e){var t=/(\d{1,2}):(\d{2})\s*(am|pm)/i,n=t.exec(e);if(n){var a=n[1],o=n[2],r=n[3];"pm"===r.toLowerCase()&&"12"!==a&&(a=parseInt(a)+12),"am"===r.toLowerCase()&&"12"===a&&(a=0);var i=moment(l.ngModel);i.hour(a),i.minute(o),l.ngModel=i.toDate(),l.timeTextInput=i.format("h:mmA"),l.isShowDropdown=!1}}}function s(){for(var e=[],t=moment(l.ngModel).startOf("day"),n=0;n<24;n++){var a=t.clone().add(n,"hours");e.push(a.toDate())}return e}var l=this;l.timeOptions=[],l.isShowDropdown=!1,t.$watch("$ctrl.ngModel",function(e){return e?(l.timeOptions=s(),void(l.timeTextInput=moment(e).format("h:mmA"))):void(l.timeTextInput=null)}),document.addEventListener("click",o),l.$onDestroy=function(){document.removeEventListener("click",o)},l.timeChange=function(e,t){r(t),l.isShowDropdown=!1},l.inputFocus=function(){var e=n[0],t=e.querySelector(".time-selector-options");a(function(){var e=moment(l.ngModel),n=e.hour(),a=19*n;t.scrollTop=a}),l.isShowDropdown=!0},l.isActive=function(e){var t=moment(e),n=t.isSame(l.ngModel,"hour");return{active:n}},l.inputKeyup=function(e){e.stopPropagation(),13===e.keyCode&&i(l.timeTextInput)},l.stopPropagation=function(e){e.stopPropagation()}}e.$inject=["moment","_","$scope","$element","$timeout"],angular.module("app").component("timeSelector",{templateUrl:"shared/time-selector.tpl.html",controller:e,bindings:{ngModel:"="}})}(),function(){"use strict";function e(e,t){var n=this;n.videoURL=e,n.videoTitle=t}e.$inject=["videoURL","videoTitle"],angular.module("app").controller("VideoModal",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c){function u(e){function t(e){return d("Contact added"),e}function n(){d("Contact add failed")}return o.addPersonalContact(e).then(t),e.create_personal_contact.catch(n)}function d(e){r.show(r.simple().textContent(e).position("bottom center").hideDelay(3e3))}function p(){t.getDeals({deal_life_cycle_stage:"prospect",page_size:0,is_archived:!1}).then(function(e){f.prospects=e}),t.getDeals({deal_life_cycle_stage:"executing",
page_size:0,is_archived:!1}).then(function(e){f.executing=e}),t.getDeals({deal_life_cycle_stage:"closed",page_size:0,is_archived:!1}).then(function(e){f.closed=e})}function m(){i.$on("dealLifeCycleStageUpdated",function(e,t){f.dealLifeCycleStage=t}),i.$on("dealCreated",function(e,t){p(),f.dealLifeCycleStage=t.deal_life_cycle_stage}),i.$on("dealUpdated",function(e,t){l.$current.includes["app.voucher"]||(p(),f.dealLifeCycleStage=t.deal_life_cycle_stage)}),i.$on("userPreferencesUpdated",function(t){f.userOptions=e.getUserOptions()})}var f=this,g=null;f.state=l,f.dealLifeCycleStage=null,n.fetchUser().then(function(e){g=e}),f.$onInit=function(){p(),m()},f.openProspectModal=function(e,t){f.onOpenProspectModal({ev:t,dealStage:e})},f.openTasksModal=function(e){var t={title:null,is_private:!0};s.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{task:t,edit:!1,userData:g,hideDeal:!1}}).then(function(){},function(){})},f.openContactsModal=function(e){e=e||o.createEmptyContact();var t={showPrimaryDealCheckbox:!1,showAddToPersonalCheckbox:!1,title:"Personal Contact",hideAddToPersonalCheckbox:!0};s.show({controller:"ContactModalInstanceCtrl",templateUrl:"contacts/contact-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{contact:e,initAction:null,contactFormOptions:t}}).then(u)},f.closeMenu=function(){f.onCloseMenu()}}e.$inject=["userOptionsFactory","dealsFactory","userFactory","tasksFactory","contactsFactory","$mdToast","$rootScope","$mdDialog","$state","$q"],angular.module("app").component("mainSidebar",{templateUrl:"sidebar/sidebar.tpl.html",controller:e,bindings:{userData:"<",userOptions:"<",deal:"<",onCloseMenu:"&",onOpenProspectModal:"&",onOpenTasksModal:"&"}})}(),function(){"use strict";function e(e){var t=this;t.tagClicked=function(t){e.$emit("tagRemoved",t)}}e.$inject=["$scope"],angular.module("app").component("tagList",{templateUrl:"tags/tag-list.tpl.html",controller:e,bindings:{tags:"<",selectedTags:"<",clear:"<"}})}(),function(){"use strict";function e(e,t,n,a){function o(){function e(){l.showDropdown=!1,t.$apply()}function a(){o(),s(),document.removeEventListener("click",e)}var o=n.$on("tagRemoved",function(e,t){i(t)}),s=n.$on("filterByTag",function(e,t){r(t)});t.$on("$destroy",a),document.addEventListener("click",e)}function r(e){l.selectedTags[e]=!0;var t=s();l.onTagSelected({tags:t}),l.checkboxSelected()}function i(e){l.selectedTags[e]=!1;var t=s();l.onTagSelected({tags:t})}function s(){var e=[];for(var t in l.selectedTags)l.selectedTags[t]&&e.push(t);return l.numberOfSelectedTags=e,e}var l=this;l.selectedTags={},l.clearAllButton=!1,l.$onInit=function(){o()},l.checkboxSelected=function(){e(function(){var e=s();l.onTagSelected({tags:e}),l.clearAllButton=!0})},l.clear=function(e){l.selectedTags={},i(e)},l.entireDropdownClicked=function(e){e.stopPropagation()}}e.$inject=["$timeout","$scope","$rootScope","$mdConstant"],angular.module("app").component("tagsDropdown",{templateUrl:"tags/tags-dropdown.tpl.html",controller:e,bindings:{allTags:"<",onTagSelected:"&"}}).filter("highlight",["$sce",function(e){return function(t,n){return n&&(t=t.replace(new RegExp("("+n+")","gi"),'<span class="highlightedText">$1</span>')),e.trustAsHtml(t)}}])}(),function(){"use strict";function e(e,t,n,a,o,r,i){var s=this,l=null;s.ordering="due_datetime",s.addTaskMode=!1,s.type="active",i.fetchUser().then(function(e){l=e}),s.getTasks=function(){var t={due_datetime:{ordering:"due_datetime",is_complete:!1},priority:{ordering:"due_datetime",is_complete:!1,is_priority:!0},recent:{ordering:null,is_complete:!1},completed:{ordering:null,is_complete:!0}},n=t[s.ordering];if(s.selectedAssignee){var a={assignees:s.selectedAssignee.user_id};r.merge(n,a)}else{var o={assignees:null};r.merge(n,o)}if(s.myTasksOnly){var l={assignees:i.getUser().id};r.merge(n,l)}else{var c={assignees:null};r.merge(n,c)}n.page_size=s.count,n.deal=s.deal.id,e.getTasks(n).then(function(e){e.results&&(s.tasks=e)})},s.open=function(e){var n={title:s.title,deal_name:s.deal.name,deal:s.deal.id};t.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{task:n,edit:!1,userData:l,hideDeal:!0}}).then(function(){s.title="",s.getTasks()},function(){})},s.edit=function(e,n){t.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{task:n,edit:!0,userData:l,hideDeal:!0}}).then(function(){s.getTasks()},function(){s.getTasks()})},s.enterSubmit=function(e){if(13===e.which&&s.title){var t={title:s.title};s.createTask(t)}},s.checkedTask=function(t){t.is_complete=!t.is_complete,n(function(){e.updateTask(t.id,{is_complete:!t.is_complete},{is_complete:t.is_complete}).then(function(e){a.show(a.simple().textContent("Task updated").position("bottom center").hideDelay(3e3)),s.getTasks()})},500)},s.activateTask=function(e){e.is_complete=!1,n(function(){s.updateTask({id:e.id,is_complete:e.is_complete})},150)},s.selectDueDateStyle=function(e){return o(e,"colorStatus")},s.createTask=function(t){t.deal=s.deal.id,e.addTask(t).then(function(e){s.title="",a.show(a.simple().textContent("Task created").position("bottom center").hideDelay(3e3)),e.is_complete?(s.completedTasks.results.unshift(e),s.getTasks()):(s.tasks.results.unshift(e),s.getTasks())}).catch(function(e){})},s.deleteTask=function(t){e.deleteTask(t.id).then(function(e){a.show(a.simple().textContent("Task deleted").position("bottom center").hideDelay(3e3)),s.getTasks()}).catch(function(e){})},s.updateTask=function(t,n){e.updateTask(t.id,t,n).then(function(e){a.show(a.simple().textContent("Task updated").position("bottom center").hideDelay(3e3)),s.getTasks()})},s.$onChanges=function(e){e.deal.currentValue&&s.getTasks()},s.myTasksOnly=!1,s.myTasksOnlyChange=function(){s.getTasks()}}e.$inject=["tasksFactory","$mdDialog","$timeout","$mdToast","humanDateFilter","_","userFactory"],angular.module("app").component("dealPanelTasks",{templateUrl:"tasks/deal-panel-tasks.tpl.html",controller:e,bindings:{deal:"<",closable:"<",count:"<",seeAllLink:"<",onClose:"&"}})}(),function(){"use strict";angular.module("app").component("maskerTask",{templateUrl:"tasks/masker-task.tpl.html"})}(),function(){"use strict";function e(e,t,n,a,o,r){function i(){var t={ordering:"due_datetime",is_complete:!1,page_size:25};e.getTasks(t).then(function(e){s.isLoading=!1,s.tasks=[],e.results&&(s.tasks=e.results.slice(0,10))})}var s=this;s.isLoading=!0;var l=null;r.fetchUser().then(function(e){l=e}),s.completeTask=function(t){e.updateTask(t.id,{is_complete:t.is_complete},{is_complete:!0}).then(function(e){a.show(a.simple().textContent("Task updated").position("bottom center").hideDelay(3e3)),i()})},s.edit=function(e,n){s.editFields=!0,t.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!0,locals:{task:angular.copy(e),edit:!0,userData:l,hideDeal:!1}}).then(function(){i()},function(){})},s.open=function(e){var n={title:s.title};t.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{task:angular.copy(n),edit:!1,hideDeal:!1,userData:l}}).then(function(){i()},function(){})},s.selectDueDateStyle=function(e){return n(e,"colorStatus")},i()}e.$inject=["tasksFactory","$mdDialog","humanDateFilter","$mdToast","_","userFactory"],angular.module("app").component("taskListDashboard",{templateUrl:"tasks/task-list-dashboard.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,moment){var l=this,c=null,u=null,d=!1,p=a.getUser(),m=(new Date).getFullYear();l.minDate=new Date(m.toString(),0,1),l.maxDate=new Date((m+10).toString(),11,31),l.isSubmitted=!1,l.saveDisabled=!1,l.openReminderDateDialog=!1,l.openDueDateDialog=!1,l.errors={},o.$watch("$ctrl.selectedTask",function(){null!==l.selectedTask&&void 0!==l.selectedTask&&(l.errors={},l.taskForm&&(l.taskForm.$setUntouched(),l.taskForm.$setPristine()),l.taskClone=s.cloneDeep(l.selectedTask),l.selectedTask.deal?l.assignedDeal={name:l.selectedTask.deal_name,id:l.selectedTask.deal}:l.staticDeal?l.assignedDeal={name:l.staticDeal.name,id:l.staticDeal.id}:(l.assignedDeal=null,l.dealSearchText=null),l.selectedTask.due_datetime&&(l.taskClone.due_datetime=new Date(l.selectedTask.due_datetime)),l.selectedTask.alert_datetime&&(l.taskClone.alert_datetime=new Date(l.selectedTask.alert_datetime)),s.get(l.taskClone,"assignees")||(l.taskClone.assignees=[],l.assignToMe()))}),o.$on("taskModalSubmitted",function(){l.isSubmitted=!0;var e=l.taskForm.$valid;e?l.save():l.taskForm.$submitted=!0}),l.cancel=function(){l.selectedTask=null,l.assignedDeal=null,l.onCancel()},l.assignToMe=function(){l.taskClone.assignees[0]={id:p.id,avatar:p.avatar,first_name:p.first_name,last_name:p.last_name}},l.dateChange=function(){!s.isNull(l.selectedTask.alert_datetime)&&!s.isUndefined(l.selectedTask.alert_datetime)||s.isNull(l.taskClone.alert_datetime)||d!==!1||(d=!0,l.taskClone.alert_datetime=moment(l.taskClone.alert_datetime).hour(8).toDate())},l.save=function(){l.errors={};var e=s.cloneDeep(l.taskClone);return!l.taskForm.$valid&&l.taskForm.$error["md-require-match"]?void(l.errors.assignDeal=!0):(e.assignees&&(void 0===e.assignees[0]||null===e.assignees[0]?e.assignees=[]:void 0!==e.assignees[0].user_id?e.assignees=[e.assignees[0].user_id]:void 0!==e.assignees[0].id&&(e.assignees=[e.assignees[0].id])),s.isEmpty(l.assignedDeal)||(e.deal=l.assignedDeal.id),void(l.selectedTask.id?n.updateTask(l.selectedTask.id,l.selectedTask,e).then(function(e){l.selectedTask=e,l.saveDisabled=!1,i.show(i.simple().textContent("Task updated").position("bottom center").hideDelay(3e3)),l.onSave()}):(s.isEmpty(e.document_body)&&s.unset(e,"document_body"),n.addTask(e).then(function(e){l.saveDisabled=!1,l.selectedTask=e,l.ordering&&"recent"!==l.ordering?i.show(i.simple().textContent("Task added").position("bottom center").action("View Recently Saved Tasks").hideDelay(9e3).highlightAction(!0).highlightClass("md-primary")).then(function(e){"ok"===e&&(l.ordering="recent",l.onSave({params:{ordering:"recent"}}))}):i.show(i.simple().textContent("Task added").position("bottom center").hideDelay(3e3)),l.onSave()}))))},l.delete=function(){n.deleteTask(l.selectedTask.id).then(function(e){l.selectedTask=null,i.show(i.simple().textContent("Task deleted").position("bottom center").hideDelay(3e3)),l.onDelete()})},l.brokerQuerySearch=function(t){c?(c.resolve(),c=r.defer()):c=r.defer();var n={search:t,page_size:25},a={timeout:c.promise},o=r.defer();return e.getBrokers(n,a).then(function(e){o.resolve(e.results),c=null}),o.promise},l.dealQuerySearch=function(e){u?(u.resolve(),u=r.defer()):u=r.defer();var n={search:e,page_size:25},a={timeout:u.promise},o=r.defer();return t.getDeals(n,a).then(function(e){o.resolve(e.results),u=null}),o.promise},l.removeAssignee=function(e){e.preventDefault(),l.taskClone.assignees[0]=null},l.autocompleteFocus=function(){l.errors.assignDeal=!1}}e.$inject=["brokersFactory","dealsFactory","tasksFactory","userFactory","$scope","$q","$mdToast","_","moment"],angular.module("app").component("taskListForm",{templateUrl:"tasks/task-list-form.tpl.html",controller:e,bindings:{selectedTask:"=",staticDeal:"<",onSave:"&",onCancel:"&",onDelete:"&",hideDeal:"<",showActionButtons:"<",ordering:"="}})}(),function(){"use strict";function e(e,t,n,a){var o=this;o.task=t,o.hideDeal=n,o.ok=function(t){e.hide(t)},o.cancel=function(){e.cancel()},o.delete=function(){e.cancel(t)},o.submit=function(){a.$broadcast("taskModalSubmitted")}}e.$inject=["$mdDialog","task","hideDeal","$scope"],angular.module("app").controller("TaskListModalCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u){var d=this,p=null;d.selectedAssignee=null,d.ordering="due_datetime",d.currentKey="Due Date",d.showCompleted=!1,d.sortingKeys={due_date:{sortingKey:"due_datetime",displayName:"Date Due"},priority:{sortingKey:"-is_priority, due_datetime",displayName:"High Priority"},title_asc:{sortingKey:"title",displayName:"Task Title (A - Z)"},title_desc:{sortingKey:"-title",displayName:"Task Title (Z - A)"},created_desc:{sortingKey:"-created",displayName:"Date Created (Recent)"},created_asc:{sortingKey:"created",displayName:"Date Created (Oldest)"}},d.sortTasks=function(t){t&&(d.ordering=t.sortingKey,d.currentKey=t.displayName);var n={ordering:d.ordering};if(d.showCompleted){var a={is_complete:!0};e.merge(n,a)}else{var o={is_complete:!1};e.merge(n,o)}if(d.selectedAssignee){var r={assignees:d.selectedAssignee.user_id};e.merge(n,r)}else{var i={assignees:null};e.merge(n,i)}if(d.myTasksOnly){var s={assignees:c.getUser().id};e.merge(n,s)}else{var l={assignees:null};e.merge(n,l)}d.onGetTasks({params:n})},d.addTask=function(e){if(o("xs")||o("sm")){var t={};d.staticDeal?(t.deal_name=d.staticDeal.name,t.deal=d.staticDeal.id):t.is_private=!0,r.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{task:t,edit:!1,userData:d.userData,hideDeal:d.hideDeal||!1}}).then(function(){d.onGetTasks()},function(e){e&&d.deleteTask(e)})}else d.selectedTask={title:"",alert_datetime:null,document_body:null,is_private:!0,is_complete:!1};d.assignedDeal=null},d.select=function(e,t){o("xs")||o("sm")?r.show({controller:"TaskListModalCtrl",templateUrl:"tasks/task-list-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,locals:{deal:d.assignedDeal,task:t,edit:!0,userData:d.userData,hideDeal:d.hideDeal||!1}}).then(function(e){d.onGetTasks()},function(e){}):(u.$emit("taskSelected"),d.selectedTask=angular.copy(t),d.selectedTask.deal?d.assignedDeal={id:d.selectedTask.deal,name:d.selectedTask.deal_name}:d.assignedDeal=null)},d.deleteTask=function(e){n.deleteTask(e.id).then(function(e){d.onGetTasks(),i.show(i.simple().textContent("Task deleted").position("bottom center").hideDelay(3e3))}).catch(function(e){})},d.toggleTaskStatus=function(e){e.is_complete=!e.is_complete,a(function(){d.onUpdateTask({task:{is_complete:!e.is_complete,id:e.id}})},250)},d.switchPage=function(e){d.onGetTasks({params:{page:e}})},d.openMenu=function(e,t){e(t)},d.selectDueDateStyle=function(e){return t(e,"colorStatus")},d.myTasksOnly=!1,d.myTasksOnlyChange=function(){d.sortTasks()},d.showCompletedTasks=function(){d.sortTasks()},d.brokerQuerySearch=function(e){p?(p.resolve(),p=l.defer()):p=l.defer();var t={search:e,page_size:25},n={timeout:p.promise},a=l.defer();return s.getBrokers(t,n).then(function(e){a.resolve(e.results),p=null}),a.promise},d.assigneeChange=function(){d.sortTasks()},d.removeAssignee=function(){d.selectedAssignee=null,d.sortTasks()}}e.$inject=["_","humanDateFilter","tasksFactory","$timeout","$mdMedia","$mdDialog","$mdToast","brokersFactory","$q","userFactory","$scope"],angular.module("app").component("taskListPage",{templateUrl:"tasks/task-list-page.tpl.html",controller:e,bindings:{selectedTask:"=",assignedDeal:"=",staticDeal:"=",data:"=",pageSize:"<",page:"=",onGetTasks:"&",onUpdateTask:"&",userData:"<",ordering:"=",hideDeal:"<"}})}(),function(){"use strict";function e(e,t,n,a,o){var r=this;r.declinedAgreement=!1,r.$onInit=function(){e.$emit("updatePageTitle","Terms of Agreement"),r.today=new Date,t.fetchUser().then(function(e){r.user=e}),n.getTerms().then(function(e){o.has(e,"results[0].data")&&(r.agreementText=e.results[0].data)})},r.agree=function(){t.update({signed_broker_user_agreement:!0}).then(function(){a.go("app.deals")})},r.decline=function(){r.declinedAgreement=!0,t.update({signed_broker_user_agreement:!1}).then(function(){})}}e.$inject=["$scope","userFactory","termsFactory","$state","_"],angular.module("app").component("agreement",{templateUrl:"routes/agreement/agreement.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u,d,p,m,f,g,h,v,_){function y(){function e(e){e||r.initiateLogin(),e.signed_broker_user_agreement||a.path().indexOf("agreement")!==-1||(n.location.href="/agreement"),e&&(S.userData=e,b(),T(),D(),C())}i.fetchUser().then(e)}function b(){l.fetchOptions().then(function(e){S.userOptions=e})}function C(){u.$on("$locationChangeStart",function(e,t,n){var a={toState:t,fromState:n,platform:v.getMobileOperatingSystem()};s.addUserEvent(S.userData.id,"navigation",a)})}function T(){var e;n._paq.push(["setCustomDimension",1,S.userData.title]),e=S.userData.first_name+" "+S.userData.last_name,S.userData.work_email&&(e+=" ("+S.userData.work_email+")"),n._paq.push(["setCustomVariable",1,"Employee",e,"visit"]),n._paq.push(["setCustomVariable",2,"Avatar URL",S.userData.avatar,"visit"])}function D(){c.init(S.userData)}function $(e,t){m.show({controller:"ErrorModal",controllerAs:"vm",templateUrl:"shared/error-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{message:t,status:e}})}function k(e,t,n){var a;return function(){var n=this,r=Array.prototype.slice.call(arguments);o.cancel(a),a=o(function(){a=void 0,e.apply(n,r)},t||10)}}function w(e,t){return k(function(){"open"===t?f(e).toggle():"close"===t?f(e).close():f(e).toggle()},100)}var S=this,x=angular.element(t);h.init(),S.closeMenu=w("menu","close"),S.openMenu=w("menu","open"),S.userData=null,S.userOptions=null,S.uploads=[],x.addClass("layout-column flex"),_.onSuccess({to:"**"},function(e){u.$emit("dealLifeCycleStageUpdated","")}),u.$on("uploadAttachment",function(n,a){if(a.files){var o=e.$new(!0),r=p("<deal-panel-attachments-upload-toast>")(o),i=Date.now();for(var s in a.files){var l=a.files[s];if(l.size>5e9)return void $("403","This file size is too large. Try uploading a file smaller than 5GB.")}o.finished&&o.close(),t.children().append(r),o.fileName=a.fileData.document_name,o.finished=!1,o.close=function(){r.remove()};var c=function(e){var t=Date.now()-i,n=e.loaded/(t/1e3),a=Math.ceil((e.total-e.loaded)/n);0===a&&(o.finished=!0,setTimeout(o.close.bind(o),4e3)),o.timeLeft=a,o.progress=parseInt(100*e.loaded/e.total)}}a.edit?d.updateAttachment(a.fileData,a.files,function(e){c&&c(e)}).then(function(){a.callback()},function(e){403===e.status&&$("403","The current file extension is not supported."),o.close()}):d.addAttachment(a.fileData,a.files,function(e){c&&c(e)}).then(function(){a.callback()},function(e){403===e.status&&$("403","The current file extension is not supported."),o.close()})}),u.$on("openProspectModal",function(e,t){if(t)var n=t.dealStage,a=t.ev;S.openProspectModal(a,n)}),S.$onInit=function(){r.getToken()?y():r.initiateLogin()},S.goTo=function(e){S.closeMenu(),g.go(e)},S.openProspectModal=function(e,t){S.closeMenu(),m.show({controller:"HeaderProspectModalInstanceCtrl",templateUrl:"header/header-prospect-modal.tpl.html",parent:angular.element(document.body),targetEvent:e,controllerAs:"vm",clickOutsideToClose:!0,locals:{dealStage:t}}).then(function(e){},function(){})}}e.$inject=["$scope","$element","$window","$location","$timeout","authFactory","userFactory","userEventsFactory","userOptionsFactory","intercomFactory","$rootScope","attachmentsFactory","$compile","$mdDialog","$mdSidenav","$state","resizeFactory","platformFactory","$transitions"],angular.module("app").component("app",{templateUrl:"routes/app/app.tpl.html",controller:e})}(),function(){"use strict";angular.module("app").component("callback",{templateUrl:"routes/callback/callback.tpl.html"})}(),function(){"use strict";function e(){}angular.module("app").component("commissionsBreakdown",{templateUrl:"routes/commissions/commissions-breakdown.tpl.html",controller:e})}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){},e.yearSelect=function(){e.onYearSelect({data:e.year})},e.startMonthSelect=function(){e.onChangeStartMonth({data:e.startMonth})},e.endMonthSelect=function(){e.onChangeEndMonth({data:e.endMonth})}}angular.module("app").component("commissionsFilter",{templateUrl:"routes/commissions/commissions-filter.tpl.html",controller:e,bindings:{year:"<",validYears:"<",validMonths:"<",startMonth:"<",endMonth:"<",onChangeStartMonth:"&",onChangeEndMonth:"&",onYearSelect:"&"}})}(),function(){"use strict";function e(e,t,n,a,o,r,moment,i,s,l,c){function u(e,t){W.loading=!0,W.empty=!1,W.transactions=[];var n={page_size:5e3,ordering:"accounting_date",start_date:e,end_date:t};l.getCommissions(n).then(function(e){W.loading=!1,W.transactions=O(e.results),W.transactions.length>0?(W.data=M(W.transactions),p()):(W.empty=!0,W.transactions=[],W.data=U(),p())})}function d(e,t){W.loading=!0,W.tableTransactions=[];var n={page_size:5e3,ordering:"-accounting_date",start_date:e,end_date:t};l.getCommissions(n).then(function(e){W.loading=!1,W.tableTransactions=O(e.results)})}function p(){var e=moment(W.year+"-01-01").startOf("year").add(W.validMonths.indexOf(W.startMonth),"months").toDate(),t=moment(W.year+"-01-01").startOf("year").add(W.validMonths.indexOf(W.endMonth)+1,"months").subtract(1,"days").toDate();Q=d3.scaleTime().domain(d3.extent(W.data,function(e){return ae(e.date)})).range([H,R]);var n=W.data.filter(function(n){if(moment(e).isBefore(moment(n.date))&&moment(t).isAfter(moment(n.date)))return n}),a=d3.max(n,function(e){return W.grossCommissions?e.gross_paid+e.gross_upcoming+e.gross_forecast+e.gross_past_due:e.paid+e.upcoming+e.forecast+e.past_due});X=d3.scaleLinear().domain([a,0]).range([V,Y]);var o=d3.axisBottom().scale(Q).ticks(12).tickSizeInner(-Y+V).tickPadding(8).tickFormat(function(e){return e.toString().substring(4,7)});ie.call(o);var r=d3.axisRight().scale(X).ticks(4).tickPadding(0).tickSizeInner(R).tickFormat(S);se.transition().call(r);var i=d3.axisRight().scale(X).ticks(4).tickSizeInner(R-30).tickFormat("");le.transition().call(i),te.selectAll(".yAxisLines line").attr("stroke","#CCC").attr("stroke-dasharray","2, 2"),te.selectAll(".yAxisLines .domain, .yAxisText .domain, .xAxis .domain, .yAxisText line").attr("stroke","none"),te.selectAll(".yAxisLines text, yAxixText line").attr("stroke","transparent").attr("fill","transparent"),te.selectAll(".yAxisText text").attr("stroke",q).attr("fill",q).attr("font-size","9").attr("font-weight","100").attr("text-anchor","end").style("text-shadow","0 0 2px #fff"),te.selectAll(".xAxis text").attr("stroke",q).attr("fill",q).attr("font-size","8").attr("font-weight","100"),m(!1),C(W.data,t),Z.forEach(function(e,t){var n=te.select("path.line#"+e),a=te.select("path.area#"+e);if(W.showStacks[t]){var o=d3.line().curve(d3.curveMonotoneX).x(v).y(function(e){return X(h(t,e))});n.datum(W.data).transition().duration(500).attr("d",o).attr("opacity",1).attr("stroke",function(){return $(t)}).attr("stroke-width",1.5).attr("stroke-dasharray",function(){return k(t)});var r=d3.area().curve(d3.curveMonotoneX).x(v).y0(function(e){return X(g(t,e))}).y1(function(e){return X(h(t,e))});a.datum(W.data).transition().duration(500).attr("d",r).attr("fill",function(){return $(t)}).attr("opacity",function(){return w(t)})}else n.transition().duration(500).attr("opacity",0),a.transition().duration(500).attr("opacity",0)});for(var s=Z.length-1;s>=0;s--)if(W.showStacks[s]){var l=Z[s],c=te.select("path.line#"+l),u=te.select("path.area#"+l);c.moveToFront(),u.moveToFront()}te.selectAll(".yAxisText").moveToFront()}function m(e){var t=W.validMonths.indexOf(W.startMonth),n=W.validMonths.indexOf(W.endMonth)+1,a=moment(W.year+"-01-01").add(t,"months"),o=moment(W.year+"-01-01").add(n,"months");Q=d3.scaleTime().domain([a,o]).range([H,R]),e?te.selectAll(".xAxis g").transition().duration(z).attr("transform",function(e){return"translate("+Q(e)+",0)"}):te.selectAll(".xAxis g").attr("transform",function(e){return"translate("+Q(e)+",0)"}),D(e),T(),te.selectAll(".xAxis text").each(function(e){var t=Math.abs(moment(e).diff(moment(a),"days")),n=Math.abs(moment(e).diff(moment(o),"days"));t<5?(d3.select(this).attr("text-anchor","start"),d3.select(this).attr("opacity",1)):n<5?d3.select(this).attr("opacity",0):(d3.select(this).attr("text-anchor","middle"),d3.select(this).attr("opacity",1))})}function f(){m(!0),Z.forEach(function(e,t){var n=te.select("path.line#"+e),a=d3.line().curve(d3.curveMonotoneX).x(v).y(function(e){return X(h(t,e))});n.datum(W.data).transition().duration(z).attr("d",a);var o=d3.area().curve(d3.curveMonotoneX).x(v).y0(function(e){return X(g(t,e))}).y1(function(e){return X(h(t,e))}),r=te.select("path.area#"+e);r.datum(W.data).transition().duration(z).attr("d",o)})}function g(e,t){return 0===e?X.domain()[1]:h(e-1,t)}function h(e,t){var n;return n=W.grossCommissions?t[J[e]]:t[Z[e]],0===e?W.showStacks[0]?n:0:W.showStacks[e]?n+h(e-1,t):h(e-1,t)}function v(e){return Q(ae(e.date))}function _(){"all"===W.filter&&(W.showStacks=[!0,!0,!0,!0]),"receivables"===W.filter&&(W.showStacks=[!0,!0,!1,!1]),"paid"===W.filter&&(W.showStacks=[!0,!1,!1,!1]),"pastDue"===W.filter&&(W.showStacks=[!1,!0,!1,!1]),"upcoming"===W.filter&&(W.showStacks=[!1,!1,!0,!1]),"forecast"===W.filter&&(W.showStacks=[!1,!1,!1,!0]),p()}function y(){p()}function b(){d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)})}}function C(e,t){function n(e,t,n){var a,o=0;if(e.length>0){for(;o<e.length-1&&(a=ae(e[o].date).getTime(),!(a>=t.getTime()));)o++;if(t.getTime()===a||0===o)return e[o][n];var r=e[o-1][n];return r}}var a=[];a[0]=n(e,t,W.grossCommissions?"gross_paid":"paid"),a[1]=n(e,t,W.grossCommissions?"gross_past_due":"past_due"),a[2]=n(e,t,W.grossCommissions?"gross_upcoming":"upcoming"),a[3]=n(e,t,W.grossCommissions?"gross_forecast":"forecast"),W.date=oe(t),W.paid=re(a[0]),W.past_due=re(a[1]),W.upcoming=re(a[2]),W.forecast=re(a[3]),W.total=re(a[0]+a[1]+a[2]+a[3])}function T(){var e=Q(new Date);ce.transition().duration(z).attr("x1",e).attr("x2",e),ue.transition().duration(z).attr("x",function(){return e}),e<Q.range()[0]+30?ue.attr("text-anchor","start"):e>Q.range()[1]-30?ue.attr("text-anchor","end"):ue.attr("text-anchor","middle")}function D(e){function t(e,t){var n=a[t-1].__data__,o=new Date((e.getTime()-n.getTime())/2+n.getTime()),r=Q(o)-Q(n);return r}var n=te.selectAll(".xAxis line"),a=n.nodes();e?n.transition().duration(z).attr("transform",function(e,n){if(n%2)return"translate(-"+t(e,n)+", 0)"}).attr("stroke-width",function(e,n){if(n%2)return 2*t(e,n)}).attr("stroke",K):n.attr("transform",function(e,n){if(n%2)return"translate(-"+t(e,n)+", 0)"}).attr("stroke-width",function(e,n){if(n%2)return 2*t(e,n)}).attr("stroke",K)}function $(e){if(W.empty){var t=200-parseInt(100*Math.random());return"rgb("+t+","+t+","+t+")"}return 0===e?E:1===e?I:2===e?j:3===e?L:void 0}function k(e){return 2===e||3===e?"5 5":void 0}function w(e){return 2===e||3===e?0:.25}function S(e){var t=String(e);return e>=1e9?t=String(e/1e9).substring(0,3)+"B":e>=1e6?t=String(e/1e6).substring(0,3)+"M":e>=1e3&&(t=String(e/1e3).substring(0,3)+"K"),"$"+t}function x(e){for(var t=[],n=e;n<=moment().year();n++)t.push(n);return t.reverse()}function P(e){e&&(W.year=e,W.displayYear=!0),W.startMonth="January",W.endMonth="December";var t=moment(W.year+"-01-01"),n=moment(W.year+"-12-31");u(t.format("YYYY-MM-DD"),n.format("YYYY-MM-DD")),d(t.format("YYYY-MM-DD"),n.format("YYYY-MM-DD"))}function A(e){e&&(W.startMonth=e);var t=W.validMonths.indexOf(W.startMonth)+1,n=W.validMonths.indexOf(W.endMonth)+2;t>=n&&(W.endMonth=W.startMonth),f(),p()}function F(e){e&&(W.endMonth=e);var t=W.validMonths.indexOf(W.startMonth)+1,n=W.validMonths.indexOf(W.endMonth)+2;n<=t&&(W.startMonth=W.endMonth),f(),p()}function U(){function e(){return Math.random()>.5?1e5*Math.random():0}var t=[],n=moment().year(W.year),a=new Date(W.year+"-01-01"),o=moment(a);for(t.push({date:a.toISOString().substring(0,10),paid:Math.random()*e(),past_due:Math.random()*e(),upcoming:0,forecast:0,gross_paid:Math.random()*e(),gross_past_due:Math.random()*e(),gross_upcoming:0,gross_forecast:0});Number(o.year())<=Number(W.year);)o.add(7,"days"),t.push({date:o.toISOString().substring(0,10),paid:t[t.length-1].paid+(o<n?e():0),past_due:t[t.length-1].past_due+(o<n?e():0),upcoming:t[t.length-1].upcoming+(o<n?0:e()),forecast:t[t.length-1].forecast+(o<n?0:e())});return t}function O(e){return e.filter(function(e){return e.total_net_amount>1||e.total_net_amount<0})}function M(e){var t=e[0].accounting_date,n=e[e.length-1].accounting_date,a=moment(t).startOf("year"),o=moment(n).startOf("year").add(1,"year"),r=[{date:a.format("YYYY-MM-DD"),paid:0,past_due:0,upcoming:0,forecast:0,gross_paid:0,gross_past_due:0,gross_upcoming:0,gross_forecast:0}],i={paid:0,past_due:0,upcoming:0,forecast:0,gross_paid:0,gross_past_due:0,gross_upcoming:0,gross_forecast:0};return e.forEach(function(e){var t=moment(e.accounting_date);i[e.payment_status.toLowerCase()]+=Number(e.total_net_amount),i["gross_"+e.payment_status.toLowerCase()]+=Number(e.gross_amount);var n=angular.copy(i);n.date=t.format("YYYY-MM-DD"),r.push(n)}),r.push({date:o.format("YYYY-MM-DD"),paid:r[r.length-1].paid,past_due:r[r.length-1].past_due,upcoming:r[r.length-1].upcoming,forecast:r[r.length-1].forecast,gross_paid:r[r.length-1].gross_paid,gross_past_due:r[r.length-1].gross_past_due,gross_upcoming:r[r.length-1].gross_upcoming,gross_forecast:r[r.length-1].gross_forecast}),r}e.$emit("updatePageTitle","Commissions Overview");var E="#00a657",I="#e73316",j="#00b2dd",L="#af3cf1",N="gray",q="#747474",K="#f4f4f4",z=500,R=1e3,Y=200,B=0,G=0,H=0,V=20,W=this,d3=t.d3;W.userOptions=c.getUserOptions(),W.loading=!1,W.empty=!0,W.year=moment().year(),W.displayYear=!1,W.validYears=x(2008),W.yearSelect=P,W.changeStartMonth=A,W.changeEndMonth=F,W.filter="all",W.filterSelect=_,W.validMonths=["January","February","March","April","May","June","July","August","September","October","November","December"],W.startMonth="January",W.endMonth="December",W.projectedPopover={title:"Projected Net/Gross",text:"This number is the sum of paid, past due, upcoming, and forecast put together.",showTitle:!1},W.grossCommissions=!1,W.switchModes=y,W.date="",W.paid="",W.past_due="",W.upcoming="",W.forecast="",W.total="",b();var Z=["paid","past_due","upcoming","forecast"],J=["gross_paid","gross_past_due","gross_upcoming","gross_forecast"];W.showStacks=[!0,!0,!0,!0];var Q,X,ee=d3.select("#chart"),te=ee.append("svg").attr("viewBox","0 0 "+(H+R+B)+" "+(V+Y+G)).attr("preserveAspectRatio","xMidYMax meet"),ne=te.append("defs"),ae=d3.timeParse("%Y-%m-%d"),oe=d3.timeFormat("%x"),re=d3.format("$,.0f");Z.forEach(function(e,t){te.append("path").attr("id",e).attr("class","area").attr("stroke","transparent"),te.append("path").attr("id",e).attr("fill","transparent").attr("class","line");var n=ne.append("mask").attr("id","mask-"+e);n.append("rect").attr("id","opaque").attr("fill","white").attr("x",H).attr("y",V).attr("width",R).attr("height",Y),n.append("rect").attr("id","transparent").attr("fill","#444").attr("x",R).attr("y",V).attr("width",0).attr("height",Y)});var ie=te.append("g").attr("class","xAxis").attr("transform","translate(0, "+Y+")"),se=te.append("g").attr("class","yAxisText").attr("transform","translate("+H+", 0)"),le=te.append("g").attr("class","yAxisLines").attr("transform","translate("+H+", 0)"),ce=te.append("line").attr("class","dateLine").attr("y1",V).attr("y2",Y).attr("x1",-100).attr("x2",-100).attr("stroke",N).attr("stroke-width",2).attr("stroke-dasharray","5").attr("opacity",.3),ue=te.append("text").attr("fill",N).attr("y",V-6).attr("x",-100).text("Today");P(),W.sortingKeys={date_desc:{sortingKey:"-accounting_date",displayName:"Date Recognized (Recent)"},date_asc:{sortingKey:"accounting_date",displayName:"Date Recognized (Oldest)"},gross_asc:{
sortingKey:"gross_amount",displayName:"Gross (Low to High)"},gross_desc:{sortingKey:"-gross_amount",displayName:"Gross (High to Low)"},net_asc:{sortingKey:"net_amount",displayName:"Net (Low to High)"},net_desc:{sortingKey:"-net_amount",displayName:"Net (High to Low)"},commission_asc:{sortingKey:"net_split",displayName:"Split (Low to High)"},commission_desc:{sortingKey:"-net_split",displayName:"Split (High to Low)"}},W.sortTable=function(e){W.loading=!0,W.tableTransactions=[];var t={page_size:5e3,ordering:e.sortingKey,start_date:e.startDate,end_date:e.endDate};l.getCommissions(t).then(function(e){W.loading=!1,W.tableTransactions=O(e.results)})}}e.$inject=["$scope","$window","$location","$state","$mdDialog","$mdToast","moment","$log","$timeout","commissionsFactory","userOptionsFactory"],angular.module("app").component("commissionsOverview",{templateUrl:"routes/commissions/commissions-overview.tpl.html",controller:e})}(),function(){"use strict";function e(e){var t=this;t.startDate="",t.endDate="",t.currentSortingKey=t.sortingKeys.date_desc,t.$onInit=function(){},e.$on("filterTransactions",function(e,n){t.startDate=n.startDate,t.endDate=n.endDate}),t.sortByKey=function(e){var n={};n.sortingKey=e.sortingKey,n.startDate=t.startDate,n.endDate=t.endDate,t.onSortTable({data:n}),t.currentSortingKey=e}}e.$inject=["$scope"],angular.module("app").component("commissionsSort",{templateUrl:"routes/commissions/commissions-sort.tpl.html",controller:e,bindings:{sortingKeys:"<",onSortTable:"&"}})}(),function(){"use strict";function e(e,moment,t){var n=this;n.filteredTransactions=[],n.columns=["final property","gross","net","split","status","date","deal"],n.startDate=moment(n.year+"-01-01").add(n.startMonth,"months"),n.endDate=moment(n.year+"-01-01").add(n.endMonth,"months").endOf("month"),n.$onChanges=function(t,a){n.transactions&&n.filterTransactions(),setTimeout(function(){var t={};t.startDate=moment(n.startDate).format("YYYY-MM-DD"),t.endDate=moment(n.endDate).format("YYYY-MM-DD"),e.$parent.$broadcast("filterTransactions",t)},1e3)},n.filterTransactions=function(){if(n.transactions.length>0){var e=n.transactions[Math.floor(Math.random()*n.transactions.length)],t=moment(e.accounting_date);n.startDate=moment(t.year()+"-01-01").add(n.startMonth,"months"),n.endDate=moment(t.year()+"-01-01").add(n.endMonth,"months").endOf("month")}n.filteredTransactions=n.transactions.filter(function(e){var t=moment(e.accounting_date);return!(t<n.startDate||t>n.endDate)&&(("Paid"!==e.payment_status||n.filteredIndices[0]!==!1)&&(("past_due"!==e.payment_status||n.filteredIndices[1]!==!1)&&(("upcoming"!==e.payment_status||n.filteredIndices[2]!==!1)&&("forecast"!==e.payment_status||n.filteredIndices[3]!==!1))))})}}e.$inject=["$scope","moment","_"],angular.module("app").component("commissionsTable",{templateUrl:"routes/commissions/commissions-table.tpl.html",controller:e,bindings:{transactions:"<",startMonth:"<",endMonth:"<",year:"<",filteredIndices:"<"}})}(),function(){"use strict";function e(){}angular.module("app").component("compSearchMap",{templateUrl:"routes/comp-search/comp-search-map.tpl.html",controller:e})}(),function(){"use strict";function e(){}angular.module("app").component("compSearchSidebar",{templateUrl:"routes/comp-search/comp-search-sidebar.tpl.html",controller:e})}(),function(){"use strict";function e(){}angular.module("app").component("compSearch",{templateUrl:"routes/comp-search/comp-search.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c){function u(e){n.show(n.simple().textContent(e).position("bottom center").hideDelay(3e3))}function d(n){var a={page_size:100,ordering:f,hidden:!1};return t.merge(a,n),e.getPersonalContacts(a).then(function(e){return m.count=e.count,m.contacts=e.results,e},function(e){s.error("Error getting contacts",e)})}function p(){var e=/outlooksync=true/,t=e.test(l.location.search);t&&(m.isShowList=!1,o.show({controller:"ContactOutlookSyncLoadingModalInstanceCtrl",templateUrl:"contacts/contact-outlook-sync-loading-modal.tpl.html",controllerAs:"vm"}).then(function(){m.isShowList=!0}))}var m=this,f="";m.isShowList=!0,m.userOptions=c.getUserOptions(),m.outlookSyncFeatureFlag=m.userOptions.feature_flags.outlook_sync_feature_flag,m.outlookSyncEnabled=m.userOptions.outlook_sync_enabled,m.contactListOptions={showOther:!1,showSortDropdown:!0,showFilters:!0},m.contactFormOptions={showPrimaryDealCheckbox:!1,enableAddToPersonalCheckbox:!1,hideAddToPersonalCheckbox:!0},m.mode="read",m.hiddenFilter=!1,m.$onInit=function(){m.deal=m.dealResolve,m.user=r.getUser(),p(),d()},m.toggleEditWithActionOnInit=function(e,t){m.actionOnInit={action:t,type:e},m.mode="edit"},m.onContactSelected=function(t,n){if(n?(m.actionOnInit=n,m.mode="edit"):m.actionOnInit={action:"none"},i.$broadcast("onContactSelected"),t?m.selectedContact=t:(m.selectedContact=e.createEmptyPersonalContact(m.user.id),t=m.selectedContact,m.mode="edit"),a("xs")||a("sm")){var r={showPrimaryDealCheckbox:!1,enableAddToPersonalCheckbox:!1,title:"Personal Contact",hideAddToPersonalCheckbox:!0};o.show({controller:"ContactModalInstanceCtrl",templateUrl:"contacts/contact-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{contact:t,contactFormOptions:r,initAction:n}}).then(m.saveContact)}},m.onContactDelete=function(t){var a=o.confirm({title:"Are you sure?",textContent:"This contact will be deleted permanently.",ok:"Delete",cancel:"Cancel"});o.show(a).then(function(){e.deletePersonalContact(t).then(function(){m.selectedContact=null,d(),n.show(n.simple().textContent("Contact deleted").position("bottom center").hideDelay(3e3))})})},m.toggleMode=function(){"read"===m.mode?m.mode="edit":(m.selectedContact.id||(m.selectedContact=null),m.mode="read")},m.saveContact=function(n){function a(e){u("Contact updated"),s(e)}function o(){u("Contact update failed")}function r(e){u("Contact added"),s(e)}function i(){u("Contact add failed")}function s(e){m.mode="read",d().then(function(){t.each(m.contacts,function(t){t.id===e.id&&(m.selectedContact=t)})})}n.id?e.updatePersonalContact(n.id,n).then(a,o):e.addPersonalContact(n).then(r,i)},m.cancelForm=function(){m.selectedContact.id||(m.selectedContact=null),m.mode="read"},m.onContactUpdate=function(t,n){e.updatePersonalContact(t,n)},m.onSortChange=function(e){switch(e){case"person-a-z":f="surname";break;case"person-z-a":f="-surname";break;case"company-a-z":f="company_name";break;case"company-z-a":f="-company_name";break;default:f=""}d()},m.outlookSync=function(){m.user.employee_work_email?o.show({controller:"ContactOutlookSyncModalInstanceCtrl",templateUrl:"contacts/contact-outlook-sync-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0}):o.show({controller:"ContactOutlookSyncErrorModalInstanceCtrl",templateUrl:"contacts/contact-outlook-sync-error-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0})},m.onHiddenFilterChange=function(e){var t={hidden:e};d(t)},m.optOutOfOutlookSync=function(e){o.show({controller:"ContactOutlookUnsyncModalInstanceCtrl",templateUrl:"contacts/contact-outlook-unsync-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(){c.update("outlook_sync_enabled",!1)},function(){})}}e.$inject=["contactsFactory","_","$mdToast","$mdMedia","$mdDialog","userFactory","$scope","$log","$window","userOptionsFactory"],angular.module("app").component("personalContacts",{templateUrl:"routes/contacts/personal-contacts.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a){var o=this;o.$onInit=function(){},e.$emit("updatePageTitle","Dashboard"),o.goToDeal=function(e){n.go("app.dealsDetail",{id:e.id})},o.openProspectModal=function(){t.$emit("openProspectModal",{dealStage:"prospect"})}}e.$inject=["$scope","$rootScope","$state","dealsFactory"],angular.module("app").component("dashboard",{templateUrl:"routes/dashboard/dashboard.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u,d,p){function m(t,n){function a(e){for(var t in n)C.deal[t]=e[t];C.editModeToggle(!1),f(C.deal.rep_role)}e.updateDeal(t,n).then(a)}function f(e){var t=T[e];g(),r.each(t,function(e){C.activeTabs[e]=!0})}function g(){r.each(C.activeTabs,function(e,t){C.activeTabs[t]=!1})}function h(){C.dealLastSubstage=e.getLastSubstage(C.deal)}function v(e){var t=o.defer(),n={name:e};return a.addClient(n).then(function(e){t.resolve(e)}),t.promise}function _(){u.$on("dealUpdated",function(e,t){C.deal=t}),u.$on("userPreferencesUpdated",function(e){C.userOptions=t.getUserOptions()}),C.activeNav=p.current.name,d.onEnter({to:"app.dealsDetail.**"},function(e,t){C.activeNav=t.name})}function y(){C.deal=C.dealResolve,u.$emit("dealLifeCycleStageUpdated",C.deal.deal_life_cycle_stage),h(),f(C.deal.rep_role),_()}var b,C=this;C.isDisabled=!1,C.noCache=!0,C.searchText=null,C.errors={},C.warnings={},C.activeNav=null,C.$onInit=function(){C.selectedClient=r.clone(C.dealResolve.client),y()},C.createVoucher=function(){c.path("voucher/"+C.deal.id+"1_getting_started")},C.showStatus=function(){"closed"!==C.deal.deal_life_cycle_stage&&i.show({controller:"DealStatusModal",templateUrl:"deals/deals-status-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,controllerAs:"vm",locals:{deal:angular.copy(C.deal)}}).then(function(t){var n=s.diffObject(angular.copy(C.deal),t);e.updateDeal(C.deal.id,n).then(function(e){C.deal=e,h()})})},C.selectedClientChange=function(e){e?C.warnings.clientMissing=!1:C.warnings.clientMissing=!0},C.checkSelected=function(e){e||(C.warnings.clientMissing=!0)},C.querySearch=function(e){b?(b.resolve(),b=o.defer()):b=o.defer();var t={search:e,page_size:10},n={timeout:b.promise},r=o.defer();return a.getClients(t,n).then(function(e){C.clients=e,r.resolve(e),b=null}),r.promise},C.createClient=function(e){C.selectedClient={name:e}},C.syncToSalesforce=function(){function t(t){e.updateDeal(C.deal.id,t).then(function(e){C.deal=e,h()})}function n(){}i.show({controller:"SalesforceModal",templateUrl:"deals/salesforce-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,controllerAs:"vm",locals:{deal:C.deal}}).then(t,n)};var T={tenant:["overview","notes","tasks","attachments","properties","contacts","financials"],landlord:["overview","notes","tasks","attachments","properties","contacts","financials"],buyer:["overview","notes","tasks","attachments","properties","contacts","financials"],seller:["overview","notes","tasks","attachments","properties","contacts","financials"],consulting:["overview","notes","tasks","attachments","properties","contacts","financials"],other:["overview","notes","tasks","attachments","properties","contacts","financials"]};C.userOptions=t.getUserOptions(),C.activeTabs={overview:!1,space:!1,voucher:!1,comps:!1,availabilities:!1},C.detailTab="overview",C.dateField=new Date,C.editName=!1,C.dealLastSubstage="",C.setEditVoucher=function(e){C.editVoucher=e},C.open=function(){C.opened=!0},C.changeDetailTab=function(e){C.detailTab=e},C.archiveDeal=function(){e.updateDeal(C.deal.id,{is_archived:!0}).then(function(){var e="This deal is hidden from your ";"prospect"===C.deal.deal_life_cycle_stage?e+="prospects":"executing"===C.deal.deal_life_cycle_stage&&(e+="executing"),n.show(n.simple().textContent(e).position("bottom center").hideDelay(3e3))})},C.restoreDeal=function(){e.updateDeal(C.deal.id,{is_archived:!1}).then(function(){C.deal.is_archived=!1})},C.openDeleteDealModal=function(){function t(t){if("archive-deal"===t)C.archiveDeal();else if("delete-deal"===t){var a={is_deleted:!0};e.updateDeal(C.deal.id,a).then(function(){var e="This deal is deleted from your ";"prospect"===C.deal.deal_life_cycle_stage?e+="prospects.":"executing"===C.deal.deal_life_cycle_stage&&(e+="executing deals."),n.show(n.simple().textContent(e).position("bottom center").hideDelay(3e3)),"prospect"===C.deal.deal_life_cycle_stage?p.go("app.deals.prospects"):"executing"===C.deal.deal_life_cycle_stage&&p.go("app.deals.executing")})}}function a(){}i.show({controller:"DeleteDealModal",templateUrl:"deals/delete-deal-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,controllerAs:"vm",locals:{deal:C.deal},bindToController:!0}).then(t,a)},C.editMode=!1,C.editModeToggle=function(e){if(e){if("closed"===C.deal.deal_life_cycle_stage)return;C.editMode=!0,C.newDealName=r.clone(C.deal.name),C.selectedClient=r.clone(C.deal.client)}else e||(C.editMode=!1)},C.saveDeal=function(){var e={};C.deal.name!==C.newDealName&&(e.name=C.newDealName),r.get(C.selectedClient,"id")?r.get(C.deal,"client.id")!==r.get(C.selectedClient,"id")?(e.client=C.selectedClient.id,m(C.deal.id,e)):e.name&&m(C.deal.id,e):v(C.searchText).then(function(t){C.selectedClient=t,e.client=t.id,m(C.deal.id,e)}),C.editModeToggle(!1)},C.unFavoriteDeal=function(){e.unFavoriteDeal(C.deal.id)},C.favoriteDeal=function(){e.favoriteDeal(C.deal.id)}}e.$inject=["dealsFactory","userOptionsFactory","$mdToast","clientsFactory","$q","_","$mdDialog","loscoreFactory","vouchersFactory","$location","$rootScope","$transitions","$state"],angular.module("app").component("dealsDetail",{templateUrl:"routes/deals/deals-detail.tpl.html",controller:e,bindings:{dealResolve:"<"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s){function l(e){null===u.emptyState&&0===e.count?u.emptyState=!0:u.emptyState=!1,u.loading=!1,u.deals=e}function c(){var e={deal_stage:"closed"};n.getTags(e).then(function(e){u.allTags=e.tags_on_all_deals})}var u=this;u.$onInit=function(){o.$emit("updatePageTitle","Closed Deals"),r.$emit("dealLifeCycleStageUpdated","closed"),u.userOptions=t.getUserOptions(),u.deals=null,u.emptyState=null,u.options={dealStage:"closed",columnKey:"closed_column_order"};var e=a.get("closedState");u.params={deal_life_cycle_stage:"closed",is_archived:e?e.is_archived:void 0,user_wants_salesforce_export:e?e.user_wants_salesforce_export:void 0,ordering:e?e.ordering:"-modified",date_approved_min:e?e.date_approved_min:void 0,date_approved_max:e?e.date_approved_max:void 0,page:e?e.page:void 0,page_size:25,search:null},u.getDeals(),c()},u.search=function(e){u.params.search=e||null,u.params.page=1,u.getDeals()},u.getDeals=function(t){u.loading=!0,t&&angular.extend(u.params,t),a.save("closedState",u.params),e.getDeals(u.params).then(l)},u.onTagSelected=function(e){u.currentTags=e,u.params.tags=null;var t={};e.length>0&&(t.tags=e.join(",")),u.getDeals(t)},u.exportList=function(){function t(e){}function n(e){i.error(e)}e.exportDeals(u.params).then(t,n)},u.manageExecuting=function(e){s.go("app.deals.executing")},u.exportList=function(){function t(t){e.forceBinaryDownload(t.data,"DealIQ_Closed.xlsx")}function n(e){i.error(e)}e.exportDeals(u.params,u.deals.count).then(t,n)}}e.$inject=["dealsFactory","userOptionsFactory","tagsFactory","localStorageFactory","$scope","$rootScope","$log","$state"],angular.module("app").component("dealsListClosed",{templateUrl:"routes/deals/deals-list-closed.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s){function l(e){null===u.emptyState&&0===e.count?u.emptyState=!0:u.emptyState=!1,u.loading=!1,u.deals=e}function c(){var e={deal_stage:"executing"};n.getTags(e).then(function(e){u.allTags=e.tags_on_all_deals})}var u=this;u.$onInit=function(){r.$emit("updatePageTitle","Executing Deals"),i.$emit("dealLifeCycleStageUpdated","executing"),u.userOptions=a.getUserOptions(),u.deals=null,u.emptyState=null,u.options={dealStage:"executing",columnKey:"executing_column_order"};var e=o.get("executingState");u.params={deal_life_cycle_stage:"executing",is_archived:e?e.is_archived:void 0,user_wants_salesforce_export:e?e.user_wants_salesforce_export:void 0,ordering:e?e.ordering:"-modified",page:e?e.page:void 0,page_size:25,search:null},u.getDeals(),c()},u.search=function(e){u.params.search=e||null,u.params.page=1,u.getDeals()},u.getDeals=function(e){u.loading=!0,e&&angular.extend(u.params,e),o.save("executingState",u.params),t.getDeals(u.params).then(l)},u.onTagSelected=function(e){u.currentTags=e,u.params.tags=null;var t={};e.length>0&&(t.tags=e.join(",")),u.getDeals(t)},u.exportList=function(){function e(e){}function n(e){s.error(e)}t.exportDeals(u.params).then(e,n)},u.manageProspective=function(t){e.go("app.deals.prospects")},u.openProspectModal=function(){i.$emit("openProspectModal",{dealStage:"executing"})},u.exportList=function(){function e(e){t.forceBinaryDownload(e.data,"DealIQ_Executing.xlsx")}function n(e){s.error(e)}t.exportDeals(u.params,u.deals.count).then(e,n)}}e.$inject=["$state","dealsFactory","tagsFactory","userOptionsFactory","localStorageFactory","$scope","$rootScope","$log"],angular.module("app").component("dealsListExecuting",{templateUrl:"routes/deals/deals-list-executing.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s){function l(e){null===d.emptyState&&0===e.count?d.emptyState=!0:d.emptyState=!1,d.loading=!1,d.deals=e}function c(){t(function(){e.$broadcast("rzSliderForceRender")})}function u(){var e={deal_stage:"prospect"};a.getTags(e).then(function(e){d.allTags=e.tags_on_all_deals})}var d=this;d.$onInit=function(){e.$emit("updatePageTitle","Prospective Deals"),i.$emit("dealLifeCycleStageUpdated","prospect"),d.userOptions=o.getUserOptions(),d.deals=null,d.emptyState=null,d.options={dealStage:"prospect",columnKey:"prospect_column_order"};var t=r.get("prospectingState");d.params={deal_life_cycle_stage:"prospect",is_archived:t?t.is_archived:void 0,user_wants_salesforce_export:t?t.user_wants_salesforce_export:void 0,conversion_potential_min:t?t.conversion_potential_min:void 0,conversion_potential_max:t?t.conversion_potential_max:void 0,ordering:t?t.ordering:"-modified",page:t?t.page:void 0,page_size:25,search:null},d.advancedMode=!1,d.activeDialog=!1,d.conversionSlider={min:0,max:100,options:{floor:0,ceil:100,step:5,interval:1e4,onEnd:function(){d.filterByConversionPotential()}}},d.getDeals(),u()},d.filterByActiveDialog=function(e){d.params.page=1,e===!1?d.params.active_dialog=null:d.params.active_dialog=e,d.getDeals()},d.filterByConversionPotential=function(){d.params.page=1,100===d.conversionSlider.max?d.params.conversion_potential_max=null:d.params.conversion_potential_max=d.conversionSlider.max,0===d.conversionSlider.min?d.params.conversion_potential_min=null:d.params.conversion_potential_min=d.conversionSlider.min,d.getDeals()},d.search=function(e){d.params.search=e||null,d.params.page=1,d.getDeals()},d.showAdvanced=function(){d.advancedMode=!0,c()},d.hideAdvanced=function(){d.advancedMode=!1},d.openProspectModal=function(){i.$emit("openProspectModal",{dealStage:"prospect"})},d.getDeals=function(e){d.loading=!0,e&&angular.extend(d.params,e),r.save("prospectingState",d.params),n.getDeals(d.params).then(l)},d.onTagSelected=function(e){d.currentTags=e,d.params.tags=null;var t={};e.length>0&&(t.tags=e.join(",")),d.getDeals(t)},d.exportList=function(){function e(e){n.forceBinaryDownload(e.data,"DealIQ_Prospects.xlsx")}function t(e){s.error(e)}n.exportDeals(d.params,d.deals.count).then(e,t)}}e.$inject=["$scope","$timeout","dealsFactory","tagsFactory","userOptionsFactory","localStorageFactory","$rootScope","$log"],angular.module("app").component("dealsListProspects",{templateUrl:"routes/deals/deals-list-prospects.tpl.html",controller:e})}(),function(){"use strict";function e(){}angular.module("app").component("deals",{templateUrl:"routes/deals/deals.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a){function o(){r.deal=a.getCurrentDeal(),e.$emit("dealLifeCycleStageUpdated",r.deal.deal_life_cycle_stage),t.$emit("updatePageTitle",r.deal.name+" - Files")}var r=this;r.allFiles=[],t.$watch("$ctrl.files",function(){r.files&&(r.allFiles=r.allFiles.concat(r.files))}),r.$onInit=function(){o()}}e.$inject=["$rootScope","$scope","userOptionsFactory","dealsFactory"],angular.module("app").component("dealsDetailAttachments",{templateUrl:"routes/deals-detail/deals-detail-attachments.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u){function d(e,t){n.addEventListener("resize",a.debounce(p,10)),s.show({controller:"ContactModalInstanceCtrl",templateUrl:"contacts/contact-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{contact:e,initAction:t,contactFormOptions:v.contactFormOptions}}).then(v.saveContact)}function p(){s.hide(),n.removeEventListener("resize",a.debounce(p,10))}function m(e){r.show(r.simple().textContent(e).position("bottom center").hideDelay(3e3))}function f(){var t={deal:v.deal.id,page_size:100};return e.getContacts(t).then(function(e){return v.contacts=e.results,e},function(e){})}function g(){var t=a.find(v.contacts,function(e){return e.is_primary});t?v.selectedContact=t:v.selectedContact=v.contacts[0],e.hasPersonalContact(v.selectedContact.id).then(h)}function h(e){v.contactFormOptions=a.merge({},v.contactFormOptions,{enableAddToPersonalCheckbox:!e.data.has_personal_contact})}var v=this;v.mode="read",v.contactFormOptions={},v.$onInit=function(){v.deal=t.getCurrentDeal(),o.$emit("dealLifeCycleStageUpdated",v.deal.deal_life_cycle_stage),f().then(function(){g()})},v.toggleEditWithActionOnInit=function(e,t){v.actionOnInit={action:t,type:e},v.mode="edit"},v.onContactSelected=function(t,n){var o,r=i("xs")||i("sm"),s=!!t;if(n?(v.actionOnInit=n,v.mode="edit"):v.actionOnInit={action:"none"},l.$broadcast("onContactSelected"),s)v.selectedContact=t,o=e.hasPersonalContact(t.id);else{v.contactFormOptions=a.merge({},v.contactFormOptions,{enableAddToPersonalCheckbox:!0});var c=e.createEmptyContact(v.deal.id);0===v.contacts.length&&(c.is_primary=!0),v.selectedContact=c,t=c,v.mode="edit"}r?o?o.then(function(e){v.contactFormOptions=a.merge({},v.contactFormOptions,{enableAddToPersonalCheckbox:!e.data.has_personal_contact}),d(t,n)}):(v.contactFormOptions=a.merge({},v.contactFormOptions,{enableAddToPersonalCheckbox:!0}),d(t,n)):o&&o.then(h)},v.onContactDelete=function(t){var n=s.confirm({title:"Are you sure?",textContent:"This contact will be deleted permanently from this deal",ok:"Delete",cancel:"Cancel"});s.show(n).then(function(){e.deleteContact(t).then(function(){v.selectedContact=null,f(),r.show(r.simple().textContent("Contact deleted").position("bottom center").hideDelay(3e3))})})},v.toggleMode=function(){"read"===v.mode?v.mode="edit":(v.selectedContact.id||(v.selectedContact=null),v.mode="read")},v.saveContact=function(t){function n(e){return m("Contact updated"),s(e),e}function o(){m("Contact update failed")}function r(e){return m("Contact added"),s(e),e}function i(){m("Contact add failed")}function s(t){v.mode="read",f().then(function(){a.each(v.contacts,function(n){n.id===t.id&&(v.selectedContact=n,e.hasPersonalContact(v.selectedContact.id).then(h))})})}t.id?e.updateContact(t.id,t).then(n).then(function(n){return t.create_personal_contact?e.addPersonalContact(n):c.resolve(null)}).catch(o):e.addContact(t).then(r).then(function(n){return t.create_personal_contact?e.addPersonalContact(n):c.resolve(null)}).catch(i)},v.onContactUpdate=function(t,n){e.updateContact(t,n)}}e.$inject=["contactsFactory","dealsFactory","$window","_","$rootScope","$mdToast","$mdMedia","$mdDialog","$scope","$q","$timeout"],angular.module("app").component("dealsDetailContacts",{templateUrl:"routes/deals-detail/deals-detail-contacts.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,moment,i,s,l,c){function u(e,t){d.showErrorState=!0,i.show({controller:"ErrorModal",controllerAs:"vm",templateUrl:"shared/error-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{message:t,status:e}})}var d=this;d.deal=r.getCurrentDeal(),d.activeTab="installment",d.considerations=null,d.additionalCommissions,d.installments=null,d.pastDueInstallments=0,d.dealFinancials=null,d.escalations=null,d.leaseDetails=null,d.dealType=null,d.commissionOverview=null,d.brokerCommissionSummary=null,d.showErrorState=!1,d.dealTypeChoices={1:"Sale",2:"Lease",3:"Consulting",4:"Other"},d.$onInit=function(){s.$emit("dealLifeCycleStageUpdated",d.deal.deal_life_cycle_stage),l.$emit("updatePageTitle",d.deal.name+" - Commissions"),d.getConsiderations(),d.getAdditionalCommissions(),d.getInstallments(),d.getDealFinancials(),d.getEscalations()},d.getConsiderations=function(){e.getConsiderations({transaction:d.deal.id}).then(function(e){d.considerations=e}).catch(function(){u("Considerations 500","There was an error retrieving considerations information, please try again later.")})},d.getAdditionalCommissions=function(){t.getCommissions({transaction:d.deal.id}).then(function(e){d.additionalCommissions=e}).catch(function(){u("Additional Commissions 500","There was an error retrieving additional commissions information, please try again later.")})},d.getInstallments=function(){n.getInstallments({transaction:d.deal.id}).then(function(e){d.installments=e;for(var t=0;t<d.installments.length;t++){var n=d.installments[t];"Receivable"===n.payment_status&&(d.pastDueInstallments+=1,n.numberDaysPastDue=d.calculateDaysPastDue(n))}}).catch(function(){u("Installments 500","There was an error retrieving installment information, please try again later.")})},d.getDealFinancials=function(){a.getDealFinancials(d.deal.id).then(function(e){d.dealFinancials=e,d.leaseDetails=e.financial_details.deal_financial_overview,d.dealType=d.leaseDetails.deal_type,d.commissionOverview=e.financial_details.commission_overview_table,d.brokerCommissionSummary=e.financial_details.my_commission_summary}).catch(function(){u("Financial 500","There was an error retrieving financials, please try again later.")})},d.getEscalations=function(){o.getEscalations({transaction:d.deal.id}).then(function(e){d.escalations=e}).catch(function(){u("Escalations 500","There was an error retrieving escalations information, please try again later.")})},d.isAnnualOrMonthly=function(e){return/Annual/.test(e.consideration_type)},d.calculateDaysPastDue=function(e){var t=moment(new Date),n=moment(new Date(e.installment_date));return t.diff(n,"days")}}e.$inject=["considerationFactory","additionalCommissionFactory","installmentFactory","dealsFinancialFactory","escalationsFactory","dealsFactory","moment","$mdDialog","$rootScope","$scope","_"],angular.module("app").component("dealsDetailFinancials",{templateUrl:"routes/deals-detail/deals-detail-financials.tpl.html",controller:e,bindings:{dealResolve:"<"}})}(),function(){"use strict";function e(e,t,n,a){function o(){r.deal=a.getCurrentDeal(),e.$emit("dealLifeCycleStageUpdated",r.deal.deal_life_cycle_stage),t.$emit("updatePageTitle",r.deal.name+" - Notes")}var r=this;r.userOptions=n.getUserOptions(),r.$onInit=function(){o()}}e.$inject=["$rootScope","$scope","userOptionsFactory","dealsFactory"],angular.module("app").component("dealsDetailNotes",{templateUrl:"routes/deals-detail/deals-detail-notes.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c){function u(e){function t(e){return d("Contact updated"),r(e),e}function n(){d("Contact update failed")}function a(e){return d("Contact added"),r(e),e}function o(){d("Contact add failed")}function r(e){h.deal.primary_deal_contact=e}e.id?i.updateContact(e.id,e).then(t).then(function(t){return e.create_personal_contact?i.addPersonalContact(t):c.resolve(null)}).catch(n):i.addContact(e).then(a).then(function(t){return e.create_personal_contact?i.addPersonalContact(t):c.resolve(null)}).catch(o)}function d(e){o.show(o.simple().textContent(e).position("bottom center").hideDelay(3e3))}function p(){g(),h.deal=a.getCurrentDeal(),t.$emit("dealLifeCycleStageUpdated",h.deal.deal_life_cycle_stage),e.$emit("updatePageTitle",h.deal.name+" - Overview"),h.dealId=h.deal.id,m(h.deal.rep_role,h.deal.deal_life_cycle_stage),n.getBrokers(h.dealId).then(function(e){h.brokers=e})}function m(e,t){var n;n=e&&t?v[e][t]:v.other[t],f(),l.each(n,function(e){h.activeComponents[e]=!0})}function f(){l.each(h.activeComponents,function(e,t){h.activeComponents[t]=!1})}function g(){t.$on("primaryContactUpdated",function(e,t){h.deal.primary_deal_contact=t}),t.$on("dealUpdated",function(e,t){h.deal=t,m(h.deal.rep_role,h.deal.deal_life_cycle_stage)})}var h=this;h.estCommissionError=null;var v={tenant:{prospect:["requirements","conversionPotential","activeDialog"],executing:["requirements","conversionPotential","activeDialog"],closed:[]},landlord:{prospect:["conversionPotential","activeDialog"],executing:["conversionPotential","activeDialog"],closed:[]},buyer:{prospect:["conversionPotential","activeDialog"],executing:["conversionPotential","activeDialog"],closed:[]},seller:{prospect:["conversionPotential","activeDialog"],executing:["conversionPotential","activeDialog"],closed:[]},consulting:{prospect:["conversionPotential","activeDialog"],executing:["conversionPotential","activeDialog"],closed:[]},other:{prospect:["conversionPotential","activeDialog"],executing:["conversionPotential","activeDialog"],closed:[]}};h.userOptions=s.getUserOptions(),h.activeComponents={tags:!1,requirements:!1,conversionPotential:!1,activeDialog:!1},h.$onInit=function(){p()},h.allFiles=[],e.$watch("$ctrl.files",function(){h.files&&(h.allFiles=h.allFiles.concat(h.files))}),h.updateDeal=function(e){a.updateDeal(h.deal.id,e).then(function(e){m(e.rep_role,e.deal_life_cycle_stage),l.merge(h.deal,e),o.show(o.simple().textContent("Updated deal").position("bottom center").hideDelay(3e3))}).catch(function(e){/no more than 10 digits/.test(l.get(e,"data.estimated_commission[0]"))?h.estCommissionError="Max value allowed is 99,999,999.":h.estCommissionError="Invalid entry."})},h.updateEstimatedCommission=function(){if(""===h.deal.estimated_commission&&(h.deal.estimated_commission=null),h.deal.estimated_commission>99999999.99)return void(h.estCommissionError="Max value allowed is 99,999,999.");var e={estimated_commission:h.deal.estimated_commission};h.updateDeal(e)},h.refreshDeal=function(e){a.getDeal(h.deal.id).then(function(t){h.deal=t,e()})},h.openContactModal=function(e,t,n){var a,o;o=t?i.transformContactAddresses(t):i.createEmptyContact(e.id,{is_primary:!0}),"email"===n?a={action:"email",type:"work"}:"phone"===n&&(a={action:"phone",type:"work"}),t&&(t.is_primary=!0),o.id?i.hasPersonalContact(o.id).then(function(t){var n={showAddToPersonalCheckbox:!t.data.has_personal_contact};r.show({controller:"ContactModalInstanceCtrl",templateUrl:"contacts/contact-modal.tpl.html",parent:angular.element(document.body),controllerAs:"vm",clickOutsideToClose:!0,locals:{deal:e,contact:o,initAction:a,contactFormOptions:n}}).then(u)}):r.show({controller:"ContactModalInstanceCtrl",templateUrl:"contacts/contact-modal.tpl.html",parent:angular.element(document.body),controllerAs:"vm",clickOutsideToClose:!0,locals:{deal:e,contact:o,initAction:a,contactFormOptions:{}}}).then(u)}}e.$inject=["$scope","$rootScope","brokersFactory","dealsFactory","$mdToast","$mdDialog","contactsFactory","userOptionsFactory","_","$q"],angular.module("app").component("dealsDetailOverview",{templateUrl:"routes/deals-detail/deals-detail-overview.tpl.html",controller:e,bindings:{dealResolve:"<"}})}(),function(){"use strict";function e(e,t,n,a){function o(){s(),l.deal=a.getCurrentDeal(),t.$emit("dealLifeCycleStageUpdated",l.deal.deal_life_cycle_stage),r(l.deal.rep_role,l.deal.deal_life_cycle_stage)}function r(e,t){var a;a=e&&t?c[e][t]:c.other[t],i(),n.each(a,function(e){l.activeComponents[e]=!0})}function i(){n.each(l.activeComponents,function(e,t){l.activeComponents[t]=!1})}function s(){e.$on("dealUpdated",function(e,t){l.deal=t,r(l.deal.rep_role,l.deal.deal_life_cycle_stage)})}var l=this,c={tenant:{prospect:["requirements"],executing:["requirements"],closed:[]},landlord:{prospect:[],executing:[],closed:[]},buyer:{prospect:[],executing:[],closed:[]},seller:{prospect:[],executing:[],closed:[]},consulting:{prospect:[],executing:[],closed:[]},other:{prospect:[],executing:[],closed:[]}};l.activeComponents={tags:!1,requirements:!1},l.$onInit=function(){o()},l.refreshDeal=function(e){
a.getDeal(l.deal.id).then(function(t){l.deal=t,a.setCurrentDeal(t),e()})}}e.$inject=["$scope","$rootScope","_","dealsFactory"],angular.module("app").component("dealsDetailProperties",{templateUrl:"routes/deals-detail/deals-detail-properties.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l){function c(){u.deal=r.getCurrentDeal(),u.userOptions=n.getUserOptions(),a.fetchUser().then(function(e){u.userData=e}),u.params={page_size:u.pageSize,page:u.page,ordering:u.ordering,is_complete:!1,deal:u.deal.id};var o=!0;u.getTasks(null,o),e.$emit("dealLifeCycleStageUpdated",u.deal.deal_life_cycle_stage),t.$emit("updatePageTitle",u.deal.name+" - Tasks")}var u=this;u.selectedTask={},u.assignedDeal=null,u.pageSize=20,u.page=1,u.loading=!1,u.ordering="due_datetime",u.getTasks=function(e,t){u.loading=!0,e&&(u.params=angular.extend({},u.params,e)),o.getTasks(u.params).then(function(e){e.results&&(u.data=e,u.loading=!1,t&&e.results[0]&&(u.selectedTask=e.results[0]))})},u.updateTask=function(e){e.is_complete=!e.is_complete,s(function(){o.updateTask(e.id,{is_complete:!e.is_complete},{is_complete:e.is_complete}).then(function(e){u.selectedTask=null,i.show(i.simple().textContent("Task updated").position("bottom center").hideDelay(3e3)),u.getTasks()})},500)},u.deleteTask=function(e){o.deleteTask(e.id).then(function(e){u.selectedTask=null,i.show(i.simple().textContent("Task deleted").position("bottom center").hideDelay(3e3)),u.getTasks()})},u.deselectTask=function(){u.selectedTask=null},u.deletedTask=function(){u.deselectTask(),u.getTasks()},u.$onInit=function(){c()}}e.$inject=["$rootScope","$scope","userOptionsFactory","userFactory","tasksFactory","dealsFactory","$mdToast","$timeout","_"],angular.module("app").component("dealsDetailTasks",{templateUrl:"routes/deals-detail/deals-detail-tasks.tpl.html",controller:e})}(),function(){"use strict";function e(e){e.$emit("updatePageTitle","Not Found")}e.$inject=["$scope"],angular.module("app").component("notFound",{templateUrl:"routes/error-page/not-found.tpl.html",controller:e})}(),function(){"use strict";function e(e,t){t.$emit("updatePageTitle","Unauthorized");var n=this;n.initiateLogin=function(){e.initiateLogin()}}e.$inject=["authFactory","$scope"],angular.module("app").component("unauthorized",{templateUrl:"routes/error-page/unauthorized.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n){var a,o,r=/tk=(.*)/,i=r.exec(n.location.hash);return i&&(a=i[1]),a?(t.setToken(a),(o=t.getLastUrl())?void(n.location.href=o):void(n.location.href="/dashboard")):void t.initiateLogin()}e.$inject=["env","authFactory","$window"],angular.module("app").component("ssoCallback",{templateUrl:"routes/login/sso-callback.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i){function s(){r.$on("userAvatarUpdated",function(e,t){l.userData=t})}var l=this,c=["first_name","last_name","work_email"];o.$emit("updatePageTitle","Profile"),l.version=e.version,l.userData=t.getUser(),l.userOptions=n.getUserOptions(),l.updateAvatar=function(e){a.show({controller:"UpdateAvatarModalInstanceCtrl",templateUrl:"profile/update-avatar-modal.tpl.html",parent:angular.element(document.body),targetEvent:e,controllerAs:"vm",clickOutsideToClose:!0}).then(function(e){},function(){})},l.editProfile=function(e){a.show({controller:"EditProfileModalInstanceCtrl",templateUrl:"profile/edit-profile-modal.tpl.html",parent:angular.element(document.body),targetEvent:e,controllerAs:"vm",clickOutsideToClose:!0,locals:{user:l.userData}}).then(function(e){var n=i.pick(e,c);t.update(n).then(function(e){l.userData=e.data})},function(){})},l.toggleBleedingEdge=function(e){n.update("bleeding_edge_toggle_on",e).then(function(){r.$emit("userPreferencesUpdated")})},l.toggleLabs=function(e){n.update("labs_toggle_on",e).then(function(){r.$emit("userPreferencesUpdated")})},s()}e.$inject=["env","userFactory","userOptionsFactory","$mdDialog","$scope","$rootScope","_"],angular.module("app").component("profile",{templateUrl:"routes/profile/profile.tpl.html",controller:e})}(),function(){"use strict";function e(){}angular.module("app").component("root",{templateUrl:"routes/root/root.tpl.html",controller:e})}(),function(){"use strict";function e(e,t){function n(){e.$emit("updatePageTitle","Support Overview");var n={ordering:"-date"};t.getChangelog(n).then(function(e){a.whatsNew=e.results[0]}),t.getFeatures().then(function(e){a.features=e.results})}var a=this;n()}e.$inject=["$scope","supportFactory"],angular.module("app").component("supportOverview",{templateUrl:"routes/support/support-overview.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,moment){function n(){e.$emit("updatePageTitle","Support - What's New");var n={ordering:"-date",page_size:100};t.getChangelog(n).then(function(e){angular.forEach(e.results,function(e){e.month=moment(e.date).format("MMM"),e.day=moment(e.date).format("DD"),this.push(e)},a.changelog)})}var a=this;a.changelog=[],n()}e.$inject=["$scope","supportFactory","moment"],angular.module("app").component("supportWhatsNew",{templateUrl:"routes/support/support-whats-new.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n){function a(){o.activeNav=e.current.name,t.onEnter({to:"app.support.**"},function(e,t){o.activeNav=t.name})}var o=this;o.watchDemo=function(){n.show({controller:"VideoModal",controllerAs:"ctrl",templateUrl:"shared/video-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{videoURL:"https://assets.cbre.io/deal-iq/dealiq-overview.mp4",videoTitle:"Deal IQ Product Overview"}})},a()}e.$inject=["$state","$transitions","$mdDialog"],angular.module("app").component("support",{templateUrl:"routes/support/support.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s){function l(){var e=!0;c.getTasks(null,e)}i.$emit("updatePageTitle","Tasks");var c=this;c.userOptions=o.getUserOptions(),c.deal_stage=t.deal_stage,c.selectedTask=null,c.assignedDeal=null,c.pageSize=20,c.page=1,c.loading=!1,c.ordering="due_datetime";var u={page_size:c.pageSize,page:c.page,ordering:c.ordering,is_complete:!1,deal:null};c.params=u,r.fetchUser().then(function(e){c.userData=e}),c.updateTask=function(e){e.is_complete=!e.is_complete,s(function(){n.updateTask(e.id,{is_complete:!e.is_complete},{is_complete:e.is_complete}).then(function(e){c.selectedTask=null,a.show(a.simple().textContent("Task updated").position("bottom center").hideDelay(3e3)),c.getTasks()})},500)},c.getTasks=function(e,t){c.loading=!0,e&&(c.params=angular.extend({},c.params,e)),n.getTasks(c.params).then(function(e){e.results&&(c.data=e,c.loading=!1,t&&(c.selectedTask=e.results[0]))})},c.deleteTask=function(e){n.deleteTask(e.id).then(function(e){c.selectedTask=null,a.show(a.simple().textContent("Task deleted").position("bottom center").hideDelay(3e3)),c.getTasks()})},c.search=function(){c.page=1,c.params={page_size:c.pageSize,page:c.page,search:c.searchInput},n.searchTasks(c.params).then(function(e){e.results&&(c.data=e)})},c.clear=function(){c.searchInput=null,c.params=u,c.page=1,c.getTasks()},c.deselectTask=function(){c.selectedTask=null},c.deletedTask=function(){c.deselectTask(),c.getTasks()},l()}e.$inject=["_","$stateParams","tasksFactory","$mdToast","userOptionsFactory","userFactory","$scope","$timeout"],angular.module("app").component("tasks",{templateUrl:"routes/tasks/tasks.tpl.html",controller:e})}(),function(){"use strict";function e(e){var t=this;t.deal=t.dealResolve,t.$onInit=function(){e.$emit("dealLifeCycleStageUpdated",t.deal.deal_life_cycle_stage)}}e.$inject=["$rootScope"],angular.module("app").component("voucherCtrl",{templateUrl:"routes/voucher/voucher.tpl.html",controller:e,bindings:{dealResolve:"<"}})}(),function(){"use strict";function e(e,t,n,a,o,r,moment,i){function s(){function t(e){return e.data}function o(e){return a.reject(e)}var r={method:"OPTIONS",url:n.apiUrl+"additional_commissions"};return e(r).then(t,o)}function l(t,o){function r(e){return e.data}function i(e){return a.reject(e)}var s={method:"GET",url:n.apiUrl+"additional_commissions/"+t,params:o};return e(s).then(r,i)}function c(t,r){function i(e){return e.data.results}function s(e){return a.reject(e)}var l={method:"GET",url:n.apiUrl+"additional_commissions",params:t};return r&&(l=o.merge(l,r)),e(l).then(i,s)}function u(t,r,i){function s(e){return e.data}function l(e){return a.reject(e)}var c={method:"PUT",url:n.apiUrl+"additional_commissions/"+t,data:r};return i&&(c=o.merge(c,i)),e(c).then(s,l)}function d(t,r,i){function s(e){return e.data}function l(e){return a.reject(e)}var c={method:"PATCH",url:n.apiUrl+"additional_commissions/"+t,data:r};return i&&(c=o.merge(c,i)),e(c).then(s,l)}function p(t,r){function i(e){return e.data}function s(e){return a.reject(e)}var l={method:"POST",url:n.apiUrl+"additional_commissions",data:t};return r&&(l=o.merge(l,r)),e(l).then(i,s)}function m(t){function o(e){return e.data}function r(e){return a.reject(e)}var i={method:"DELETE",url:n.apiUrl+"additional_commissions/"+t};return e(i).then(o,r)}var f={getOptions:s,getCommission:l,getCommissions:c,updateCommission:u,patchCommission:d,createCommission:p,deleteCommission:m};return f}e.$inject=["$http","$window","env","$q","_","sanitizeFactory","moment","$rootScope"],angular.module("app").factory("additionalCommissionFactory",e)}(),function(){"use strict";function e(e,t,n){function a(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"GET",url:t.apiUrl+"alerts",params:a};return e(i).then(o,r)}function o(a,o){function r(e){return e.data}function i(e){return n.reject(e)}var s={method:"PATCH",url:t.apiUrl+"alerts/"+a,data:o};return e(s).then(r,i)}function r(){function a(e){return e.data}function o(e){return n.reject(e)}var r={method:"POST",url:t.apiUrl+"alerts/dismiss"};return e(r).then(a,o)}var i={getAlerts:a,updateAlert:o,dismissAlerts:r};return i}e.$inject=["$http","env","$q"],angular.module("app").factory("alertsFactory",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i){function s(t){function a(e){return e.data}function r(e){return o.reject(e)}var i={method:"GET",url:n.apiUrl+"mbb/attachments",params:t};return e(i).then(a,r)}function l(r,s,l){function c(r){var i={method:"GET",url:n.apiUrl+"mbb/attachments/"+r.data.id+"/upload"};return e(i).then(function(e){function n(e){return t.Intercom("trackEvent","created-attachment",{attachment_id:i.id}),e}function r(e){return o.reject(e)}var i=e.data;a.upload({url:i.attachment_upload_data.url,method:"POST",data:{"x-amz-date":i.attachment_upload_data.fields["x-amz-date"],key:i.attachment_upload_data.fields.key,"x-amz-credential":i.attachment_upload_data.fields["x-amz-credential"],"x-amz-algorithm":i.attachment_upload_data.fields["x-amz-algorithm"],"x-amz-signature":i.attachment_upload_data.fields["x-amz-signature"],policy:i.attachment_upload_data.fields.policy,file:s[0]}}).then(n,r,l)})}function u(e){return o.reject(e)}var d={method:"POST",url:n.apiUrl+"mbb/attachments",data:i.deepSanitize(r,p)};return e(d).then(c,u)}function c(t,a){var o={method:"GET",url:n.apiUrl+"mbb/attachments/"+t.id+"/download"};if(!a){var r=window.open("","_blank");o.url=n.apiUrl+"mbb/attachments/"+t.id+"/view"}return e(o).then(function(e){if(e.data.attachment_download_url)if(a){var t=document.createElement("a");t.href=e.data.attachment_download_url,t.download="download",document.body.appendChild(t),t.click(),document.body.removeChild(t)}else r.location.href=e.data.attachment_download_url})}function u(t,s,l){function c(e){return e.data}function u(e){return o.reject(e)}var d=t.id;delete t.id;var m,f;return r.isEmpty(t)||(f={method:"PATCH",url:n.apiUrl+"mbb/attachments/"+d,data:i.deepSanitize(t,p)},m=e(f).then(c,u)),s&&(f={method:"GET",url:n.apiUrl+"mbb/attachments/"+d+"/upload"},m=e(f).then(function(e){a.upload({url:e.data.attachment_upload_data.url,method:"POST",data:{"x-amz-date":e.data.attachment_upload_data.fields["x-amz-date"],key:e.data.attachment_upload_data.fields.key,"x-amz-credential":e.data.attachment_upload_data.fields["x-amz-credential"],"x-amz-algorithm":e.data.attachment_upload_data.fields["x-amz-algorithm"],"x-amz-signature":e.data.attachment_upload_data.fields["x-amz-signature"],policy:e.data.attachment_upload_data.fields.policy,file:s[0]}}).then(null,null,l)})),m}function d(t){function a(e){return e.data}function r(e){return o.reject(e)}var i={method:"DELETE",url:n.apiUrl+"mbb/attachments/"+t.id};return e(i).then(a,r)}var p=["deal","document_name","privacy","title","is_lease_document"],m={getAttachments:s,addAttachment:l,getAttachmentFile:c,deleteAttachment:d,updateAttachment:u};return m}e.$inject=["$http","$window","env","Upload","$q","_","sanitizeFactory"],angular.module("app").factory("attachmentsFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(o,r){function i(e){return e.data}function s(e){return n.reject(e)}var l={method:"GET",url:t.apiUrl+"brokers",params:o};return r&&(l=a.merge(l,r)),e(l).then(i,s)}var r={getBrokers:o};return r}e.$inject=["$http","env","$q","_"],angular.module("app").factory("brokersFactory",e)}(),function(){"use strict";function e(e,t,n,a,o){function r(o,r){function i(e){return e.data.results}function s(e){return n.reject(e)}var l={method:"GET",url:t.apiUrl+"mbb/clients",params:o};return r&&(l=a.merge(l,r)),e(l).then(i,s)}function i(a){function r(e){return e.data}function i(e){return n.reject(e)}var s={method:"POST",url:t.apiUrl+"clients",data:o.deepSanitize(a,l)};return e(s).then(r,i)}function s(a,r){function i(e){return e.data}function s(e){return n.reject(e)}var c={method:"PATCH",url:t.apiUrl+"clients/"+a,data:o.deepSanitize(r,l)};return e(c).then(i,s)}var l=["name","address","address2","city","territory","postal"],c={getClients:r,addClient:i,updateClient:s};return c}e.$inject=["$http","env","$q","_","sanitizeFactory"],angular.module("app").factory("clientsFactory",e)}(),function(){"use strict";function e(e,t,n){function a(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"GET",url:t.apiUrl+"mbb/traunchdetails",params:a};return e(i).then(o,r)}var o={getCommissions:a};return o}e.$inject=["$http","env","$q"],angular.module("app").factory("commissionsFactory",e)}(),function(){"use strict";function e(e,t,n,a,o,r,moment,i){function s(){function t(e){return e.data}function o(e){return a.reject(e)}var r={method:"OPTIONS",url:n.apiUrl+"considerations"};return e(r).then(t,o)}function l(t,o){function r(e){return e.data}function i(e){return a.reject(e)}var s={method:"GET",url:n.apiUrl+"considerations/"+t,params:o};return e(s).then(r,i)}function c(t,r){function i(e){return e.data.results}function s(e){return a.reject(e)}var l={method:"GET",url:n.apiUrl+"considerations",params:t};return r&&(l=o.merge(l,r)),e(l).then(i,s)}function u(t,r,i){function s(e){return e.data}function l(e){return a.reject(e)}var c={method:"PUT",url:n.apiUrl+"considerations/"+t,data:r};return i&&(c=o.merge(c,i)),e(c).then(s,l)}function d(t,r,i){function s(e){return e.data}function l(e){return a.reject(e)}var c={method:"PATCH",url:n.apiUrl+"considerations/"+t,data:r};return i&&(c=o.merge(c,i)),e(c).then(s,l)}function p(t,r){function i(e){return e.data}function s(e){return a.reject(e)}var l={method:"POST",url:n.apiUrl+"considerations",data:t};return r&&(l=o.merge(l,r)),e(l).then(i,s)}function m(t){function o(e){return e.data}function r(e){return a.reject(e)}var i={method:"DELETE",url:n.apiUrl+"considerations/"+t};return e(i).then(o,r)}var f={getOptions:s,getConsideration:l,getConsiderations:c,updateConsideration:u,patchConsideration:d,deleteConsideration:m,createConsideration:p};return f}e.$inject=["$http","$window","env","$q","_","sanitizeFactory","moment","$rootScope"],angular.module("app").factory("considerationFactory",e)}(),function(){"use strict";function e(e,t,n,a,o,r){function i(a){function o(e){return e}function r(e){return n.reject(e)}var i={method:"GET",url:e.apiUrl+"mbb/has_personal_contact/"+a};return t(i).then(o,r)}function s(a){function o(e){var t=y(e.data);return t}function r(e){return n.reject(e)}var i=g(a),s={method:"POST",url:e.apiUrl+"mbb/contacts",data:i};return t(s).then(o,r)}function l(a){function o(e){return e.data}function r(e){return n.reject(e)}a.is_primary=!1;var i=g(a),s={method:"POST",url:e.apiUrl+"mbb/contacts/personal",data:i};return t(s).then(o,r)}function c(a){function o(e){return e.data.results.map(b),e.data}function r(e){return n.reject(e)}var i={method:"GET",url:e.apiUrl+"mbb/contacts",params:a};return t(i).then(o,r)}function u(a,o){function r(e){var t=y(e.data);return t}function i(e){return n.reject(e)}var s=g(o),l={method:"PATCH",url:e.apiUrl+"mbb/contacts/"+a,data:s};return t(l).then(r,i)}function d(a){function o(e){return e}function r(e){return n.reject(e)}var i={method:"DELETE",url:e.apiUrl+"mbb/contacts/"+a};return t(i).then(o,r)}function p(a){function o(e){return e.data.results.map(b),e.data}function r(e){return n.reject(e)}var i={method:"GET",url:e.apiUrl+"mbb/contacts/personal",params:a};return t(i).then(o,r)}function m(a,o){function r(e){return e.data}function i(e){return n.reject(e)}var s=g(o),l={method:"PATCH",url:e.apiUrl+"mbb/contacts/personal/"+a,data:s};return t(l).then(r,i)}function f(a){function o(e){return e}function r(e){return n.reject(e)}var i={method:"DELETE",url:e.apiUrl+"mbb/contacts/personal/"+a};return t(i).then(o,r)}function g(e){var t=["address","type","default","name"],n=["number","type","default"],i=["type"],s=["company","contact_type","deal","email_addresses","given_name","id","is_primary","job_title","personal_notes","phone_numbers","surname","user","create_personal_contact","reference_contact","business_address","home_address","other_address","hidden"];r.log("Pre-sanitization contact",a.cloneDeep(e));var l=a.cloneDeep(e);a.isArray(l.phone_numbers)&&(l.phone_numbers=a.filter(l.phone_numbers,function(e){var t=!0;return e.number&&"string"==typeof e.number||(t=!1),e.type&&"string"==typeof e.type||(t=!1),"boolean"!=typeof e.default&&(t=!1),t}));var c=!1;a.isArray(l.phone_numbers)&&(l.phone_numbers=l.phone_numbers.map(function(e){return e.default&&(c=!0),e=o.sanitize(e,n)})),l.phone_numbers&&l.phone_numbers.length>0&&!c&&(l.phone_numbers[0].default=!0),a.isArray(l.email_addresses)&&(l.email_addresses=a.filter(l.email_addresses,function(e){var t=!0;return e.address&&"string"==typeof e.address||(t=!1),e.type&&"string"==typeof e.type||(t=!1),"boolean"!=typeof e.default&&(t=!1),t})),a.isArray(l.addresses)&&(l.addresses=l.addresses.map(function(e){return e=o.sanitize(e,i)}));var u=!1;return a.isArray(l.email_addresses)&&(l.email_addresses=l.email_addresses.map(function(e){return e.default&&(u=!0),e=o.sanitize(e,t),e.name=e.name||"",e})),a.isArray(l.email_addresses)&&l.email_addresses[0]&&!u&&(l.email_addresses[0].default=!0),l=o.sanitize(l,s),r.log("Post-sanitization contact",l),l}function h(e,t){var n={is_primary:!1};t=a.merge({},n,t);var o={deal:e,contact_type:"deal",phone_numbers:[{type:"work",number:"",default:!0}],email_addresses:[{type:"work",address:"",default:!0}],addresses:[]};return a.merge(o,t),o}function v(){var e={contact_type:"deal",phone_numbers:[{type:"mobile",number:"",default:!1},{type:"work",number:"",default:!0}],email_addresses:[{type:"work",address:"",default:!0}],addresses:[]};return e}function _(e){var t={user:e,contact_type:"deal",phone_numbers:[{type:"work",number:"",default:!0}],email_addresses:[{type:"work",address:"",default:!0}],addresses:[]};return t}function y(e){var t=a.find(e.phone_numbers,function(e){return e.default}),n=a.find(e.email_addresses,function(e){return e.default});return e.defaultPhone=t,e.defaultEmail=n,e}function b(e){e.addresses=[];var t=["business_address","home_address","other_address"];return a.each(t,function(t){var n=a.cloneDeep(e[t]);a.isEmpty(n)||(e[t]={},n.type=t,e.addresses.push(n))}),e}function C(e){return e.email_addresses[0]||e.email_addresses.push({type:"work",address:"",default:!1}),e}var T={addContact:s,addPersonalContact:l,getContacts:c,getPersonalContacts:p,deleteContact:d,updateContact:u,createEmptyContact:h,createEmptyProspectContact:v,createEmptyPersonalContact:_,updatePersonalContact:m,deletePersonalContact:f,sanitizeContact:g,hasPersonalContact:i,transformContactAddresses:b,contactDecorator:C};return T}e.$inject=["env","$http","$q","_","sanitizeFactory","$log"],angular.module("app").factory("contactsFactory",e)}(),function(){"use strict";function e(e,t,n,a,o,r,moment,i,s,l){function c(){function t(e){return e.data}function o(e){return a.reject(e)}var r={method:"OPTIONS",url:n.apiUrl+"mbb/deals"};return e(r).then(t,o)}function u(t,o){function r(e){var t=p(e.data);return t}function i(e){return a.reject(e)}var s={method:"GET",url:n.apiUrl+"mbb/deals/"+t,params:o};return e(s).then(r,i)}function d(t,r){function i(e){var t=l(e.data.results);return e.data.results=t,e.data}function s(e){return a.reject(e)}function l(e){var t=o.map(e,p);return t}var c={method:"GET",url:n.apiUrl+"mbb/deals",params:t};return r&&(c=o.merge(c,r)),e(c).then(i,s)}function p(e){if(e.primary_deal_contact){var t=o.find(e.primary_deal_contact.phone_numbers,function(e){return e.default}),n=o.find(e.primary_deal_contact.email_addresses,function(e){return e.default});e.primary_deal_contact.defaultPhone=t,e.primary_deal_contact.defaultEmail=n}return e.date_current_lease_exp&&(e.date_current_lease_exp=moment(e.date_current_lease_exp).toDate()),e.current_properties&&o.each(e.current_properties,function(t){o.each(t.spaces,function(e){e.lease_expiration_date&&(e.lease_expiration_date=moment(e.lease_expiration_date).toDate()),e.lease_start_date&&(e.lease_start_date=moment(e.lease_start_date).toDate())});var n=o.find(t.spaces,function(e){return e.is_primary});if(n)return e.lease_expiration_date=n.lease_expiration_date,!1}),e.final_properties&&o.each(e.final_properties,function(e){o.each(e.spaces,function(e){e.lease_expiration_date&&(e.lease_expiration_date=moment(e.lease_expiration_date).toDate()),e.lease_start_date&&(e.lease_start_date=moment(e.lease_start_date).toDate())})}),e}function m(o){function s(e){var n=e.data;return t.Intercom("trackEvent","created-prospect",{deal_id:n.id}),i.$emit("dealCreated",n),n}function l(e){return a.reject(e)}var c={method:"POST",url:n.apiUrl+"mbb/deals",data:r.deepSanitize(o,D)};return e(c).then(s,l)}function f(t,s){function l(e){var t=p(e.data);return i.$emit("dealUpdated",t),t}function c(e){return T(e.statusText,e.data.detail),a.reject(e)}function u(e){var t=o.cloneDeep(e),n={prospect:1,executing:3,closed:4};return e.deal_life_cycle_stage&&(t.deal_life_cycle_stage=n[e.deal_life_cycle_stage]),e.date_est_close&&"object"==typeof e.date_est_close&&(t.date_est_close=moment(e.date_est_close).format("YYYY-MM-DD")),t.date_current_lease_exp&&(t.date_current_lease_exp=moment(t.date_current_lease_exp).format("YYYY-MM-DD")),o.each(t.current_properties,function(e){o.each(e.spaces,function(e){e.lease_expiration_date&&(e.lease_expiration_date=moment(e.lease_expiration_date).format("YYYY-MM-DD")),e.lease_start_date&&(e.lease_start_date=moment(e.lease_start_date).format("YYYY-MM-DD"))})}),o.each(t.final_properties,function(e){o.each(e.spaces,function(e){e.lease_expiration_date&&(e.lease_expiration_date=moment(e.lease_expiration_date).format("YYYY-MM-DD")),e.lease_start_date&&(e.lease_start_date=moment(e.lease_start_date).format("YYYY-MM-DD"))})}),t}var d={method:"PATCH",url:n.apiUrl+"mbb/deals/"+t,data:r.deepSanitize(s,D),transformRequest:[u].concat(e.defaults.transformRequest)};return e(d).then(l,c)}function g(t){function o(e){return e.data}function r(e){return a.reject(e)}var i={method:"PATCH",url:n.apiUrl+"mbb/deals/"+t+"/favorite"};return e(i).then(o,r)}function h(t){function o(e){return e}function r(e){return a.reject(e)}var i={method:"PATCH",url:n.apiUrl+"mbb/deals/"+t+"/unfavorite"};return e(i).then(o,r)}function v(e){var t="";return e.deal_substage_lease_review?t="Lease Review":e.deal_substage_LOI?t="LOI":e.deal_substage_RFP?t="RFP":e.deal_substage_touring&&(t="Touring"),t}function _(t,r){function i(e){return e}function l(e){return s.show(s.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Export failed.").textContent("List is empty.").ariaLabel("Export failed.").ok("OK")),a.reject(e)}r=r||1;var c=Math.floor(r/100),u=1===c?"second":"seconds";s.show(s.alert().parent(angular.element(document.body)).clickOutsideToClose(!0).title("Downloading Your File").textContent("Your file will download in approximately "+c+" "+u).ariaLabel("Downloading your file").ok("Continue"));var d=o.cloneDeep(t);o.unset(d,"page"),o.unset(d,"page_size"),o.unset(d,"ordering");var p={method:"GET",url:n.apiUrl+"mbb/deals/export",params:d,responseType:"arraybuffer"};return e(p).then(i,l)}function y(e,n){n=n||"download.xlsx";var a=new t.Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});if(t.navigator.msSaveOrOpenBlob)t.navigator.msSaveOrOpenBlob(a,n);else{var o=document.createElement("a"),r=t.URL.createObjectURL(a);o.setAttribute("href",r),o.setAttribute("download",n),document.body.appendChild(o),l(function(){o.click()}),document.body.appendChild(o)}}function b(){return $}function C(e){$=e}function T(e,t){s.show({controller:"ErrorModal",controllerAs:"vm",templateUrl:"shared/error-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{message:t,status:e}})}var D=["active_dialog","client.name","client","contact_type","conversion_potential","counter_party","current_properties","date_current_lease_exp","date_est_close","date_lease_execution","date_lease_from","date_lease_to","deal_life_cycle_stage","deal_substage_lease_review","deal_substage_LOI","deal_substage_RFP","deal_substage_touring","deal_type","estimated_commission","final_properties","is_archived","is_deleted","is_dual_rep_deal","is_primary","lease_agreement_type","lease_income_type","name","name","primary_deal_contact.contact_type","primary_deal_contact.create_personal_contact","primary_deal_contact.email_addresses[0]","primary_deal_contact.email_addresses[1]","primary_deal_contact.email_addresses[2]","primary_deal_contact.given_name","primary_deal_contact.is_primary","primary_deal_contact.job_title","primary_deal_contact.personal_notes","primary_deal_contact.phone_numbers[0]","primary_deal_contact.phone_numbers[1]","primary_deal_contact.phone_numbers[2]","primary_deal_contact.phone_numbers[3]","primary_deal_contact.phone_numbers[4]","primary_deal_contact.surname","rep_role","sourced_by","sqft","tags","user_wants_salesforce_export"],$=null,k={getDeals:d,getDeal:u,addDeal:m,updateDeal:f,favoriteDeal:g,unFavoriteDeal:h,getLastSubstage:v,getDealOptions:c,exportDeals:_,forceBinaryDownload:y,getCurrentDeal:b,setCurrentDeal:C};return k}e.$inject=["$http","$window","env","$q","_","sanitizeFactory","moment","$rootScope","$mdDialog","$timeout"],angular.module("app").factory("dealsFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(o,r,i){function s(e){return e.data}function l(e){return n.reject(e)}var c={method:"GET",url:t.apiUrl+"mbb/deals/"+o+"/financials",params:r};return i&&(c=a.merge(c,i)),e(c).then(s,l)}var r={getDealFinancials:o};return r}e.$inject=["$http","env","$q","_"],angular.module("app").factory("dealsFinancialFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(){function a(e){return e.data}function o(e){return n.reject(e)}var r={method:"OPTIONS",url:t.apiUrl+"escalations"};return e(r).then(a,o)}function r(a,o){function r(e){return e.data()}function i(e){return n.reject(e)}var s={method:"GET",url:t.apiUrl+"escalations/"+a,params:o};return e(s).then(r,i)}function i(o,r){function i(e){return e.data.results}function s(e){return n.reject(e)}var l={method:"GET",url:t.apiUrl+"escalations",params:o};return r&&(l=a.merge(l,r)),e(l).then(i,s)}var s={getOptions:o,getEscalation:r,getEscalations:i};return s}e.$inject=["$http","env","$q","_"],angular.module("app").factory("escalationsFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(){function a(e){return e.data}function o(e){return n.reject(e)}var r={method:"GET",url:t.apiUrl+"choices/contingency_codes"};return e(r).then(a,o)}function r(o,r){function i(e){return e.data.results}function s(e){return n.reject(e)}var l={method:"GET",url:t.apiUrl+"installments",params:o};return r&&(l=a.merge(l,r)),e(l).then(i,s)}function i(o,r){function i(e){return e.data}function s(e){return n.reject(e)}var l={method:"POST",url:t.apiUrl+"installments",data:o};return r&&(l=a.merge(l,r)),e(l).then(i,s)}function s(o,r,i){function s(e){return e.data}function l(e){return n.reject(e)}var c={method:"PUT",url:t.apiUrl+"installments/"+o,data:r};return i&&(c=a.merge(c,i)),e(c).then(s,l)}function l(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"DELETE",url:t.apiUrl+"installments/"+a};return e(i).then(o,r)}var c={getOptions:o,getInstallments:r,createInstallment:i,updateInstallment:s,deleteInstallment:l};return c}e.$inject=["$http","env","$q","_"],angular.module("app").factory("installmentFactory",e)}(),function(){"use strict";function e(e,t){function n(){var n={method:"GET",url:t.logoutUrl};return e(n)}var a={logout:n};return a}e.$inject=["$http","env"],angular.module("app").factory("logoutFactory",e)}(),function(){"use strict";function e(e,t,n,a,o){function r(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"GET",url:t.apiUrl+"mbb/members",params:a};return e(i).then(o,r)}function i(a){function r(e){return e.data}function i(e){return n.reject(e)}var s={method:"POST",url:t.apiUrl+"mbb/members",data:o.deepSanitize(a,l)};return e(s).then(r,i)}function s(a){function o(e){return e}function r(e){return n.reject(e)}var i={method:"DELETE",url:t.apiUrl+"mbb/members/"+a};return e(i).then(o,r)}var l=["deal","team","user_id","work_email"],c={getMembers:r,addMember:i,removeMember:s};return c}e.$inject=["$http","env","$q","_","sanitizeFactory"],angular.module("app").factory("membersFactory",e)}(),function(){"use strict";function e(e,t,n,a,o){function r(t){function o(e){return e.data}function r(e){return a.reject(e)}var i={method:"GET",url:n.apiUrl+"mbb/notes",params:t};return e(i).then(o,r)}function i(r){function i(e){var n=e.data;return t.Intercom("trackEvent","created-note",{note_id:n.id}),n}function s(e){return a.reject(e)}var l={method:"POST",url:n.apiUrl+"mbb/notes",data:o.deepSanitize(r,c)};return e(l).then(i,s)}function s(t){function o(e){return e}function r(e){return a.reject(e)}var i={method:"DELETE",url:n.apiUrl+"mbb/notes/"+t};return e(i).then(o,r)}function l(t,r){function i(e){return e}function s(e){return a.reject(e)}var l={method:"PATCH",url:n.apiUrl+"mbb/notes/"+t,data:o.deepSanitize(r,c)};return e(l).then(i,s)}var c=["body","deal","privacy"],u={getNotes:r,addNote:i,deleteNote:s,updateNote:l};return u}e.$inject=["$http","$window","env","$q","sanitizeFactory"],angular.module("app").factory("notesFactory",e)}(),function(){"use strict";function e(e,t,n){function a(){function a(e){return e.data}function o(e){return t.reject(e)}var r={method:"OPTIONS",url:n.apiUrl+"properties"};return e(r).then(a,o)}function o(a,o){function r(e){return e.data}function i(e){return t.reject(e)}var s={method:"PATCH",url:n.apiUrl+"properties/"+a,data:o};return e(s).then(r,i)}function r(a){function o(e){return e.data}function r(e){return t.reject(e)}var i={method:"DELETE",url:n.apiUrl+"properties/"+a};return e(i).then(o,r)}var i={updateProperty:o,deleteProperty:r,getPropertyOptions:a};return i}e.$inject=["$http","$q","env"],angular.module("app").factory("propertiesFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(a,o){function r(e){return e.data}function i(e){return n.reject(e)}var s={method:"PATCH",url:t.apiUrl+"mbb/requirements/"+a,data:o};return e(s).then(r,i)}function r(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"POST",url:t.apiUrl+"mbb/requirements",data:a};return e(i).then(o,r)}function i(){return f}function s(){return g}function l(e){var t=c(e.lease_type);t&&(e.lease_type=t.intKey);
var n=u(e.product);return n&&(e.product=n.intKey),m(e),e}function c(e){return a.find(f,function(t){return t.stringKey===e})}function u(e){return a.find(g,function(t){return t.stringKey===e})}function d(e){return a.find(g,function(t){return t.intKey===parseInt(e)})}function p(e){return a.find(f,function(t){return t.intKey===parseInt(e)})}function m(e){e.showProductType=function(){if(e){var t=d(e.product);return a.get(t,"display")}},e.showLeaseType=function(){if(e){var t=p(e.lease_type);return a.get(t,"display")}}}var f=[{intKey:1,stringKey:"new lease",display:"New Lease"},{intKey:2,stringKey:"renewal",display:"Renewal"},{intKey:3,stringKey:"modification",display:"Modification"},{intKey:4,stringKey:"sublease",display:"Sublease"},{intKey:5,stringKey:"expansion",display:"Expansion"},{intKey:6,stringKey:"contraction",display:"Contraction"},{intKey:7,stringKey:"termination",display:"Termination"},{intKey:8,stringKey:"relocation",display:"Relocation"}],g=[{intKey:1,stringKey:"office",display:"Office"},{intKey:2,stringKey:"industrial",display:"Industrial"},{intKey:3,stringKey:"retail",display:"Retail"},{intKey:5,stringKey:"multi-family",display:"Multi-family"},{intKey:4,stringKey:"land",display:"Land"},{intKey:6,stringKey:"hotel",display:"Hotel"},{intKey:7,stringKey:"other",display:"Other"}],h={updateRequirements:o,addRequirements:r,getLeaseTypeKeyMap:i,getProductTypeKeyMap:s,transformRequirements:l,getProductTypeByIntKey:d,getLeaseTypeByIntKey:p};return h}e.$inject=["$http","env","$q","_"],angular.module("app").factory("requirementsFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(t,o){function r(e){return e.data}function i(e){return a.reject(e)}var s={method:"GET",url:n.apiUrl+"global_search",params:t,timeout:o.promise};return e(s).then(r,i)}var r={search:o};return r}e.$inject=["$http","$window","env","$q"],angular.module("app").factory("searchFactory",e)}(),function(){"use strict";function e(e,t,n){function a(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"GET",url:t.apiUrl+"support/changes",cache:!1,params:a};return e(i).then(o,r)}function o(){function a(e){return e.data}function o(e){return n.reject(e)}var r={method:"GET",url:t.apiUrl+"support/features",cache:!1};return e(r).then(a,o)}var r={getChangelog:a,getFeatures:o};return r}e.$inject=["$http","env","$q"],angular.module("app").factory("supportFactory",e)}(),function(){"use strict";function e(e,t,n){function a(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"GET",url:t.apiUrl+"mbb/deals/tags",params:a};return e(i).then(o,r)}function o(a,o){function r(e){return e}function i(e){return n.reject(e)}var s={method:"PATCH",url:t.apiUrl+"mbb/deals/"+a,data:{tags:o}};return e(s).then(r,i)}var r={getTags:a,updateTags:o};return r}e.$inject=["$http","env","$q"],angular.module("app").factory("tagsFactory",e)}(),function(){"use strict";function e(e,t,n,a,o,r,i){function s(t){function o(e){return e.data}function r(e){return a.reject(e)}var i={method:"GET",url:n.apiUrl+"mbb/tasks",params:t};return e(i).then(o,r)}function l(t){function o(e){return e.data}function r(e){return a.reject(e)}var i={method:"GET",url:n.apiUrl+"mbb/tasks",params:t};return e(i).then(o,r)}function c(t,o){function r(e){return e.data}function i(e){return a.reject(e)}var s={method:"GET",url:n.apiUrl+"mbb/tasks/"+t,params:o};return e(s).then(r,i)}function u(t,r,s){function l(e){return e.data}function c(e){return a.reject(e)}var u=i.diffObject(r,s),d={method:"PATCH",url:n.apiUrl+"mbb/tasks/"+t,data:o.deepSanitize(u,m)};return e(d).then(l,c)}function d(i){function s(e){var n=e.data;return t.Intercom("trackEvent","created-task",{task_id:n.id}),n}function l(e){return a.reject(e)}var c=o.deepSanitize(i,m);r.each(c,function(e,t){""===e&&r.unset(c,t)});var u={method:"POST",url:n.apiUrl+"mbb/tasks",data:c};return e(u).then(s,l)}function p(t){function o(e){return e.data}function r(e){return a.reject(e)}var i={method:"DELETE",url:n.apiUrl+"mbb/tasks/"+t};return e(i).then(o,r)}var m=["title","is_complete","is_private","is_priority","due_datetime","alert_datetime","document_body","deal","assignees"],f={getTasks:l,getTask:c,updateTask:u,addTask:d,deleteTask:p,searchTasks:s};return f}e.$inject=["$http","$window","env","$q","sanitizeFactory","_","loscoreFactory"],angular.module("app").factory("tasksFactory",e)}(),function(){"use strict";function e(e,t,n,a,o){function r(a){function o(e){return e.data}function r(e){return n.reject(e)}var i={method:"GET",url:t.apiUrl+"mbb/teams",params:a};return e(i).then(o,r)}function i(a){function r(e){return e}function i(e){return n.reject(e)}var s={method:"POST",url:t.apiUrl+"mbb/teams",data:o.deepSanitize(a,l)};return e(s).then(r,i)}function s(a){function o(e){return e}function r(e){return n.reject(e)}var i={method:"DELETE",url:t.apiUrl+"mbb/teams/"+a.id};return e(i).then(o,r)}var l=["user_id","team"],c={getTeams:r,addTeam:i,removeTeam:s};return c}e.$inject=["$http","env","$q","_","sanitizeFactory"],angular.module("app").factory("teamsFactory",e)}(),function(){"use strict";function e(e,t,n){function a(a){function o(e){return e.data}function r(e){return t.reject(e)}var i={method:"GET",url:e.apiUrl+"mbb/terms",params:a};return n(i).then(o,r)}var o={getTerms:a};return o}e.$inject=["env","$q","$http"],angular.module("app").factory("termsFactory",e)}(),function(){"use strict";function e(e,t,n){function a(a,o,r){function i(e){return e.data}function s(e){return n.reject(e)}var l={event:o,user_id:a,timestamp:(new Date).toUTCString(),metadata:r},c={method:"POST",url:e.apiUrl+"user_events/",data:l};return t(c).then(i,s)}var o={addUserEvent:a};return o}e.$inject=["env","$http","$q"],angular.module("app").factory("userEventsFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(){return l}function r(){function a(e){return l=e.data,e.data}function o(e){return n.reject(e)}var r={method:"GET",url:t.apiUrl+"user",cache:!1};return e(r).then(a,o)}function i(n){var a={method:"PATCH",url:t.apiUrl+"user",data:n};return e(a)}function s(e){function n(e){return e.data}return a.upload({url:t.apiUrl+"user",method:"PATCH",data:{avatar:e}}).then(n)}var l,c={fetchUser:r,getUser:o,update:i,updateAvatar:s};return c}e.$inject=["$http","env","$q","Upload"],angular.module("app").factory("userFactory",e)}(),function(){"use strict";function e(e,t,n){function a(){function a(e){return s=e.data,e.data}function o(e){return n.reject(e)}var r={method:"GET",url:t.apiUrl+"mbb/user/preferences"};return e(r).then(a,o)}function o(e){return s[e]}function r(){return s}function i(a,o){function r(e){s=e.data}function i(e){return n.reject(e)}var l={};l[a]=o;var c={method:"PATCH",url:t.apiUrl+"mbb/user/preferences",data:l};return e(c).then(r,i)}var s={prospect_column_order:["current_address","conversion_potential","tags","occupancy_date"],executing_column_order:["current_address","occupancy_date","tags","progress"],closed_column_order:["final_address","rep_role","tags","closed"]},l={getUserOptions:r,getTableKeys:o,fetchOptions:a,update:i};return l}e.$inject=["$http","env","$q"],angular.module("app").factory("userOptionsFactory",e)}(),function(){"use strict";function e(e,t,n,a){function o(a,o){function r(e){return e}function i(e){return n.reject(e)}var s={method:"PATCH",url:e.apiUrl+"mbb/voucher/companies/"+a,data:o};return t(s).then(r,i)}function r(a){function o(e){return e}function r(e){return n.reject(e)}var i={method:"POST",url:e.apiUrl+"mbb/voucher/companies",data:a};return t(i).then(o,r)}function i(){var e={name:null,address:null,address2:null,city:null,territory:null,postal:null};return a.cloneDeep(e)}var s={updateCompany:o,addCompany:r,generateCompany:i};return s}e.$inject=["env","$http","$q","_"],angular.module("app").factory("voucherCompaniesFactory",e)}(),function(){"use strict";function e(e,t,n,a,o){function r(a){function o(e){return e.data}function r(e){return t.reject(e)}var i={method:"POST",url:n.apiUrl+"mbb/vouchers",data:{deal:a}};return e(i).then(o,r)}function i(a){function o(e){return e.data}function r(e){return t.reject(e)}var i={method:"GET",url:n.apiUrl+"mbb/vouchers/"+a};return e(i).then(o,r)}function s(a,o){function r(e){return e.data}function i(e){return l(e.statusText,e.data.detail),t.reject(e)}var s={method:"PATCH",url:n.apiUrl+"mbb/vouchers/"+a,data:o};return e(s).then(r,i)}function l(e,t){a.show({controller:"ErrorModal",controllerAs:"vm",templateUrl:"shared/error-modal.tpl.html",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{message:t,status:e}})}var c={addVoucher:r,getVoucher:i,updateVoucher:s};return c}e.$inject=["$http","$q","env","$mdDialog","errorMessageFactory"],angular.module("app").factory("vouchersFactory",e)}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){},e.isNumberlike=function(e){return!isNaN(Number(e))}}angular.module("app").component("flexTableAddress",{templateUrl:"flex-table/flex-table-components/flex-table-address.tpl.html",controller:e,bindings:{dealType:"<",dealId:"<",properties:"<",dealLifeCycleStage:"<"}})}(),function(){"use strict";function e(moment){var e=this;e.$onInit=function(){e.date&&(e.dateObj=moment(e.date).toDate())}}e.$inject=["moment"],angular.module("app").component("flexTableDateReadOnly",{templateUrl:"flex-table/flex-table-components/flex-table-date-read-only.tpl.html",controller:e,bindings:{date:"<"}})}(),function(){"use strict";function e(moment){var e=this;e.openCalendar=!1,e.$onInit=function(){e.date&&(e.dateObj=moment(e.date).toDate())},e.updateDate=function(t){var n={dealId:e.dealId,data:{}};n.data[e.dateKey]=moment(t).format("YYYY-MM-DD"),e.onUpdateDeal(n)}}e.$inject=["moment"],angular.module("app").component("flexTableDate",{templateUrl:"flex-table/flex-table-components/flex-table-date.tpl.html",controller:e,bindings:{dealId:"<",dateKey:"<",date:"<",isDisabled:"<",displayName:"<",onUpdateDeal:"&"}})}(),function(){"use strict";function e(e,moment,t,n,a){var o=this;o.$onInit=function(){o.showArchived=o.params.is_archived,o.showSynced=o.params.user_wants_salesforce_export,o.dateCloseMin=o.params.date_approved_min?moment(o.params.date_approved_min).toDate():void 0,o.dateCloseMax=o.params.date_approved_max?moment(o.params.date_approved_max).toDate():void 0,o.dateCloseMinDatepicker=!1,o.dateCloseMaxDatepicker=!1},o.toggleArchivedDeals=function(){o.onShowArchivedChange({data:o.showArchived})},o.toggleSalesforceSyncedDeals=function(){o.onSalesforceSyncedChange({data:o.showSynced})},o.refreshSlider=function(){n(function(){t.$broadcast("rzSliderForceRender")},200)},o.slider={minValue:o.params.conversion_potential_min||0,maxValue:o.params.conversion_potential_max||100,options:{floor:0,ceil:100,step:5,translate:function(e){return e+"%"},onEnd:function(){var e={};e.conversion_potential_min=o.slider.minValue,e.conversion_potential_max=o.slider.maxValue,o.onFilterByConversionPotential({data:e})}}},o.getCloseDateMin=function(){o.onUpdateDateCloseMin({data:o.dateCloseMin})},o.getCloseDateMax=function(){o.onUpdateDateCloseMax({data:o.dateCloseMax})}}e.$inject=["localStorageFactory","moment","$scope","$timeout","$window"],angular.module("app").component("flexTableFilter",{templateUrl:"flex-table/flex-table-components/flex-table-filter.tpl.html",controller:e,bindings:{dealStage:"<",onShowArchivedChange:"&",onFilterByConversionPotential:"&",onUpdateDateCloseMin:"&",onUpdateDateCloseMax:"&",onSalesforceSyncedChange:"&",params:"<"}})}(),function(){"use strict";function e(){}angular.module("app").component("flexTableNumber",{templateUrl:"flex-table/flex-table-components/flex-table-number.tpl.html",controller:e,bindings:{dealId:"<",number:"<",numberKey:"<",displayName:"<"}})}(),function(){"use strict";function e(){}angular.module("app").component("flexTableOccupancy",{templateUrl:"flex-table/flex-table-components/flex-table-occupancy.tpl.html",controller:e,bindings:{occupancyDate:"<"}})}(),function(){"use strict";function e(e){function t(){var e={dealId:n.dealId,data:{}};e.data[n.percentageKey]=n.percentage,n.onUpdateDeal(e)}var n=this,a=e.debounce(t,1e3);n.$onInit=function(){},n.updatePercentage=function(e){a()}}e.$inject=["_"],angular.module("app").component("flexTablePercentage",{templateUrl:"flex-table/flex-table-components/flex-table-percentage.tpl.html",controller:e,bindings:{dealId:"<",percentage:"<",percentageKey:"<",displayName:"<",onUpdateDeal:"&"}})}(),function(){"use strict";function e(e){var t=this;t.$onInit=function(){t.sortingKeysForDealStage=t.sortingKeys[t.dealStage],t.currentSortingKey=e.find(t.sortingKeysForDealStage,function(e){return e.sortingKey===t.params.ordering})},t.sortByKey=function(n){t.onSortDeals({data:n}),t.currentSortingKey=e.find(t.sortingKeysForDealStage,function(e){return e.sortingKey===n})}}e.$inject=["_"],angular.module("app").component("flexTableSort",{templateUrl:"flex-table/flex-table-components/flex-table-sort.tpl.html",controller:e,bindings:{sortingKeys:"<",dealStage:"<",onSortDeals:"&",params:"<"}})}(),function(){"use strict";function e(){var e=this,t=e.sqftMin,n=e.sqftMax;e.$onInit=function(){e.editMode=!1},e.edit=function(){e.editMode=!0},e.cancel=function(){e.sqftMin=t,e.sqftMax=n,e.editMode=!1},e.updateSqftRange=function(a,o){var r={data:{sqft:{}}};a&&(r.data.sqft.min=a),o&&(r.data.sqft.max=o),e.requirementsId?(r.requirementsId=e.requirementsId,e.onUpdateRequirements(r)):(r.data.deal=e.dealId,e.onAddRequirements(r)),t=a,n=o,e.editMode=!1}}angular.module("app").component("flexTableSqftRange",{templateUrl:"flex-table/flex-table-components/flex-table-sqft-range.tpl.html",controller:e,bindings:{requirementsId:"<",dealId:"<",sqftMin:"<",sqftMax:"<",isDisabled:"<",onUpdateRequirements:"&",onAddRequirements:"&"}})}(),function(){"use strict";function e(e){var t=this;t.showAllTags=!1,e.hideShowAllTags=function(){e.hide()},t.filterTags=function(t){e.$emit("filterByTag",t)}}e.$inject=["$scope"],angular.module("app").component("flexTableTags",{templateUrl:"flex-table/flex-table-components/flex-table-tags.tpl.html",controller:e,bindings:{tags:"<",dealId:"<"}})}(),function(){"use strict";function e(){var e=this;e.$onInit=function(){}}angular.module("app").component("flexTableText",{templateUrl:"flex-table/flex-table-components/flex-table-text.tpl.html",controller:e,bindings:{text:"<"}})}(),function(){"use strict";function e(e,t){var n=this;n.title=e.title,n.image=e.image,n.imageHeight=e.imageHeight,n.imageWidth=e.imageWidth,n.text=e.text,n.ok=function(){t.close()}}e.$inject=["content","mdPanelRef"],angular.module("app").controller("PopoverContentCtrl",e)}(),function(){"use strict";function e(e,t,n,a,o,r){var i,s=this;s.$onInit=function(){},s.showContent=function(t){function n(){i.close(),o.removeEventListener("resize",u)}var a,l="center";window.innerWidth<960?a="center":t.target.getBoundingClientRect()&&(a="offset-start");var c=e.newPanelPosition().relativeTo(t.target).addPanelPosition(a,l),u=r.debounce(n,10);o.addEventListener("resize",u),e.open({attachTo:angular.element(document.body),controller:"PopoverContentCtrl",controllerAs:"vm",clickOutsideToClose:!0,escapeToClose:!0,focusOnOpen:!0,position:c,hasBackdrop:!1,locals:{content:s.content},openFrom:t,panelClass:"popover-content",templateUrl:"shared/popover/popover-content.tpl.html",zIndex:81}).then(function(e){i=e},function(){o.removeEventListener("resize",u)})}}e.$inject=["$mdPanel","$timeout","$rootScope","$scope","$window","_"],angular.module("app").component("popover",{templateUrl:"shared/popover/popover.tpl.html",controller:e,bindings:{content:"<"}})}(),function(){"use strict";function e(e,t,n,a,o,r,i){function s(){var e={deal:d.deal.id,page_size:999,page:1,ordering:"-modified",is_lease_document:!0};t.getAttachments(e).then(function(e){d.attachments=e})}function l(){e.getDealOptions().then(function(e){d.sourceByOptions=e.actions.POST.sourced_by.choices})}function c(){p=a.$watch("$ctrl.files",function(){if(d.files&&d.files.length>0){var e={hidePermissionOptions:!0};n.show({controller:"DealPanelAttachmentsModal",templateUrl:"attachments/deal-panel-attachments-modal.tpl.html",controllerAs:"vm",parent:angular.element(document.body),clickOutsideToClose:!0,locals:{files:d.files,deal:d.deal,getAttachments:s,options:e}}).then(function(e){e.is_lease_document=!0,o.$emit("uploadAttachment",{fileData:e,files:d.files,callback:s})})}})}function u(){p()}var d=this,p=null;d.sourceByOptions=null,d.attachments=null,d.deal=e.getCurrentDeal(),d.$onInit=function(){l(),s(),c()},d.$onDestroy=function(){u()},d.updateDeal=function(t){var n=i.pick(d.deal,t);e.updateDeal(d.deal.id,n)},d.delete=function(e){var a=n.confirm({title:"Are you sure?",textContent:"This attachment will be deleted permanently",ok:"Delete",cancel:"Cancel"});n.show(a).then(function(){t.deleteAttachment(e).then(function(){s(),r.show(r.simple().textContent("Attachment deleted").position("bottom center").hideDelay(3e3))})})},d.download=function(e,n){t.getAttachmentFile(e,n)}}e.$inject=["dealsFactory","attachmentsFactory","$mdDialog","$scope","$rootScope","$mdToast","_"],angular.module("app").component("gettingStartedCtrl",{templateUrl:"routes/voucher/1_getting_started/1_getting_started.tpl.html",controller:e})}(),function(){"use strict";function e(e){var t=this;t.$onInit=function(){"app.voucher.2_leaseDetails"===e.current.name&&e.go("app.voucher.2_leaseDetails.2_1_overview")}}e.$inject=["$state"],angular.module("app").component("leaseDetailsCtrl",{templateUrl:"routes/voucher/2_lease_details/2_lease_details.tpl.html",controller:e,bindings:{voucherResolve:"<"}})}(),function(){"use strict";function e(e,t){var n=this;n.$onInit=function(){"app.voucher.3_financials"===e.current.name&&e.go("app.voucher.3_financials.3_1_consideration")}}e.$inject=["$state","$log"],angular.module("app").component("financialDetailCtrl",{templateUrl:"routes/voucher/3_financials/3_financials.tpl.html",controller:e,bindings:{voucherResolve:"<"}})}(),function(){"use strict";function e(e,t,n){function a(){t.getDealOptions().then(function(e){o.leaseAgreementType=e.actions.POST.lease_agreement_type.choices,o.leaseTransactionType=e.actions.POST.lease_income_type.choices})}var o=this,r={address:null,city:null,state_abbreviation:null,postal_code:null,spaces:[]},i={address_line2:"",whole_building:!1};o.form=[],o.openLeaseExpDialog=!1,o.spaceLeaseExpirationIsOpen={},o.$onInit=function(){a(),o.deal=t.getCurrentDeal(),o.states=n.getStates(),o.zipCodePattern=n.getZipCodePattern(),0===o.deal.current_properties.length&&o.addProperty()},o.updateDeal=function(n){var a=e.pick(o.deal,n);t.updateDeal(o.deal.id,a)},o.addProperty=function(){var t=e.cloneDeep(r),n=e.cloneDeep(i);t.spaces.push(n),o.deal.current_properties.push(t),o.updateDeal("current_properties")},o.addSpace=function(e){o.deal.current_properties[e].spaces.push(angular.copy(i)),o.updateDeal("current_properties")},o.removeProperty=function(e){o.deal.current_properties.splice(e,1),o.updateDeal("current_properties")},o.removeSpace=function(e,t){o.deal.current_properties[e].spaces.splice(t,1),o.updateDeal("current_properties")}}e.$inject=["_","dealsFactory","formFactory"],angular.module("app").component("leaseDetailOverviewCtrl",{templateUrl:"routes/voucher/2_lease_details/2_1_overview/2_1_overview.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a){function o(){e.getPropertyOptions().then(function(e){r.propertyType=e.actions.POST.voucher_property_type.choices,r.propertySubtype=e.actions.POST.voucher_property_subtype.choices})}var r=this;r.spaceLeaseStartIsOpen=[],r.spaceLeaseExpirationIsOpen=[];var i={address_line2:"",whole_building:!1},s={address:null,city:null,state_abbreviation:null,postal_code:null,spaces:[t.cloneDeep(i)]};r.$onInit=function(){o(),r.deal=n.getCurrentDeal(),r.states=a.getStates(),r.zipCodePattern=a.getZipCodePattern(),0===r.deal.final_properties.length&&r.deal.final_properties.push(angular.copy(s))},r.addProperty=function(){r.deal.final_properties.push(angular.copy(s))},r.addSpace=function(e){e.spaces.push(angular.copy(i))},r.removeProperty=function(e){r.deal.final_properties.splice(e,1),r.updateDeal()},r.updateDeal=function(e){var a=t.pick(r.deal,e);n.updateDeal(r.deal.id,a)},r.removeSpace=function(e,t){r.deal.final_properties[e].spaces.splice(t,1),r.updateDeal()}}e.$inject=["propertiesFactory","_","dealsFactory","formFactory"],angular.module("app").component("leaseDetailPropertiesCtrl",{templateUrl:"routes/voucher/2_lease_details/2_2_properties/2_2_properties.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o){function r(){var e={deal:m.deal.id,contact_type:"landlord"};n.getContacts(e).then(function(e){if(e.results[0]){var t=e.results[0];m.contact=n.contactDecorator(t)}else c()})}function i(){"landlord"===m.deal.rep_role&&s(),"tenant"===m.deal.rep_role&&l()}function s(){m.deal.client?m.landlordCompany=m.deal.client:u()}function l(){m.deal.counter_party?m.landlordCompany=m.deal.counter_party:d()}function c(){var e=n.createEmptyContact(m.deal.id,{contact_type:"landlord"});n.addContact(e).then(function(e){m.contact=n.contactDecorator(e)})}function u(){var e=a.generateCompany();a.addCompany(e).then(function(e){m.landlordCompany=e.data;var n={client:{id:e.data.id}};t.updateDeal(m.deal.id,n).then(function(e){t.setCurrentDeal(e)})})}function d(){var e=a.generateCompany();a.addCompany(e).then(function(e){m.landlordCompany=e.data;var n={counter_party:{id:e.data.id}};t.updateDeal(m.deal.id,n).then(function(e){t.setCurrentDeal(e)})})}function p(){t.getDealOptions().then(function(e){m.repRoleOptions=e.actions.POST.rep_role.choices})}var m=this;m.landlordCompany=null,m.$onInit=function(){m.deal=t.getCurrentDeal(),m.states=o.getStates(),m.zipCodePattern=o.getZipCodePattern(),i(),r(),p()},m.onCompanyBlur=function(t){var n=e.pick(m.landlordCompany,t);a.updateCompany(m.landlordCompany.id,n)},m.onContactBlur=function(t){var a=e.pick(m.contact,t);n.updateContact(m.contact.id,a)}}e.$inject=["_","dealsFactory","contactsFactory","voucherCompaniesFactory","formFactory"],angular.module("app").component("leaseDetailLandlordCtrl",{templateUrl:"routes/voucher/2_lease_details/2_3_landlord/2_3_landlord.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o){function r(){"landlord"===m.deal.rep_role&&l(),"tenant"===m.deal.rep_role&&s()}function i(){var e={deal:m.deal.id,contact_type:"tenant"};n.getContacts(e).then(function(e){if(e.results[0]){var t=e.results[0];m.contact=n.contactDecorator(t)}else c()})}function s(){m.deal.client?m.tenantCompany=m.deal.client:u()}function l(){m.deal.counter_party?m.tenantCompany=m.deal.counter_party:d()}function c(){var e=n.createEmptyContact(m.deal.id,{contact_type:"tenant"});n.addContact(e).then(function(e){m.contact=n.contactDecorator(e)})}function u(){var e=a.generateCompany();a.addCompany(e).then(function(e){m.tenantCompany=e.data;var n={client:{id:e.data.id}};t.updateDeal(m.deal.id,n).then(function(e){t.setCurrentDeal(e)})})}function d(){var e=a.generateCompany();a.addCompany(e).then(function(e){m.tenantCompany=e.data;var n={counter_party:{id:e.data.id}};t.updateDeal(m.deal.id,n).then(function(e){t.setCurrentDeal(e)})})}function p(){t.getDealOptions().then(function(e){m.repRoleOptions=e.actions.POST.rep_role.choices})}var m=this;m.tenantCompany=null,m.$onInit=function(){m.deal=t.getCurrentDeal(),m.states=o.getStates(),m.zipCodePattern=o.getZipCodePattern(),r(),i(),p()},m.onCompanyBlur=function(t){var n=e.pick(m.tenantCompany,t);a.updateCompany(m.tenantCompany.id,n)},m.onContactBlur=function(t){var a=e.pick(m.contact,t);n.updateContact(m.contact.id,a)}}e.$inject=["_","dealsFactory","contactsFactory","voucherCompaniesFactory","formFactory"],angular.module("app").component("leaseDetailTenantCtrl",{templateUrl:"routes/voucher/2_lease_details/2_4_tenant/2_4_tenant.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,n,a,o,r,i,s,l,c,u,d){function p(e){angular.merge(e,{amount:0,consideration_amount:0,commission_percent:0,commission_amount:0,total_units:0})}function m(){return h.additionalCommissionOptions.filter(function(e,t){return"Consulting Fee"===e.display_name})[0].value}function f(){return h.considerationOptions.filter(function(e,t){return"Monthly Rent"===e.display_name})[0].value}function g(){n.getOptions().then(function(e){h.considerationOptions=e.actions.POST.consideration_type.choices.filter(function(e,t){return e.display_name in h.leaseConsiderationTypes})}),a.getOptions().then(function(e){h.additionalCommissionOptions=e.actions.POST.acommission_type.choices})}var h=this;h.deal=t.getCurrentDeal(),h.considerationOptions=null,h.considerations=[],h.additionalCommissionOptions=null,h.additionalCommissions=[],h.leaseConsiderationTypes={"Annual Rent":!0,"Free Annual Rent":!0,"Monthly Rent":!0,"Free Monthly Rent":!0},h.totals={},h.totalsEmptyState={consideration:{total_rental_period_months:0,total_rent:0,rent_avg_per_month:0,total_consideration:0,total_commission_percent:0,commission_percent_avg_per_month:0,total_commission_amount:0},additionalCommission:{total_commission_amount:0},total_consideration:0,total_gross_commission:0},h.saveButtonIds={},h.$onInit=function(){g(),h.getConsiderations(),h.getAdditionalCommissions()},h.updateVoucher=function(){e.updateVoucher(h.id,h).then(function(){h.updateTotals()})},h.updateTotals=function(){h.totals=angular.copy(h.totalsEmptyState);for(var e in h.considerations){var t=h.considerations[e],n=t.total_units;/Annual/.test(t.consideration_type)&&(n=12*t.total_units),h.totals.consideration.total_rental_period_months+=n,h.totals.consideration.total_rent+=t.amount,h.totals.consideration.total_consideration+=t.consideration_amount,h.totals.consideration.total_commission_percent+=t.commission_percent,h.totals.consideration.total_commission_amount+=t.commission_amount}h.totals.consideration.rent_avg_per_month=h.totals.consideration.total_consideration/h.totals.consideration.total_rental_period_months,h.totals.consideration.commission_percent_avg_per_month=h.totals.consideration.total_commission_amount/h.totals.consideration.total_consideration*100;for(var a in h.additionalCommissions){var o=h.additionalCommissions[a];h.totals.additionalCommission.total_commission_amount+=o.commission_amount}h.totals.total_gross_commission=h.totals.consideration.total_commission_amount+h.totals.additionalCommission.total_commission_amount},h.isFree=function(e){return/Free/.test(e.consideration_type)},h.calcLoop=function(e,t){var n=["consideration_amount","commission_percent","commission_amount"],a=n.reduce(function(e,n){if(n===t)return e;var a={};return a[n]=!0,Object.assign(e,a)},{}),o=0;"consideration_amount"in a&&(o=e.total_units*e.amount,e.consideration_amount=o),"commission_percent"in a&&0!==e.consideration_amount&&(o=e.commission_amount/e.consideration_amount*100,e.commission_percent=o),"commission_amount"in a&&(o=e.consideration_amount*(e.commission_percent/100),e.commission_amount=o)},h.calcConsideration=function(e,t){return"consideration_type"===t?(/Free/.test(e[t])&&p(e),h.updateConsideration(e)):(isNaN(e[t])&&(e[t]=0),h.calcLoop(e,t),h.updateTotals(),void(h.saveButtonIds["consideration-save-"+e.id]=!1))},h.saveConsideration=function(e){h.saveButtonIds["consideration-save-"+e.id]=!0,h.updateConsideration(e)},h.removeConsiderationLine=function(e,t){n.deleteConsideration(e.id).then(function(){h.considerations.splice(t,1),h.updateTotals()})},h.addConsiderationLine=function(){var e={transaction:h.deal.id,amount:0,commission_amount:0,commission_percent:0,consideration_amount:0,total_units:0,consideration_type:f(),deal_id:null};n.createConsideration(e).then(function(e){h.considerations.push(e),h.updateTotals()})},h.getConsiderations=function(){n.getConsiderations({consideration_type:Object.keys(h.leaseConsiderationTypes),transaction:h.deal.id}).then(function(e){h.considerations=e,h.updateTotals()})},h.updateConsideration=function(e){n.patchConsideration(e.id,{consideration_type:e.consideration_type,total_units:e.total_units,amount:e.amount,commission_amount:e.commission_amount}).then(function(e){r.considerationForm["consideration_amount-"+e.id].$setValidity("maxAllowableSize",!0),r.considerationForm["consideration_amount-"+e.id].$setUntouched(),r.considerationForm["commission_percent-"+e.id].$setValidity("maxAllowableSize",!0),r.considerationForm["commission_percent-"+e.id].$setUntouched(),h.updateTotals()}).catch(function(e){"key"in e.data&&"error"in e.data&&(e=e.data,r.considerationForm[e.key].$setValidity(e.error.name,!1),r.considerationForm[e.key].$setTouched())})},h.removeAdditionalCommissionLine=function(e,t){a.deleteCommission(e.id).then(function(){h.additionalCommissions.splice(t,1),h.updateTotals()})},h.addAdditionalCommissionLine=function(){var e={transaction:h.deal.id,amount:0,commission_amount:0,total_units:0,acommission_type:m(),deal_id:null};a.createCommission(e).then(function(e){h.additionalCommissions.push(e),h.updateTotals()})},h.getAdditionalCommissions=function(){a.getCommissions({transaction:h.deal.id}).then(function(e){h.additionalCommissions=e,h.updateTotals()})},h.updateCommission=function(e){a.patchCommission(e.id,{acommission_type:e.acommission_type,total_units:e.total_units,amount:e.amount}).then(function(e){r.additionalCommissionForm["commission_amount-"+e.id].$setValidity("maxAllowableSize",!0),r.additionalCommissionForm["commission_amount-"+e.id].$setUntouched(),h.updateTotals()}).catch(function(e){"key"in e.data&&"error"in e.data&&(e=e.data,r.additionalCommissionForm[e.key].$setValidity(e.error.name,!1),r.additionalCommissionForm[e.key].$setTouched())})},h.saveAdditionalCommission=function(e){h.saveButtonIds["commission-save-"+e.id]=!0,h.updateCommission(e)},h.calcAdditionalCommission=function(e,t){return"acommission_type"===t?h.updateCommission(e):(isNaN(e[t])&&(e[t]=0),e.commission_amount=e.total_units*e.amount,h.updateTotals(),void(h.saveButtonIds["commission-save-"+e.id]=!1))}}e.$inject=["vouchersFactory","dealsFactory","considerationFactory","additionalCommissionFactory","$mdDialog","$scope","$rootScope","$mdToast","$window","$filter","$log","_"],angular.module("app").component("financialDetailConsiderationCtrl",{templateUrl:"routes/voucher/3_financials/3_1_consideration/3_1_consideration.tpl.html",controller:e})}(),function(){"use strict";function e(e,t,moment,n,a,o,r,i,s,l,c){function u(){t.getOptions().then(function(e){f.contingencies=[{display_name:"None",value:""}].concat(e)})}function d(){return 0===f.installments.length?1:c.maxBy(f.installments,"installment_number").installment_number+1}function p(e){e.deal_total_commission<.009?e.installment_percent=0:e.installment_percent=c.round(100*(e.installment_amount/e.deal_total_commission),2)}function m(e){var t=e.installment_percent/100*e.deal_total_commission;e.installment_amount=c.round(t,2)}var f=this;f.installmentOptions=null,f.installments=[],f.openDueDateDialog=[],f.deal=e.getCurrentDeal(),f.contingencies=[],f.$onInit=function(){u(),f.getInstallments()},f.getInstallments=function(){t.getInstallments({transaction:f.deal.id}).then(function(e){f.installments=e;for(var t in f.installments)f.installments[t].installment_date&&(f.installments[t].installment_date=moment(f.installments[t].installment_date).toDate(),p(f.installments[t]))})},f.addInstallment=function(){var e={transaction:f.deal.id,installment_number:d(),installment_amount:0,installment_date:(new Date).toISOString(),contingencies:[]};t.createInstallment(e).then(function(e){e.installment_date=moment(e.installment_date).toDate(),f.installments.push(e)})},f.updateInstallment=function(e){t.updateInstallment(e.id,e).then(function(e){}).catch(function(e){})},f.removeInstallment=function(e,n){t.deleteInstallment(e.id).then(function(){f.installments.splice(n,1)})},f.fieldChanged=function(e,t){"amount"===e?p(t):"percent"===e&&m(t)}}e.$inject=["dealsFactory","installmentFactory","moment","$mdDialog","$scope","$rootScope","$mdToast","$window","$filter","$log","_"],angular.module("app").component("financialDetailInstallmentsCtrl",{templateUrl:"routes/voucher/3_financials/3_2_installments/3_2_installments.tpl.html",controller:e
})}();
//# sourceMappingURL=app_bb2a48a4b31904d8a88f9f2294c157b9.js.map
